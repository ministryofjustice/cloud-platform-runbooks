<!doctype html>
<html lang="en" class="no-js">
  <head>
    <meta content="IE=edge" http-equiv="X-UA-Compatible">
    <meta charset="utf-8">
    <meta content="width=device-width,initial-scale=1.0,minimum-scale=1.0,maximum-scale=1.0,user-scalable=no" name="viewport">
      <meta name="robots" content="noindex">

    <title>Template-deploy Run-books | Cloud Platform Runbooks</title>

    <!--[if gt IE 8]><!--><link href="/stylesheets/screen.css" rel="stylesheet" media="screen" /><!--<![endif]-->
    <!--[if lte IE 8]><link href="/stylesheets/screen-old-ie.css" rel="stylesheet" media="screen" /><![endif]-->

    <link rel="canonical" href="https://runbooks.cloud-platform.service.justice.gov.uk/template-deploy-run-books.html">


    <link href="/stylesheets/print.css" rel="stylesheet" media="print" />
    <script src="/javascripts/application.js"></script>

      <meta property="og:image" content="https://runbooks.cloud-platform.service.justice.gov.uk/images/govuk-large.png" />
      <meta property="og:site_name" content="Cloud Platform Runbooks" />
      <meta property="og:title" content="Template-deploy Run-books" />
      <meta property="og:type" content="object" />
      <meta property="og:url" content="https://runbooks.cloud-platform.service.justice.gov.uk/template-deploy-run-books.html" />
      <meta property="twitter:card" content="summary" />
      <meta property="twitter:domain" content="runbooks.cloud-platform.service.justice.gov.uk" />
      <meta property="twitter:image" content="https://runbooks.cloud-platform.service.justice.gov.uk/images/govuk-large.png" />
      <meta property="twitter:title" content="Template-deploy Run-books | Cloud Platform Runbooks" />
      <meta property="twitter:url" content="https://runbooks.cloud-platform.service.justice.gov.uk/template-deploy-run-books.html" />

    
  </head>

  <body>
    <div class="app-pane">
      <div class="app-pane__header toc-open-disabled">
        <a href="#content" class="skip-link">Skip to main content</a>

        <header class="header header--full-width">
  <div class="header__container">
    <div class="header__brand">
        <a href="/">
        <span class="header__title">
          Cloud Platform Runbooks
            <span class="phase-banner">INTERNAL</span>
        </span>
        </a>
    </div>

      <div data-module="navigation">
        <button type="button" class="header__navigation-toggle js-nav-toggle" aria-controls="navigation" aria-label="Show or hide top level navigation">Menu</button>

        <nav id="navigation" class="header__navigation js-nav" aria-label="Top Level Navigation" aria-hidden="true">
          <ul>
              <li>
                <a href="mailto:platforms+runbooks@digital.justice.gov.uk?subject=Runbooks+feedback">Feedback / Report a problem</a>
              </li>
              <li>
                <a href="/">Documentation</a>
              </li>
              <li>
                <a href="https://github.com/ministryofjustice/cloud-platform/tree/master/runbooks">GitHub</a>
              </li>
          </ul>
        </nav>
      </div>
  </div>
</header>

      </div>

        <div id="toc-heading" class="toc-show fixedsticky">
          <a href="#toc" class="toc-show__label js-toc-show" aria-controls="toc">
            Table of contents <span class="toc-show__icon"></span>
          </a>
        </div>

      <div class="app-pane__body" data-module="in-page-navigation">
          <div class="app-pane__toc">
            <div class="toc" data-module="table-of-contents">
              <div class="search" data-module="search">
  <form action="https://www.google.co.uk/search" method="get" role="search">
    <input type="hidden" name="as_sitesearch" value="https://runbooks.cloud-platform.service.justice.gov.uk"/>
    <label for="search"  class="search__label">Search (via Google)</label>
    <input type="text" id="search" name="q" placeholder="Search" aria-controls="search-results" class="form-control" />
  </form>
  <div id="search-results" class="search-results" aria-hidden="true" role="dialog" aria-labelledby="search-results-title">
    <div class="search-results__inner">
      <button class="search-results__close">Close<span class="search-results__close-label"> search results</span></button>
      <h2 id="search-results-title" class="search-results__title" aria-live="polite">Results</h2>
      <div class="search-results__content"></div>
    </div>
  </div>
</div>

              <a href="#" class="toc__close js-toc-close" aria-controls="toc" aria-label="Hide table of contents"></a>
              <nav id="toc" class="js-toc-list toc__list" aria-labelledby="toc-heading" data-module="collapsible-navigation">
                      <ul>
  <li>
    <a href="/#cloud-platform-runbooks">Cloud Platform Runbooks</a>
  </li>
</ul>
<ul>
  <li>
    <a href="/create-cluster.html#create-a-new-cluster">Create a new cluster</a>
    <ul>
      <li>
        <a href="/create-cluster.html#pre-requisites">Pre-requisites</a>
      </li>
      <li>
        <a href="/create-cluster.html#environment-variables">Environment Variables</a>
      </li>
      <li>
        <a href="/create-cluster.html#run-the-build-script-via-the-tools-image">Run the build script, via the tools image</a>
      </li>
      <li>
        <a href="/create-cluster.html#alerts">Alerts</a>
        <ul>
          <li>
            <a href="/create-cluster.html#apply-the-changes">Apply the changes</a>
          </li>
        </ul>
      </li>
    </ul>
  </li>
</ul>
<ul>
  <li>
    <a href="/add-concourse-to-cluster.html#add-concourse-to-a-test-cluster">Add Concourse to a test cluster</a>
    <ul>
      <li>
        <a href="/add-concourse-to-cluster.html#add-concourse-to-a-test-cluster-pre-requisites">Pre-requisites</a>
      </li>
      <li>
        <a href="/add-concourse-to-cluster.html#process">Process</a>
      </li>
    </ul>
  </li>
</ul>
<ul>
  <li>
    <a href="/upgrade-cluster.html#upgrade-a-cluster">Upgrade a cluster</a>
    <ul>
      <li>
        <a href="/upgrade-cluster.html#upgrade-a-cluster-pre-requisites">Pre-requisites</a>
        <ul>
          <li>
            <a href="/upgrade-cluster.html#upgrade-a-cluster-pre-requisites-environment-variables">Environment Variables</a>
          </li>
          <li>
            <a href="/upgrade-cluster.html#sanity-checks">Sanity checks</a>
          </li>
          <li>
            <a href="/upgrade-cluster.html#run-a-shell-in-the-tools-image">Run a shell in the tools image</a>
          </li>
        </ul>
      </li>
      <li>
        <a href="/upgrade-cluster.html#run-the-upgrade">Run the upgrade</a>
      </li>
      <li>
        <a href="/upgrade-cluster.html#upgrade-a-cluster-sanity-checks">Sanity checks</a>
      </li>
      <li>
        <a href="/upgrade-cluster.html#commit">Commit</a>
      </li>
    </ul>
  </li>
</ul>
<ul>
  <li>
    <a href="/delete-cluster.html#delete-a-cluster">Delete a cluster</a>
    <ul>
      <li>
        <a href="/delete-cluster.html#delete-the-cluster-using-the-script">Delete the cluster using the script</a>
      </li>
      <li>
        <a href="/delete-cluster.html#delete-the-cluster-manually">Delete the cluster manually</a>
      </li>
    </ul>
  </li>
</ul>
<ul>
  <li>
    <a href="/add-nodes-to-the-cluster.html#add-nodes-to-the-cluster">Add nodes to the cluster</a>
    <ul>
      <li>
        <ul>
          <li>
            <a href="/add-nodes-to-the-cluster.html#requirements">Requirements</a>
          </li>
          <li>
            <a href="/add-nodes-to-the-cluster.html#inline-edit">Inline edit</a>
          </li>
          <li>
            <a href="/add-nodes-to-the-cluster.html#persisting-the-changes">Persisting the changes</a>
          </li>
        </ul>
      </li>
    </ul>
  </li>
</ul>
<ul>
  <li>
    <a href="/rotate-git-crypt-key.html#git-crypt">Git-crypt</a>
    <ul>
      <li>
        <a href="/rotate-git-crypt-key.html#adding-new-user-to-the-keyring">Adding new user to the keyring</a>
      </li>
      <li>
        <a href="/rotate-git-crypt-key.html#rotating-the-git-crypt-key">Rotating the git-crypt key</a>
        <ul>
          <li>
          </li>
        </ul>
      </li>
    </ul>
  </li>
</ul>
<ul>
  <li>
    <a href="/disaster-recovery.html#cloud-platform-disaster-recovery">Cloud Platform Disaster Recovery</a>
    <ul>
      <li>
        <a href="/disaster-recovery.html#restore-process">Restore process</a>
      </li>
      <li>
        <a href="/disaster-recovery.html#apply-cloud-platform-resources">Apply cloud-platform resources</a>
      </li>
      <li>
        <a href="/disaster-recovery.html#cloud-platform-disaster-recovery-create-a-new-cluster">Create a new cluster</a>
      </li>
      <li>
        <a href="/disaster-recovery.html#perform-the-restore">Perform the restore</a>
        <ul>
          <li>
            <a href="/disaster-recovery.html#perform-the-restore-pre-requisites">Pre-requisites</a>
          </li>
          <li>
            <a href="/disaster-recovery.html#restore-the-cluster-using-etcd-manager-ctl-on-your-computer">Restore the cluster using etcd-manager-ctl on your computer.</a>
          </li>
          <li>
            <a href="/disaster-recovery.html#restore-process-inside-the-etcd-container-using-etcd-manager-ctl">Restore process inside the etcd container using etcd-manager-ctl.</a>
          </li>
        </ul>
      </li>
      <li>
        <a href="/disaster-recovery.html#cleanup">Cleanup</a>
      </li>
      <li>
        <a href="/disaster-recovery.html#possible-issues">Possible Issues</a>
      </li>
    </ul>
  </li>
</ul>
<ul>
  <li>
    <a href="/rotate-user-aws-credentials.html#rotate-user-aws-credentials">Rotate User AWS Credentials</a>
    <ul>
      <li>
        <ul>
          <li>
          </li>
          <li>
            <a href="/rotate-user-aws-credentials.html#2-identify-the-compromised-terraform-object">2. Identify the compromised terraform object</a>
          </li>
          <li>
            <a href="/rotate-user-aws-credentials.html#3-destroy-the-compromised-key">3. Destroy the compromised key</a>
          </li>
          <li>
            <a href="/rotate-user-aws-credentials.html#4-let-terraform-create-a-new-key">4. Let terraform create a new key</a>
          </li>
        </ul>
      </li>
    </ul>
  </li>
</ul>
<ul>
  <li>
    <a href="/aws-leaked-credentials.html#aws-compromised-credentials">AWS Compromised Credentials</a>
    <ul>
      <li>
        <a href="/aws-leaked-credentials.html#steps-for-a-leaked-credentials">Steps for a leaked credentials</a>
      </li>
      <li>
        <a href="/aws-leaked-credentials.html#getting-new-credentials">Getting new credentials</a>
      </li>
    </ul>
  </li>
</ul>
<ul>
  <li>
    <a href="/manually-delete-namespace-resources.html#manually-delete-namespace-resources">Manually Delete Namespace Resources</a>
  </li>
</ul>
<ul>
  <li>
    <a href="/delete-live-0-namespace-resources.html#delete-live-0-namespace-resources">Delete Live-0 Namespace Resources</a>
    <ul>
      <li>
        <a href="/delete-live-0-namespace-resources.html#live-0-delete-script-branch">live-0-delete-script branch</a>
      </li>
      <li>
        <a href="/delete-live-0-namespace-resources.html#delete-live-0-namespace-resources-process">Process</a>
        <ul>
          <li>
            <a href="/delete-live-0-namespace-resources.html#deleting-a-production-namespace">Deleting a Production Namespace</a>
          </li>
        </ul>
      </li>
    </ul>
  </li>
</ul>
<ul>
  <li>
    <a href="/remove-orphaned-namespace.html#remove-39-orphaned-39-namespaces-and-aws-resources">Remove ‘orphaned’ namespaces and AWS resources</a>
    <ul>
      <li>
        <ul>
          <li>
            <a href="/remove-orphaned-namespace.html#1-git-clone-the-environments-checker-repository">1. git clone the environments checker repository</a>
          </li>
          <li>
            <a href="/remove-orphaned-namespace.html#2-create-a-env-live1-file-containing-the-environment-variables-the-checker-requires">2. Create a .env.live1 file, containing the environment variables the checker requires</a>
          </li>
          <li>
            <a href="/remove-orphaned-namespace.html#3-do-a-dry-run-of-deleting-the-target-namespace">3. Do a dry run of deleting the target namespace</a>
          </li>
          <li>
            <a href="/remove-orphaned-namespace.html#4-delete-the-aws-resources-and-the-cluster-namespace">4. Delete the AWS resources and the cluster namespace</a>
          </li>
        </ul>
      </li>
      <li>
        <a href="/remove-orphaned-namespace.html#possible-errors">Possible Errors</a>
      </li>
    </ul>
  </li>
</ul>
<ul>
  <li>
    <a href="/error-refreshing-state.html#terraform-state-lock-error-refreshing-state">Terraform state lock - Error refreshing state</a>
  </li>
</ul>
<ul>
  <li>
    <a href="/replacing-master-node.html#replacing-a-master-node">Replacing a master node</a>
    <ul>
      <li>
        <a href="/replacing-master-node.html#replacing-a-master-node-pre-requisites">Pre-requisites</a>
      </li>
      <li>
        <a href="/replacing-master-node.html#identify-the-failed-master-node">Identify the failed master node</a>
      </li>
      <li>
        <a href="/replacing-master-node.html#remove-the-unhealthy-master-node">Remove the unhealthy master node.</a>
      </li>
      <li>
        <a href="/replacing-master-node.html#replacing-the-master-via-kops">Replacing the master via kops</a>
      </li>
      <li>
        <a href="/replacing-master-node.html#etcd-volumes">etcd volumes</a>
      </li>
    </ul>
  </li>
</ul>
<ul>
  <li>
    <a href="/recycle-node.html#recycle-node">Recycle-node</a>
    <ul>
      <li>
        <a href="/recycle-node.html#guidance-for-cloud-platform-team-when-recycle-node-pipeline-job-fails">Guidance for cloud-platform team, when recycle-node pipeline job fails:</a>
      </li>
    </ul>
  </li>
</ul>
<ul>
  <li>
    <a href="/eks-tools-cluster.html#provisioning-eks-clusters">Provisioning EKS clusters</a>
    <ul>
      <li>
        <a href="/eks-tools-cluster.html#provisioning-eks-clusters-pre-requisites">Pre-requisites</a>
      </li>
      <li>
        <a href="/eks-tools-cluster.html#provisioning">Provisioning</a>
        <ul>
          <li>
            <a href="/eks-tools-cluster.html#1-vpc">1. VPC</a>
          </li>
          <li>
            <a href="/eks-tools-cluster.html#2-creating-eks-cluster">2. Creating EKS cluster</a>
          </li>
          <li>
            <a href="/eks-tools-cluster.html#3-deploy-components">3. Deploy components</a>
          </li>
        </ul>
      </li>
      <li>
        <a href="/eks-tools-cluster.html#todo">TODO</a>
      </li>
    </ul>
  </li>
</ul>
<ul>
  <li>
    <a href="/post-migration.html#post-migration-cleanup">Post migration cleanup</a>
    <ul>
      <li>
        <a href="/post-migration.html#table-of-contents">Table of contents</a>
      </li>
      <li>
        <a href="/post-migration.html#when-to-use-this-document">When to use this document?</a>
      </li>
      <li>
        <a href="/post-migration.html#0-pre-requisites">0 Pre-requisites</a>
        <ul>
          <li>
          </li>
        </ul>
      </li>
      <li>
        <a href="/post-migration.html#1-turn-off-template-deploy-monitoring-and-alerting">1 Turn off Template Deploy monitoring and alerting</a>
        <ul>
          <li>
          </li>
        </ul>
      </li>
      <li>
        <a href="/post-migration.html#2-archive-the-deployment-repository">2 Archive the deployment repository</a>
        <ul>
          <li>
          </li>
        </ul>
      </li>
      <li>
        <a href="/post-migration.html#3-backup-old-template-deploy-data">3 Backup old Template Deploy data</a>
        <ul>
          <li>
          </li>
        </ul>
      </li>
      <li>
        <a href="/post-migration.html#4-delete-the-old-cloudformation-stack">4 Delete the old CloudFormation stack</a>
        <ul>
          <li>
          </li>
        </ul>
      </li>
      <li>
        <a href="/post-migration.html#5-ensure-removal-of-resources">5 Ensure removal of resources</a>
        <ul>
          <li>
          </li>
        </ul>
      </li>
      <li>
        <a href="/post-migration.html#6-ensure-live-service-is-still-functioning">6 Ensure live service is still functioning!</a>
        <ul>
          <li>
          </li>
        </ul>
      </li>
    </ul>
  </li>
</ul>
<ul>
  <li>
    <a href="/expand.html#expanding-persistent-volumes-created-using-statefulsets">Expanding Persistent Volumes created using StatefulSets</a>
  </li>
</ul>
<ul>
  <li>
    <a href="/velero.html#velero-cluster-backups-and-disaster-recovery">Velero - Cluster backups and disaster recovery</a>
    <ul>
      <li>
        <ul>
          <li>
          </li>
        </ul>
      </li>
      <li>
        <a href="/velero.html#backups">Backups</a>
        <ul>
          <li>
            <a href="/velero.html#why">Why?</a>
          </li>
          <li>
            <a href="/velero.html#what">What?</a>
          </li>
          <li>
            <a href="/velero.html#how">How?</a>
          </li>
        </ul>
      </li>
    </ul>
  </li>
</ul>
<ul>
  <li>
    <a href="/running-kops-update-rollingupdate.html#running-kops-update-and-rollingupdate">Running Kops Update and Rollingupdate</a>
    <ul>
      <li>
        <a href="/running-kops-update-rollingupdate.html#using-kops-to-change-the-cluster">Using kops to change the cluster</a>
      </li>
      <li>
        <a href="/running-kops-update-rollingupdate.html#running-kops-update-and-rollingupdate-pre-requisites">Pre-requisites</a>
      </li>
      <li>
        <a href="/running-kops-update-rollingupdate.html#updating-the-kops-state">Updating the kops state</a>
        <ul>
          <li>
            <a href="/running-kops-update-rollingupdate.html#generating-an-updated-kops-config-file">Generating an updated kops config file</a>
          </li>
          <li>
            <a href="/running-kops-update-rollingupdate.html#applying-local-changes-to-the-kops-state-store">Applying local changes to the kops state store</a>
          </li>
        </ul>
      </li>
      <li>
        <a href="/running-kops-update-rollingupdate.html#running-kops-update">Running Kops update</a>
      </li>
      <li>
        <a href="/running-kops-update-rollingupdate.html#running-kops-rolling-update">Running Kops rolling-update</a>
      </li>
      <li>
        <a href="/running-kops-update-rollingupdate.html#running-kops-update-and-rollingupdate-possible-errors">Possible Errors</a>
      </li>
    </ul>
  </li>
</ul>
<ul>
  <li>
    <a href="/add-new-opa-policy.html#open-policy-agent-policies">Open Policy Agent policies</a>
    <ul>
      <li>
        <a href="/add-new-opa-policy.html#adding-a-policy">Adding a policy</a>
      </li>
      <li>
        <a href="/add-new-opa-policy.html#writing-tests">Writing tests</a>
      </li>
      <li>
        <a href="/add-new-opa-policy.html#references">References</a>
      </li>
    </ul>
  </li>
</ul>
<ul>
  <li>
    <a href="/joiners-guide.html#joiners-guide">Joiners Guide</a>
    <ul>
      <li>
        <a href="/joiners-guide.html#people-team">People Team</a>
      </li>
      <li>
        <a href="/joiners-guide.html#service-desk">Service Desk</a>
      </li>
      <li>
        <a href="/joiners-guide.html#sit-down-with-dm">SIT down with DM</a>
      </li>
      <li>
        <a href="/joiners-guide.html#cloud-platform-team">Cloud Platform team</a>
      </li>
      <li>
        <a href="/joiners-guide.html#access">ACCESS</a>
      </li>
    </ul>
  </li>
</ul>
<ul>
  <li>
    <a href="/leavers-guide.html#leavers-guide">Leavers Guide</a>
    <ul>
      <li>
        <a href="/leavers-guide.html#revoking-access">Revoking Access</a>
        <ul>
          <li>
            <a href="/leavers-guide.html#digital-services">Digital Services</a>
          </li>
          <li>
            <a href="/leavers-guide.html#cloud-platforms">Cloud Platforms</a>
          </li>
          <li>
            <a href="/leavers-guide.html#template-deploy-cloud-platforms">Template Deploy - Cloud Platforms</a>
          </li>
        </ul>
      </li>
    </ul>
  </li>
</ul>
<ul>
  <li>
    <a href="/on-call.html#going-on-call">Going on call</a>
    <ul>
      <li>
        <a href="/on-call.html#what-s-expected">What’s expected?</a>
        <ul>
          <li>
            <a href="/on-call.html#expected">Expected:</a>
          </li>
          <li>
            <a href="/on-call.html#not-expected">Not Expected:</a>
          </li>
        </ul>
      </li>
      <li>
        <a href="/on-call.html#where-do-i-start">Where do I start?</a>
      </li>
      <li>
        <a href="/on-call.html#what-do-i-get-for-being-on-call">What do I get for being on call?</a>
      </li>
      <li>
        <a href="/on-call.html#civil-servants-sop-claim">Civil servants - SOP Claim</a>
      </li>
      <li>
        <a href="/on-call.html#civil-servants-sop-problem-resolution">Civil servants - SOP Problem Resolution</a>
      </li>
      <li>
        <a href="/on-call.html#contractors">Contractors</a>
      </li>
    </ul>
  </li>
</ul>
<ul>
  <li>
    <a href="/manual-ssl-certificate-processes.html#create-manual-ssl-certificate-processes">Create Manual SSL Certificate Processes</a>
    <ul>
      <li>
        <a href="/manual-ssl-certificate-processes.html#create-manual-ssl-certificate-processes-pre-requisites">Pre-requisites</a>
      </li>
      <li>
        <a href="/manual-ssl-certificate-processes.html#requesting-a-new-certificate-via-gandi-net">Requesting a new certificate via Gandi.net</a>
      </li>
      <li>
        <a href="/manual-ssl-certificate-processes.html#renewing-a-new-certificate-via-gandi-net">Renewing a new certificate via Gandi.net</a>
      </li>
      <li>
        <a href="/manual-ssl-certificate-processes.html#revoking-gandi-net-certificates">Revoking Gandi.net certificates</a>
      </li>
      <li>
        <a href="/manual-ssl-certificate-processes.html#costs-funding-information">Costs/Funding information</a>
      </li>
    </ul>
  </li>
</ul>
<ul>
  <li>
    <a href="/os-places-api-key-management.html#os-places-api-key-management">OS Places API Key Management</a>
    <ul>
      <li>
        <a href="/os-places-api-key-management.html#os-places-api-key-management-pre-requisites">Pre-requisites</a>
      </li>
      <li>
        <a href="/os-places-api-key-management.html#creating-a-new-api-key">Creating a new API key</a>
      </li>
      <li>
        <a href="/os-places-api-key-management.html#revoking-an-api-key">Revoking an API key</a>
      </li>
    </ul>
  </li>
</ul>
<ul>
  <li>
    <a href="/template-deploy-run-books.html#template-deploy-runbooks">Template-deploy Runbooks</a>
    <ul>
      <li>
        <a href="/template-deploy-run-books.html#general-incident-procedure">General Incident Procedure</a>
      </li>
      <li>
        <a href="/template-deploy-run-books.html#existing-runbooks">Existing Runbooks</a>
      </li>
    </ul>
  </li>
</ul>
<ul>
  <li>
    <a href="/tips-and-tricks.html#tips-and-tricks">Tips and Tricks</a>
    <ul>
      <li>
        <a href="/tips-and-tricks.html#check-the-expiration-date-of-the-ssl-certificate-for-a-live-domain">Check the expiration date of the SSL certificate for a live domain</a>
      </li>
      <li>
        <a href="/tips-and-tricks.html#run-etcdctl-on-a-master-node">Run etcdctl on a master node</a>
      </li>
      <li>
        <a href="/tips-and-tricks.html#delete-a-quot-stuck-quot-resource">Delete a “stuck” resource</a>
      </li>
      <li>
        <a href="/tips-and-tricks.html#filter-namespaces-by-specific-label-or-annotation">Filter namespaces by specific label or annotation</a>
      </li>
      <li>
        <a href="/tips-and-tricks.html#find-all-pods-running-on-a-specific-worker-node">Find all pods running on a specific worker node</a>
      </li>
      <li>
        <a href="/tips-and-tricks.html#install-tmux-and-docker-on-the-live-1-bastion-host">Install tmux and docker on the live-1 bastion host</a>
      </li>
      <li>
        <a href="/tips-and-tricks.html#output-all-records-from-route53-as-a-csv-file">Output all records from Route53 as a CSV file</a>
      </li>
    </ul>
  </li>
</ul>
<ul>
  <li>
    <a href="/add-a-new-runbook.html#add-a-new-runbook">Add a new runbook</a>
    <ul>
      <li>
        <ul>
          <li>
          </li>
        </ul>
      </li>
    </ul>
  </li>
</ul>


              </nav>
            </div>
          </div>

        <div class="app-pane__content toc-open-disabled">
          <main id="content" class="technical-documentation" data-module="anchored-headings">
              <h1 id="template-deploy-runbooks">Template-deploy Runbooks</h1><p>(to be de-commissioned as and when template-deploy support ceases)</p>
<p>Various procedures for supporting our production template-deploy services. If something goes wrong and you are on call you should be able to find the relevant information via the confluence links below</p>
<h2 id="general-incident-procedure">General Incident Procedure</h2><p>If there is a problem with one of these projects the general procedure is:</p>

<ul>
<li><p>Look at the problem and determine if the outage is a short blip or likely to last.</p>

<ul>
<li>If it’s just a blip then most likely nothing needs to be done.</li>
</ul></li>
<li><p>Put the holding page up</p>

<ul>
<li>Each project should have a ‘sorry the service is currently unavailable’ holding page served from an alternative infrastructure for this case. Check the project&rsquo;s github repository for instructions on how to enable it for that project.</li>
</ul></li>
<li><p>Email and notify people
Keep people informed about the problem, let them know what sort of problem it is (i.e. hosting supplier problem, VM problem, app problem etc.) and if the holding page is up or not.</p>

<ul>
<li>Each project should have an incident email list with everyone who needs to know about service outages. Check the project&rsquo;s github repository under here for that address.</li>
<li>Generally we should keep the project owner and delivery manager (if we have these details) informed about how long we think it will take to fix the problem and if it is something we can fix ourselves or if we need to log a call with a third-party. Check the relevant run-book and/or the project github pages for project owner/delivery manager details. Additional informational can also be found here <a href="https://docs.google.com/spreadsheets/d/1y4i5d4YYj8rnkGFLLCZcnj5_i_mwI1kQZz9rs0OgQDI/edit#gid=0">Products Hosted by Cloud Platform</a>, also <a href="https://dsdmoj.atlassian.net/wiki/spaces/PLAT/pages/298778707/Other+Services">Other Services</a> and <a href="https://dsdmoj.atlassian.net/wiki/spaces/PLAT/pages/324273043/Contact+Service+Managers+template-deploy">Contact Service Managers (template-deploy)</a></li>
<li>Notify the relevant team via their slack channel so that the team knows that something is wrong, and also the latest status of the problem.</li>
</ul></li>
<li><p>Diagnose the problem:</p>

<ul>
<li>Go to the alert URL. This may be found in different places depending on the alerting service and the nature of the alert. You might find it on the dashboard, in the <a href="https://moj-digital-tools.pagerduty.com/incidents">PagerDuty</a> or  <a href="https://mojdt.slack.com/messages/C8PF51AT0">Slack #high-priority-alarms messages</a>, or elsewhere. You may not find it at all.
NOTE: You may not get a correct URL. At the time of writing, preprod PVB only worked if called on /prisoner, but the alert shows the root URL.</li>
<li>Resolve the alert on pagerduty. You can do this by following the instruction in the text message on the Incident Response phone, or directly on PagerDuty. If you don’t, it will continue to re-alert.</li>
<li>Go to Pingdom &gt; Monitoring and filter on the Down status. Apply any other filters that help you find the issue.</li>
<li>Click on the issue to open the full report.</li>
<li>Go to the URL section, copy the URL and open it in a browser to check it.</li>
<li>If the URL works as expected, click Test Check to retest and reset Pingdom.</li>
<li>If the URL does not work, does not work as expected, or Pingdom will not reset, investigate and fix.</li>
</ul></li>
<li><p>Fix the problem and test the service is healthy again. Depending on the service, you may need to update your /etc/hosts file to gain access to the site (e.g. where you do not have access to the internal DNS, but the service is delivered via an Apache/Nginx vhost).</p></li>
<li><p>Take holding page down</p></li>
<li><p>Send a ‘resolved’ email and notify people</p></li>
<li><p>Send a final email to the project incident list to let everyone know that the service is back up.</p></li>
<li><ul>
<li>Notify the relevant team via their slack channel so that the team knows that the problem is resolved and the service is back up</li>
</ul></li>
</ul>
<h2 id="existing-runbooks">Existing Runbooks</h2>
<ul>
<li><p><a href="https://dsdmoj.atlassian.net/wiki/spaces/PLAT/pages/305627228/Accelerated+Possession+HMCTS+Supported">Accelerated Possession (HMCTS Supported)</a></p></li>
<li><p><a href="https://dsdmoj.atlassian.net/wiki/spaces/PLAT/pages/305529230/CLA+Support+Docs">CLA Support Docs</a></p></li>
<li><p><a href="https://dsdmoj.atlassian.net/wiki/spaces/PLAT/pages/305430680/Claim+for+Crown+Court+Defence">Claim for Crown Court Defence</a></p></li>
<li><p><a href="https://dsdmoj.atlassian.net/wiki/spaces/PLAT/pages/684261967/Correspondence+Tool+Public+-+Technical+Runbook">Correspondence Tool Public - Technical Runbook</a></p></li>
<li><p><a href="https://dsdmoj.atlassian.net/wiki/spaces/PLAT/pages/630948000/Correspondence+Tool+Staff+-+Technical+Runbook">Correspondence Tool Staff - Technical Runbook</a></p></li>
<li><p><a href="https://dsdmoj.atlassian.net/wiki/spaces/PLAT/pages/305398124">Courtfinder (HMCTS Supported)</a></p></li>
<li><p><a href="https://dsdmoj.atlassian.net/wiki/spaces/PLAT/pages/305430820/Docker+Registry">Docker Registry</a></p></li>
<li><p><a href="https://dsdmoj.atlassian.net/wiki/spaces/PLAT/pages/305529326/Docker+Upgrade">Docker Upgrade</a></p></li>
<li><p><a href="https://dsdmoj.atlassian.net/wiki/spaces/PLAT/pages/305430833/ELK">ELK</a></p></li>
<li><p><a href="https://dsdmoj.atlassian.net/wiki/spaces/PLAT/pages/305627462">Employment Tribunals (HMCTS Supported)</a></p></li>
<li><p><a href="https://dsdmoj.atlassian.net/wiki/spaces/PLAT/pages/324043428/General+Incident+Procedure">General Incident Procedure</a></p></li>
<li><p><a href="https://dsdmoj.atlassian.net/wiki/spaces/PLAT/pages/320668071/Graphite">Graphite</a></p></li>
<li><p><a href="https://dsdmoj.atlassian.net/wiki/spaces/PLAT/pages/324239389">Help with Fees (HMCTS Supported)</a></p></li>
<li><p><a href="https://dsdmoj.atlassian.net/wiki/spaces/PLAT/pages/324239551/Jenkins">Jenkins</a></p></li>
<li><p><a href="https://dsdmoj.atlassian.net/wiki/spaces/PLAT/pages/324075646/LAALAA+Support+Docs">LAALAA Support Docs</a></p></li>
<li><p><a href="https://dsdmoj.atlassian.net/wiki/spaces/PLAT/pages/324042897">Make-a-plea (HMCTS Supported)</a></p></li>
<li><p><a href="https://dsdmoj.atlassian.net/wiki/spaces/PLAT/pages/324272360">MOJ Sign On (Heroku)</a></p></li>
<li><p><a href="https://dsdmoj.atlassian.net/wiki/spaces/PLAT/pages/324141273/Money+to+Prisoners">Money to Prisoners</a></p></li>
<li><p><a href="https://dsdmoj.atlassian.net/wiki/spaces/PLAT/pages/324272622/Moving+People+Safely">Moving People Safely</a></p></li>
<li><p><a href="https://dsdmoj.atlassian.net/wiki/spaces/PLAT/pages/324174116">NOMIS API (Basic Support)</a></p></li>
<li><p><a href="https://dsdmoj.atlassian.net/wiki/spaces/PLAT/pages/324239762/Opsmanual">Opsmanual</a></p></li>
<li><p><a href="https://dsdmoj.atlassian.net/wiki/spaces/PLAT/pages/324043218">Parliamentary Questions (Unofficial Support)</a></p></li>
<li><p><a href="https://dsdmoj.atlassian.net/wiki/spaces/PLAT/pages/324043234/People+Finder">People Finder</a></p></li>
<li><p><a href="https://dsdmoj.atlassian.net/wiki/spaces/PLAT/pages/324239849/PFLR+CAIT+Support+Docs">PFLR CAIT Support Docs</a></p></li>
<li><p><a href="https://dsdmoj.atlassian.net/wiki/spaces/PLAT/pages/324010630/Postcode+Info">Postcode Info</a></p></li>
<li><p><a href="https://dsdmoj.atlassian.net/wiki/spaces/PLAT/pages/324075878/Prison+Visits+Booking">Prison Visits Booking</a></p></li>
<li><p><a href="https://dsdmoj.atlassian.net/wiki/spaces/PLAT/pages/324272772/Sensu">Sensu</a></p></li>
<li><p><a href="https://dsdmoj.atlassian.net/wiki/spaces/PLAT/pages/324272831/Status">Status</a></p></li>
<li><p><a href="https://dsdmoj.atlassian.net/wiki/spaces/PLAT/pages/324174549">Tax tribunals stacks (Unofficial Support)</a></p></li>
<li><p><a href="https://dsdmoj.atlassian.net/wiki/spaces/PLAT/pages/324043410">Victims Information Service (HMCTS Supported)</a></p></li>
</ul>


              <div data-module='page-expiry' data-last-reviewed-on="2019-12-10">
    <div class='page-expiry--not-expired'>
      This page was last reviewed on 10 September 2019.

        It needs to be reviewed again on 10 December 2019
        by the page owner <a href="https://mojdt.slack.com/messages/cloud-platform">#cloud-platform</a>
        .
    </div>

    <div class='page-expiry--expired'>
      This page was set to be reviewed before 10 December 2019
       by the page owner <a href="https://mojdt.slack.com/messages/cloud-platform">#cloud-platform</a>.
      This might mean the content is out of date.
    </div>
  </div>

          </main>

            <ul class="contribution-banner">
              <li><a href="https://github.com/ministryofjustice/cloud-platform/blob/master/source/template-deploy-run-books.html.md.erb">View source</a></li>
              <li><a href="https://github.com/ministryofjustice/cloud-platform/issues/new?labels=bug&amp;title=Re:%20'Template-deploy%20Run-books'&amp;body=Problem%20with%20'Template-deploy%20Run-books'%20(https://runbooks.cloud-platform.service.justice.gov.uk/template-deploy-run-books.html)">Report problem</a></li>
              <li><a href="https://github.com/ministryofjustice/cloud-platform">GitHub Repo</a></li>
            </ul>

          <footer class="footer">
  <div class="footer__licence">
    <a class="footer__licence-logo" href="https://www.nationalarchives.gov.uk/doc/open-government-licence/version/3/" rel="license">Open Government Licence</a>
    <p class="footer__licence-description">All content is available under the <a href="https://www.nationalarchives.gov.uk/doc/open-government-licence/version/3/" rel="license">Open Government Licence v3.0</a>, except where otherwise stated</p>
  </div>

  <div class="footer__copyright">
    <a class="footer__copyright-logo" href="http://www.nationalarchives.gov.uk/information-management/re-using-public-sector-information/copyright-and-re-use/crown-copyright/">© Crown copyright</a>
  </div>
</footer>

        </div>
      </div>
    </div>

    
  </body>
</html>
