<!doctype html>
<html lang="en" class="govuk-template no-js">
  <head>
    <meta content="IE=edge" http-equiv="X-UA-Compatible">
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover">

    <title>Upgrade Terraform Version - Cloud Platform Runbooks</title>

    <link href="stylesheets/manifest.css" rel="stylesheet" />

    <link rel="canonical" href="https://runbooks.cloud-platform.service.justice.gov.uk/upgrade-terraform-version.html">

      <meta name="robots" content="noindex" />
      <meta name="twitter:card" content="summary" />
      <meta name="twitter:domain" content="runbooks.cloud-platform.service.justice.gov.uk" />
      <meta name="twitter:image" content="https://runbooks.cloud-platform.service.justice.gov.uk/images/govuk-large.png" />
      <meta name="twitter:title" content="Upgrade Terraform Version - Cloud Platform Runbooks" />
      <meta name="twitter:url" content="https://runbooks.cloud-platform.service.justice.gov.uk/upgrade-terraform-version.html" />

      <meta property="og:image" content="https://runbooks.cloud-platform.service.justice.gov.uk/images/govuk-large.png" />
      <meta property="og:site_name" content="Cloud Platform Runbooks" />
      <meta property="og:title" content="Upgrade Terraform Version" />
      <meta property="og:type" content="object" />
      <meta property="og:url" content="https://runbooks.cloud-platform.service.justice.gov.uk/upgrade-terraform-version.html" />

    
  </head>

  <body class="govuk-template__body">
    <script>document.body.className = ((document.body.className) ? document.body.className + ' js-enabled' : 'js-enabled');</script>

    <div class="app-pane">
      <div class="app-pane__header toc-open-disabled">
        <a href="#content" class="govuk-skip-link" data-module="govuk-skip-link">Skip to main content</a>

        <header class="govuk-header app-header" role="banner" data-module="govuk-header">
  <div class="govuk-header__container govuk-header__container--full-width">
    <div class="govuk-header__logo">
      <a href="./" class="govuk-header__link govuk-header__link--homepage">
        <span class="govuk-header__product-name">
          Cloud Platform Runbooks
        </span>
      </a>
    </div>
    <div class="govuk-header__content">
      <nav class="govuk-header__navigation govuk-header__navigation--end" aria-label="Menu">
        <button type="button" class="govuk-header__menu-button govuk-js-header-toggle" aria-controls="navigation" aria-label="Show or hide menu">Menu</button>
        <ul id="navigation" class="govuk-header__navigation-list">
            <li class="govuk-header__navigation-item">
              <a class="govuk-header__link" href="mailto:platforms+runbooks@digital.justice.gov.uk?subject=Runbooks+feedback">Feedback / Report a problem</a>
            </li>
            <li class="govuk-header__navigation-item">
              <a class="govuk-header__link" href="./">Documentation</a>
            </li>
            <li class="govuk-header__navigation-item">
              <a class="govuk-header__link" href="https://github.com/ministryofjustice/cloud-platform/tree/main/runbooks">GitHub</a>
            </li>
        </ul>
      </nav>
    </div>
  </div>
</header>

      </div>

        <div id="toc-heading" class="toc-show fixedsticky">
          <button type="button" class="toc-show__label js-toc-show" aria-controls="toc">
            Table of contents <span class="toc-show__icon"></span>
          </button>
        </div>

      <div class="app-pane__body" data-module="in-page-navigation">
          <div class="app-pane__toc">
            <div class="toc" data-module="table-of-contents" tabindex="-1" aria-label="Table of contents" role="dialog">
              <div class="search" data-module="search" data-path-to-site-root="./">
  <form action="https://www.google.co.uk/search" method="get" role="search" class="search__form govuk-!-margin-bottom-4">
    <input type="hidden" name="as_sitesearch" value="https://runbooks.cloud-platform.service.justice.gov.uk"/>
    <label class="govuk-label search__label" for="search" aria-hidden="true">
      Search (via Google)
    </label>
    <input
      type="text"
      id="search" name="q"
      class="govuk-input govuk-!-margin-bottom-0 search__input"
      aria-controls="search-results"
      placeholder="Search">
    <button type="submit" class="search__button">Search</button>
  </form>
</div>

              <button type="button" class="toc__close js-toc-close" aria-controls="toc" aria-label="Hide table of contents"></button>
              <nav id="toc" class="js-toc-list toc__list" aria-labelledby="toc-heading" data-module="collapsible-navigation">
                      <ul>
  <li>
    <a href="./index.html"><span>Cloud Platform Runbooks</span></a>
  </li>
  <li>
    <a href="./cloud-platform-alliance.html"><span>Cloud Platform Team Alliance</span></a>
  </li>
  <li>
    <a href="./how-we-work.html"><span>How We Work</span></a>
    <ul>
      <li>
        <a href="./how-we-work.html#getting-help"><span>Getting Help</span></a>
      </li>
      <li>
        <a href="./how-we-work.html#sprints-and-ceremonies"><span>Sprints and ceremonies</span></a>
        <ul>
          <li>
            <a href="./how-we-work.html#firebreak"><span>Firebreak</span></a>
          </li>
        </ul>
      </li>
      <li>
        <a href="./how-we-work.html#story"><span>Story</span></a>
        <ul>
          <li>
            <a href="./how-we-work.html#story-points"><span>Story points</span></a>
          </li>
        </ul>
      </li>
      <li>
        <a href="./how-we-work.html#the-board-tickets"><span>The Board / Tickets</span></a>
        <ul>
          <li>
            <a href="./how-we-work.html#adding-tickets"><span>Adding tickets</span></a>
          </li>
          <li>
            <a href="./how-we-work.html#making-changes-to-code"><span>Making changes to code</span></a>
          </li>
          <li>
            <a href="./how-we-work.html#reviewing-merging-prs"><span>Reviewing/Merging PRs</span></a>
          </li>
        </ul>
      </li>
      <li>
        <a href="./how-we-work.html#support-squad"><span>Support Squad</span></a>
        <ul>
          <li>
            <a href="./how-we-work.html#the-hammer-of-justice"><span>The üî® Hammer of Justice</span></a>
          </li>
          <li>
            <a href="./how-we-work.html#support-squad-support-tickets"><span>Support Tickets</span></a>
          </li>
        </ul>
      </li>
      <li>
        <a href="./how-we-work.html#documentation"><span>Documentation</span></a>
      </li>
    </ul>
  </li>
  <li>
    <a href="./incident-process.html"><span>Incident Process</span></a>
    <ul>
      <li>
        <a href="./incident-process.html#1-confirm-that-the-event-constitutes-an-incident"><span>1. Confirm that the event constitutes an incident</span></a>
      </li>
      <li>
        <a href="./incident-process.html#2-declare-the-incident"><span>2. Declare the incident</span></a>
        <ul>
          <li>
            <a href="./incident-process.html#examples"><span>Examples</span></a>
          </li>
        </ul>
      </li>
      <li>
        <a href="./incident-process.html#3-assign-roles"><span>3. Assign roles</span></a>
        <ul>
          <li>
            <a href="./incident-process.html#3-1-incident-lead"><span>3.1 Incident Lead</span></a>
          </li>
          <li>
            <a href="./incident-process.html#3-2-scribe"><span>3.2 Scribe</span></a>
          </li>
          <li>
            <a href="./incident-process.html#3-3-communications-lead"><span>3.3 Communications Lead</span></a>
          </li>
          <li>
            <a href="./incident-process.html#transferring-roles"><span>Transferring roles</span></a>
          </li>
        </ul>
      </li>
      <li>
        <a href="./incident-process.html#4-fix-the-problem"><span>4. Fix the problem</span></a>
      </li>
      <li>
        <a href="./incident-process.html#5-end-the-incident"><span>5. End the incident</span></a>
      </li>
      <li>
        <a href="./incident-process.html#6-post-incident-procedure"><span>6. Post-incident procedure</span></a>
      </li>
    </ul>
  </li>
  <li>
    <a href="./incident-log.html"><span>Incident Log</span></a>
    <ul>
      <li>
        <a href="./incident-log.html#q3-2024-july-september"><span>Q3 2024 (July-September)</span></a>
        <ul>
          <li>
            <a href="./incident-log.html#incident-on-2024-07-25"><span>Incident on 2024-07-25</span></a>
          </li>
        </ul>
      </li>
      <li>
        <a href="./incident-log.html#q1-2024-january-april"><span>Q1 2024 (January-April)</span></a>
        <ul>
          <li>
            <a href="./incident-log.html#incident-on-2024-04-15-prometheus-restarted-during-wal-reload-several-times-which-resulted-in-missing-metrics"><span>Incident on 2024-04-15 - Prometheus restarted during WAL reload several times which resulted in missing metrics</span></a>
          </li>
        </ul>
      </li>
      <li>
        <a href="./incident-log.html#q4-2023-october-december"><span>Q4 2023 (October-December)</span></a>
        <ul>
          <li>
            <a href="./incident-log.html#incident-on-2023-11-01-10-41-prometheus-restarted-several-times-which-resulted-in-missing-metrics"><span>Incident on 2023-11-01 10:41 - Prometheus restarted several times which resulted in missing metrics</span></a>
          </li>
        </ul>
      </li>
      <li>
        <a href="./incident-log.html#q3-2023-july-september"><span>Q3 2023 (July-September)</span></a>
        <ul>
          <li>
            <a href="./incident-log.html#incident-on-2023-09-18-15-12-lack-of-disk-space-on-nodes"><span>Incident on 2023-09-18 15:12 - Lack of Disk space on nodes</span></a>
          </li>
          <li>
            <a href="./incident-log.html#incident-on-2023-08-04-10-09-dropped-logging-in-kibana"><span>Incident on 2023-08-04 10:09 - Dropped logging in kibana</span></a>
          </li>
          <li>
            <a href="./incident-log.html#incident-on-2023-07-25-15-21-prometheus-on-live-cluster-down"><span>Incident on 2023-07-25 15:21 - Prometheus on live cluster DOWN</span></a>
          </li>
          <li>
            <a href="./incident-log.html#incident-on-2023-07-21-09-31-vpc-cni-not-allocating-ip-addresses"><span>Incident on 2023-07-21 09:31 - VPC CNI not allocating IP addresses</span></a>
          </li>
        </ul>
      </li>
      <li>
        <a href="./incident-log.html#q2-2023-april-june"><span>Q2 2023 (April-June)</span></a>
        <ul>
          <li>
            <a href="./incident-log.html#incident-on-2023-06-06-11-00-user-services-down"><span>Incident on 2023-06-06 11:00 - User services down</span></a>
          </li>
        </ul>
      </li>
      <li>
        <a href="./incident-log.html#q1-2023-january-march"><span>Q1 2023 (January-March)</span></a>
        <ul>
          <li>
            <a href="./incident-log.html#incident-on-2023-02-02-10-21-cjs-dashboard-performance"><span>Incident on 2023-02-02 10:21 - CJS Dashboard Performance</span></a>
          </li>
          <li>
            <a href="./incident-log.html#incident-on-2023-01-11-14-22-cluster-image-pull-failure-due-to-dockerhub-password-rotation"><span>Incident on 2023-01-11 14:22 - Cluster image pull failure due to DockerHub password rotation</span></a>
          </li>
          <li>
            <a href="./incident-log.html#incident-on-2023-01-05-08-56-circleci-security-incident"><span>Incident on 2023-01-05 08:56 - CircleCI Security Incident</span></a>
          </li>
        </ul>
      </li>
      <li>
        <a href="./incident-log.html#q4-2022-october-december"><span>Q4 2022 (October-December)</span></a>
        <ul>
          <li>
            <a href="./incident-log.html#incident-on-2022-11-15-16-03-prometheus-eks-live-down"><span>Incident on 2022-11-15 16:03 - Prometheus eks-live DOWN.</span></a>
          </li>
        </ul>
      </li>
      <li>
        <a href="./incident-log.html#q3-2022-july-september"><span>Q3 2022 (July-September)</span></a>
        <ul>
          <li>
            <a href="./incident-log.html#incident-on-2022-07-11-09-33-slow-performance-for-25-of-ingress-traffic"><span>Incident on 2022-07-11 09:33 - Slow performance for 25% of ingress traffic</span></a>
          </li>
        </ul>
      </li>
      <li>
        <a href="./incident-log.html#q1-2022-january-to-march"><span>Q1 2022 (January to March)</span></a>
        <ul>
          <li>
            <a href="./incident-log.html#incident-on-2022-03-10-11-48-all-ingress-resources-using-apps-live-cloud-platform-urls-showing-certificate-issue"><span>Incident on 2022-03-10 11:48 - All ingress resources using *.apps.live.cloud-platform urls showing certificate issue</span></a>
          </li>
          <li>
            <a href="./incident-log.html#incident-on-2022-01-22-11-57-some-dns-records-got-deleted-at-the-weekend"><span>Incident on 2022-01-22 11:57 - some DNS records got deleted at the weekend</span></a>
          </li>
        </ul>
      </li>
      <li>
        <a href="./incident-log.html#q4-2021-october-to-december"><span>Q4 2021 (October to December)</span></a>
        <ul>
          <li>
            <a href="./incident-log.html#incident-on-2021-11-05-modsec-ingress-controller-is-erroring"><span>Incident on 2021-11-05 - ModSec ingress controller is erroring</span></a>
          </li>
        </ul>
      </li>
      <li>
        <a href="./incident-log.html#q3-2021-july-september"><span>Q3 2021 (July-September)</span></a>
        <ul>
          <li>
            <a href="./incident-log.html#incident-on-2021-09-30-ssl-certificate-issue-in-browsers"><span>Incident on 2021-09-30 - SSL Certificate Issue in browsers</span></a>
          </li>
          <li>
            <a href="./incident-log.html#incident-on-2021-09-04-22-05-pingdom-check-prometheus-cloud-platform-healthcheck-is-down"><span>Incident on 2021-09-04 22:05 - Pingdom check Prometheus Cloud-Platform - Healthcheck is DOWN</span></a>
          </li>
          <li>
            <a href="./incident-log.html#incident-on-2021-07-12-15-24-all-ingress-resources-using-apps-live-1-domain-names-stop-working"><span>Incident on 2021-07-12 15:24 - All ingress resources using *apps.live-1 domain names stop working</span></a>
          </li>
        </ul>
      </li>
      <li>
        <a href="./incident-log.html#q2-2021-april-june"><span>Q2 2021 (April-June)</span></a>
        <ul>
          <li>
            <a href="./incident-log.html#incident-on-2021-06-09-12-47-all-users-are-unable-to-create-new-ingress-rules-following-bad-modsec-ingress-controller-upgrade"><span>Incident on 2021-06-09 12:47 - All users are unable to create new ingress rules, following bad ModSec Ingress-controller upgrade</span></a>
          </li>
          <li>
            <a href="./incident-log.html#incident-on-2021-05-10-12-15-apply-pipeline-downtime-due-to-accidental-destroy-of-manager-cluster"><span>Incident on 2021-05-10 12:15 - Apply Pipeline downtime due to accidental destroy of Manager cluster</span></a>
          </li>
        </ul>
      </li>
      <li>
        <a href="./incident-log.html#q1-2021-january-march"><span>Q1 2021 (January - March)</span></a>
        <ul>
          <li>
            <a href="./incident-log.html#no-incidents-declared"><span>No incidents declared</span></a>
          </li>
        </ul>
      </li>
      <li>
        <a href="./incident-log.html#q4-2020-october-december"><span>Q4 2020 (October - December)</span></a>
        <ul>
          <li>
            <a href="./incident-log.html#incident-on-2020-10-06-09-07-intermittent-quot-micro-downtimes-quot-on-various-services-using-dedicated-ingress-controllers"><span>Incident on 2020-10-06 09:07 - Intermittent ‚Äúmicro-downtimes‚Äù on various services using dedicated ingress controllers</span></a>
          </li>
        </ul>
      </li>
      <li>
        <a href="./incident-log.html#q3-2020-july-september"><span>Q3 2020 (July - September)</span></a>
        <ul>
          <li>
            <a href="./incident-log.html#incident-on-2020-09-28-13-10-termination-of-nodes-updating-kops-instance-group"><span>Incident on 2020-09-28 13:10 - Termination of nodes updating kops Instance Group.</span></a>
          </li>
          <li>
            <a href="./incident-log.html#incident-on-2020-09-21-18-27-some-cloud-platform-components-destroyed"><span>Incident on 2020-09-21 18:27 - Some cloud-platform components destroyed.</span></a>
          </li>
          <li>
            <a href="./incident-log.html#incident-on-2020-09-07-12-54-all-users-are-unable-to-create-new-ingress-rules"><span>Incident on 2020-09-07 12:54 - All users are unable to create new ingress rules</span></a>
          </li>
          <li>
            <a href="./incident-log.html#incident-on-2020-08-25-11-26-connectivity-issues-with-eu-west-2a"><span>Incident on 2020-08-25 11:26 - Connectivity issues with eu-west-2a</span></a>
          </li>
          <li>
            <a href="./incident-log.html#incident-on-2020-08-14-11-01-ingress-controllers-crashlooping"><span>Incident on 2020-08-14 11:01 - Ingress-controllers crashlooping</span></a>
          </li>
          <li>
            <a href="./incident-log.html#incident-on-2020-08-07-16-39-master-node-provisioning-failure"><span>Incident on 2020-08-07 16:39 - Master node provisioning failure</span></a>
          </li>
        </ul>
      </li>
      <li>
        <a href="./incident-log.html#q2-2020-april-june"><span>Q2 2020 (April - June)</span></a>
        <ul>
          <li>
            <a href="./incident-log.html#incident-on-2020-08-04-17-13"><span>Incident on 2020-08-04 17:13</span></a>
          </li>
          <li>
            <a href="./incident-log.html#incident-on-2020-04-15-10-58-nginx-tls"><span>Incident on 2020-04-15 10:58 Nginx/TLS</span></a>
          </li>
        </ul>
      </li>
      <li>
        <a href="./incident-log.html#q1-2020-january-march"><span>Q1 2020 (January - March)</span></a>
        <ul>
          <li>
            <a href="./incident-log.html#incident-on-2020-02-25-10-58"><span>Incident on 2020-02-25 10:58</span></a>
          </li>
          <li>
            <a href="./incident-log.html#incident-on-2020-02-18-14-13-utc"><span>Incident on 2020-02-18 14:13 UTC</span></a>
          </li>
          <li>
            <a href="./incident-log.html#incident-on-2020-02-12-11-45-utc"><span>Incident on 2020-02-12 11:45 UTC</span></a>
          </li>
        </ul>
      </li>
      <li>
        <a href="./incident-log.html#about-this-incident-log"><span>About this incident log</span></a>
      </li>
      <li>
        <a href="./incident-log.html#template"><span>Template</span></a>
        <ul>
          <li>
            <a href="./incident-log.html#incident-on-yyyy-mm-dd-hh-mm-brief-description"><span>Incident on YYYY-MM-DD HH:MM - [Brief description]</span></a>
          </li>
        </ul>
      </li>
      <li>
        <a href="./incident-log.html#impact"><span>Impact:</span></a>
      </li>
      <li>
        <a href="./incident-log.html#context"><span>Context:</span></a>
      </li>
      <li>
        <a href="./incident-log.html#resolution"><span>Resolution:</span></a>
      </li>
      <li>
        <a href="./incident-log.html#review-actions"><span>Review actions:</span></a>
      </li>
    </ul>
  </li>
  <li>
    <a href="./changes-in-cloudplatform.html"><span>Change Process in Cloud Platform</span></a>
    <ul>
      <li>
        <a href="./changes-in-cloudplatform.html#making-changes-to-cloud-platform-infrastructure"><span>Making Changes to cloud-platform-infrastructure</span></a>
      </li>
      <li>
        <a href="./changes-in-cloudplatform.html#making-changes-to-terraform-modules"><span>Making Changes to Terraform modules</span></a>
      </li>
      <li>
        <a href="./changes-in-cloudplatform.html#making-changes-to-helm-charts"><span>Making Changes to Helm Charts</span></a>
      </li>
      <li>
        <a href="./changes-in-cloudplatform.html#making-changes-to-environments-service-teams"><span>Making changes to environments (Service Teams)</span></a>
      </li>
      <li>
        <a href="./changes-in-cloudplatform.html#communications"><span>Communications</span></a>
      </li>
    </ul>
  </li>
  <li>
    <a href="./add-concourse-to-cluster.html"><span>Add Concourse to a test cluster</span></a>
    <ul>
      <li>
        <a href="./add-concourse-to-cluster.html#pre-requisites"><span>Pre-requisites</span></a>
      </li>
      <li>
        <a href="./add-concourse-to-cluster.html#process"><span>Process</span></a>
      </li>
    </ul>
  </li>
  <li>
    <a href="./upgrade-AMI-version.html"><span>Upgrade AMI Version</span></a>
  </li>
  <li>
    <a href="./upgrade-AMI-version.html"><span>Recycle all nodes</span></a>
  </li>
  <li>
    <a href="./upgrade-eks-addons.html"><span>Upgrade EKS addons</span></a>
    <ul>
      <li>
        <a href="./upgrade-eks-addons.html#listing-available-eks-upgrades"><span>Listing available EKS upgrades</span></a>
        <ul>
          <li>
            <a href="./upgrade-eks-addons.html#eksctl-install"><span>eksctl Install</span></a>
          </li>
        </ul>
      </li>
      <li>
        <a href="./upgrade-eks-addons.html#preparing-for-upgrade"><span>Preparing for upgrade</span></a>
      </li>
      <li>
        <a href="./upgrade-eks-addons.html#starting-the-upgrade"><span>Starting the upgrade</span></a>
      </li>
      <li>
        <a href="./upgrade-eks-addons.html#finish-the-upgrade"><span>Finish the upgrade</span></a>
      </li>
    </ul>
  </li>
  <li>
    <a href="./upgrade-eks-cluster.html"><span>Upgrade EKS cluster</span></a>
    <ul>
      <li>
        <a href="./upgrade-eks-cluster.html#upgrade-eks-cluster-pre-requisites"><span>Pre-requisites</span></a>
      </li>
      <li>
        <a href="./upgrade-eks-cluster.html#creating-cluster-upgrade-github-issues"><span>Creating Cluster Upgrade GitHub Issues</span></a>
      </li>
      <li>
        <a href="./upgrade-eks-cluster.html#upgrade-steps"><span>Upgrade Steps</span></a>
        <ul>
          <li>
            <a href="./upgrade-eks-cluster.html#compatibility-check"><span>Compatibility Check</span></a>
          </li>
          <li>
            <a href="./upgrade-eks-cluster.html#upgrade-steps-preparing-for-upgrade"><span>¬†Preparing for upgrade</span></a>
          </li>
          <li>
            <a href="./upgrade-eks-cluster.html#monitoring-the-upgrade"><span>Monitoring the upgrade</span></a>
          </li>
          <li>
            <a href="./upgrade-eks-cluster.html#upgrade-steps-starting-the-upgrade"><span>Starting the upgrade</span></a>
          </li>
          <li>
            <a href="./upgrade-eks-cluster.html#finishing-the-upgrade"><span>Finishing the upgrade</span></a>
          </li>
          <li>
            <a href="./upgrade-eks-cluster.html#finishing-touches"><span>Finishing touches</span></a>
          </li>
        </ul>
      </li>
    </ul>
  </li>
  <li>
    <a href="./upgrade-eks-terraform-module.html"><span>Upgrade EKS Terraform Module</span></a>
    <ul>
      <li>
        <a href="./upgrade-eks-terraform-module.html#upgrade-eks-terraform-module-pre-requisites"><span>Pre-requisites</span></a>
      </li>
      <li>
        <a href="./upgrade-eks-terraform-module.html#upgrade-eks-terraform-module-upgrade-steps"><span>Upgrade Steps</span></a>
        <ul>
          <li>
            <a href="./upgrade-eks-terraform-module.html#upgrade-with-no-breaking-changes"><span>Upgrade with no breaking changes</span></a>
          </li>
          <li>
            <a href="./upgrade-eks-terraform-module.html#upgrade-with-breaking-changes"><span>Upgrade with breaking changes</span></a>
          </li>
        </ul>
      </li>
    </ul>
  </li>
  <li>
    <a href="./node-group-changes.html"><span>Making changes to EKS node groups or instances types</span></a>
    <ul>
      <li>
        <a href="./node-group-changes.html#why"><span>Why?</span></a>
      </li>
      <li>
        <a href="./node-group-changes.html#how"><span>How?</span></a>
        <ul>
          <li>
            <a href="./node-group-changes.html#notes"><span>Notes:</span></a>
          </li>
        </ul>
      </li>
    </ul>
  </li>
  <li>
    <a href="./upgrade-terraform-version.html"><span>Upgrade Terraform Version</span></a>
    <ul>
      <li>
        <a href="./upgrade-terraform-version.html#introduction"><span>Introduction</span></a>
      </li>
      <li>
        <a href="./upgrade-terraform-version.html#recommendations"><span>Recommendations</span></a>
      </li>
      <li>
        <a href="./upgrade-terraform-version.html#caveats"><span>Caveats</span></a>
      </li>
      <li>
        <a href="./upgrade-terraform-version.html#how-to-perform-the-upgrade-divide-and-conquer"><span>How to perform the upgrade - divide and conquer</span></a>
        <ul>
          <li>
            <a href="./upgrade-terraform-version.html#before-the-upgrade"><span>Before the upgrade</span></a>
          </li>
          <li>
            <a href="./upgrade-terraform-version.html#environments-state-files"><span>Environments state files</span></a>
          </li>
          <li>
            <a href="./upgrade-terraform-version.html#infrastructure-state-files"><span>Infrastructure state files</span></a>
          </li>
        </ul>
      </li>
    </ul>
  </li>
  <li>
    <a href="./upgrade-cluster-components.html"><span>Upgrade cluster components</span></a>
    <ul>
      <li>
        <a href="./upgrade-cluster-components.html#planning"><span>Planning</span></a>
      </li>
      <li>
        <a href="./upgrade-cluster-components.html#testing-the-upgrade-in-a-test-cluster"><span>Testing the upgrade in a test cluster</span></a>
        <ul>
          <li>
            <a href="./upgrade-cluster-components.html#setup-environment"><span>Setup environment</span></a>
          </li>
          <li>
            <a href="./upgrade-cluster-components.html#create-test-cluster"><span>Create test cluster</span></a>
          </li>
          <li>
            <a href="./upgrade-cluster-components.html#run-a-shell-in-the-tools-image"><span>Run a shell in the tools image</span></a>
          </li>
          <li>
            <a href="./upgrade-cluster-components.html#authenticate-to-the-test-cluster"><span>Authenticate to the test cluster</span></a>
          </li>
          <li>
            <a href="./upgrade-cluster-components.html#run-the-integration-tests"><span>Run the integration tests</span></a>
          </li>
          <li>
            <a href="./upgrade-cluster-components.html#testing-the-upgrade"><span>Testing the upgrade</span></a>
          </li>
          <li>
            <a href="./upgrade-cluster-components.html#things-to-observe-when-testing-the-upgrade"><span>Things to observe when testing the upgrade</span></a>
          </li>
          <li>
            <a href="./upgrade-cluster-components.html#performing-the-upgrade"><span>Performing the upgrade</span></a>
          </li>
        </ul>
      </li>
    </ul>
  </li>
  <li>
    <a href="./upgrade-user-components.html"><span>Upgrade user components</span></a>
    <ul>
      <li>
        <a href="./upgrade-user-components.html#making-changes-to-your-module"><span>Making changes to your module</span></a>
      </li>
      <li>
        <a href="./upgrade-user-components.html#semantic-versioning-and-release"><span>Semantic Versioning and release</span></a>
      </li>
      <li>
        <a href="./upgrade-user-components.html#upgrading-a-user-component-in-environments"><span>Upgrading a user component in environments</span></a>
      </li>
    </ul>
  </li>
  <li>
    <a href="./container-images.html"><span>Container Images used by Cluster Components</span></a>
    <ul>
      <li>
        <a href="./container-images.html#how-to-update-this-runbook"><span>How to update this runbook</span></a>
        <ul>
          <li>
            <a href="./container-images.html#check-current-components-images-versions"><span>Check current components images versions</span></a>
          </li>
          <li>
            <a href="./container-images.html#latest-version-for-k8s-1-28"><span>Latest version for k8s 1.28</span></a>
          </li>
          <li>
            <a href="./container-images.html#latest-version-available"><span>Latest version available</span></a>
          </li>
          <li>
            <a href="./container-images.html#urgency"><span>Urgency</span></a>
          </li>
        </ul>
      </li>
      <li>
        <a href="./container-images.html#calico-apiserver"><span>calico-apiserver</span></a>
      </li>
      <li>
        <a href="./container-images.html#calico-system"><span>calico-system</span></a>
      </li>
      <li>
        <a href="./container-images.html#container-images-used-by-cluster-components-cert-manager"><span>cert-manager</span></a>
      </li>
      <li>
        <a href="./container-images.html#concourse"><span>concourse</span></a>
      </li>
      <li>
        <a href="./container-images.html#external-secrets-operator"><span>external-secrets-operator</span></a>
      </li>
      <li>
        <a href="./container-images.html#gatekeeper-system"><span>gatekeeper-system</span></a>
      </li>
      <li>
        <a href="./container-images.html#ingress-controllers"><span>ingress-controllers</span></a>
      </li>
      <li>
        <a href="./container-images.html#kube-system"><span>kube-system</span></a>
      </li>
      <li>
        <a href="./container-images.html#kuberhealthy"><span>kuberhealthy</span></a>
      </li>
      <li>
        <a href="./container-images.html#kuberos"><span>kuberos</span></a>
      </li>
      <li>
        <a href="./container-images.html#logging"><span>logging</span></a>
      </li>
      <li>
        <a href="./container-images.html#monitoring"><span>monitoring</span></a>
      </li>
      <li>
        <a href="./container-images.html#overprovision"><span>overprovision</span></a>
      </li>
      <li>
        <a href="./container-images.html#tigera-operator"><span>tigera-operator</span></a>
      </li>
      <li>
        <a href="./container-images.html#trivy-system"><span>trivy-system</span></a>
      </li>
      <li>
        <a href="./container-images.html#velero"><span>velero</span></a>
      </li>
    </ul>
  </li>
  <li>
    <a href="./delete-cluster.html"><span>Delete a cluster</span></a>
    <ul>
      <li>
        <a href="./delete-cluster.html#delete-the-cluster-with-concourse-delete-cluster-pipeline"><span>Delete the cluster with Concourse delete-cluster pipeline</span></a>
      </li>
      <li>
        <a href="./delete-cluster.html#delete-an-eks-cluster-manually"><span>Delete an EKS cluster manually</span></a>
      </li>
    </ul>
  </li>
  <li>
    <a href="./working-with-tflock.html"><span>What is .terraform.lock.hcl?</span></a>
    <ul>
      <li>
        <a href="./working-with-tflock.html#working-with-terraform-lock-hcl-files"><span>Working with .terraform.lock.hcl files</span></a>
        <ul>
          <li>
            <a href="./working-with-tflock.html#rules"><span>Rules</span></a>
          </li>
          <li>
            <a href="./working-with-tflock.html#commiting-changes-to-the-lock-file"><span>Commiting changes to the lock file</span></a>
          </li>
        </ul>
      </li>
    </ul>
  </li>
  <li>
    <a href="./updating-prisoner-content-hub-waf.html"><span>Updating Prisoner Content Hub WAF</span></a>
  </li>
  <li>
    <a href="./move-components-module.html"><span>Moving components modules into core</span></a>
    <ul>
      <li>
        <a href="./move-components-module.html#notes-on-the-pipeline"><span>Notes on the pipeline</span></a>
      </li>
      <li>
        <a href="./move-components-module.html#moving-components-modules-into-core-process"><span>¬†Process</span></a>
      </li>
      <li>
        <a href="./move-components-module.html#disaster-recovery"><span>Disaster Recovery</span></a>
      </li>
    </ul>
  </li>
  <li>
    <a href="./add-nodes-to-the-eks-cluster.html"><span>Add nodes to the AWS EKS cluster</span></a>
    <ul>
      <li>
        <ul>
          <li>
            <a href="./add-nodes-to-the-eks-cluster.html#requirements"><span>Requirements</span></a>
          </li>
          <li>
            <a href="./add-nodes-to-the-eks-cluster.html#cluster-configuration"><span>Cluster configuration:</span></a>
          </li>
        </ul>
      </li>
    </ul>
  </li>
  <li>
    <a href="./auth0-rotation.html"><span>Credentials rotation for auth0 apps</span></a>
    <ul>
      <li>
        <a href="./auth0-rotation.html#preparation"><span>Preparation</span></a>
      </li>
      <li>
        <a href="./auth0-rotation.html#1-taint-resources-terraform"><span>1) Taint resources (terraform)</span></a>
      </li>
      <li>
        <a href="./auth0-rotation.html#2-apply-changes-within-components-terraform"><span>2) Apply changes within components (terraform)</span></a>
      </li>
      <li>
        <a href="./auth0-rotation.html#3-verifying-changes"><span>3) Verifying changes</span></a>
      </li>
      <li>
        <a href="./auth0-rotation.html#4-update-manager-cluster-within-components-terraform"><span>4) Update Manager cluster within components (terraform)</span></a>
      </li>
    </ul>
  </li>
  <li>
    <a href="./monitor-eks-cluster.html"><span>Monitor EKS Cluster</span></a>
    <ul>
      <li>
        <a href="./monitor-eks-cluster.html#monitoring-with-k9s"><span>Monitoring with K9s</span></a>
        <ul>
          <li>
            <a href="./monitor-eks-cluster.html#installation"><span>Installation</span></a>
          </li>
          <li>
            <a href="./monitor-eks-cluster.html#launching-k9s"><span>Launching K9s</span></a>
          </li>
          <li>
            <a href="./monitor-eks-cluster.html#monitoring-nodes"><span>Monitoring Nodes</span></a>
          </li>
          <li>
            <a href="./monitor-eks-cluster.html#monitoring-pods"><span>Monitoring Pods</span></a>
          </li>
          <li>
            <a href="./monitor-eks-cluster.html#monitoring-events"><span>Monitoring Events</span></a>
          </li>
          <li>
            <a href="./monitor-eks-cluster.html#monitoring-with-k9s-further-reading"><span>Further reading</span></a>
          </li>
        </ul>
      </li>
      <li>
        <a href="./monitor-eks-cluster.html#monitoring-with-stern"><span>Monitoring with Stern</span></a>
        <ul>
          <li>
            <a href="./monitor-eks-cluster.html#basic-usage"><span>Basic Usage</span></a>
          </li>
          <li>
            <a href="./monitor-eks-cluster.html#monitoring-with-stern-further-reading"><span>Further reading</span></a>
          </li>
        </ul>
      </li>
    </ul>
  </li>
  <li>
    <a href="./rotate-git-crypt-key.html"><span>Git-crypt</span></a>
    <ul>
      <li>
        <a href="./rotate-git-crypt-key.html#adding-new-user-to-the-keyring"><span>Adding new user to the keyring</span></a>
      </li>
      <li>
        <a href="./rotate-git-crypt-key.html#rotating-the-git-crypt-key"><span>Rotating the git-crypt key</span></a>
        <ul>
          <li>
          </li>
        </ul>
      </li>
    </ul>
  </li>
  <li>
    <a href="./custom-domain.html"><span>Add a custom domain</span></a>
  </li>
  <li>
    <a href="./add-new-receiver-alert-manager.html"><span>Add a new Alertmanager receiver and a slack webhook</span></a>
    <ul>
      <li>
        <a href="./add-new-receiver-alert-manager.html#add-a-new-alertmanager-receiver-and-a-slack-webhook-pre-requisites"><span>Pre-requisites</span></a>
      </li>
      <li>
        <a href="./add-new-receiver-alert-manager.html#creating-a-new-receiver-set"><span>Creating a new receiver set</span></a>
      </li>
      <li>
        <a href="./add-new-receiver-alert-manager.html#information-alerts"><span>Information Alerts</span></a>
      </li>
    </ul>
  </li>
  <li>
    <a href="./images/create-a-pingdom-integration-id.html"><span>Create a Pingdom integration id</span></a>
    <ul>
      <li>
        <a href="./images/create-a-pingdom-integration-id.html#how-to-create-integration-id-webhook"><span>How to create integration id (webhook)</span></a>
      </li>
    </ul>
  </li>
  <li>
    <a href="./disaster-recovery-scenarios.html"><span>Cloud Platform Disaster Recovery Scenarios</span></a>
    <ul>
      <li>
        <a href="./disaster-recovery-scenarios.html#losing-a-namespace"><span>Losing a Namespace</span></a>
        <ul>
          <li>
            <a href="./disaster-recovery-scenarios.html#losing-a-namespace-impact"><span>Impact</span></a>
          </li>
          <li>
            <a href="./disaster-recovery-scenarios.html#possible-cause"><span>Possible Cause</span></a>
          </li>
          <li>
            <a href="./disaster-recovery-scenarios.html#restore-process"><span>Restore process</span></a>
          </li>
        </ul>
      </li>
      <li>
        <a href="./disaster-recovery-scenarios.html#losing-a-kubernetes-component-or-object"><span>Losing a Kubernetes Component or Object</span></a>
        <ul>
          <li>
            <a href="./disaster-recovery-scenarios.html#losing-a-kubernetes-component-or-object-impact"><span>Impact</span></a>
          </li>
          <li>
            <a href="./disaster-recovery-scenarios.html#losing-a-kubernetes-component-or-object-possible-cause"><span>Possible Cause</span></a>
          </li>
          <li>
            <a href="./disaster-recovery-scenarios.html#losing-a-kubernetes-component-or-object-restore-process"><span>Restore process</span></a>
          </li>
        </ul>
      </li>
      <li>
        <a href="./disaster-recovery-scenarios.html#losing-the-whole-cluster"><span>Losing the whole cluster</span></a>
        <ul>
          <li>
            <a href="./disaster-recovery-scenarios.html#losing-the-whole-cluster-impact"><span>Impact</span></a>
          </li>
          <li>
            <a href="./disaster-recovery-scenarios.html#losing-the-whole-cluster-possible-cause"><span>Possible Cause</span></a>
          </li>
          <li>
            <a href="./disaster-recovery-scenarios.html#how-this-plan-is-tested"><span>How this plan is tested:</span></a>
          </li>
          <li>
            <a href="./disaster-recovery-scenarios.html#assumptions"><span>Assumptions</span></a>
          </li>
          <li>
            <a href="./disaster-recovery-scenarios.html#losing-the-whole-cluster-restore-process"><span>Restore process</span></a>
          </li>
        </ul>
      </li>
      <li>
        <a href="./disaster-recovery-scenarios.html#deleted-terraform-state"><span>Deleted terraform state</span></a>
        <ul>
          <li>
            <a href="./disaster-recovery-scenarios.html#deleted-terraform-state-impact"><span>Impact</span></a>
          </li>
          <li>
            <a href="./disaster-recovery-scenarios.html#deleted-terraform-state-possible-cause"><span>Possible Cause</span></a>
          </li>
          <li>
            <a href="./disaster-recovery-scenarios.html#deleted-terraform-state-restore-process"><span>Restore process</span></a>
          </li>
          <li>
            <a href="./disaster-recovery-scenarios.html#recovering-more-complex-scenarios"><span>Recovering more complex scenarios</span></a>
          </li>
          <li>
            <a href="./disaster-recovery-scenarios.html#resolving-a-partiallyfailed-backup-alert"><span>Resolving a PartiallyFailed backup alert</span></a>
          </li>
        </ul>
      </li>
    </ul>
  </li>
  <li>
    <a href="./bastion-node.html"><span>Create and access bastion node.</span></a>
    <ul>
      <li>
        <a href="./bastion-node.html#create-bastion-node"><span>Create bastion node</span></a>
      </li>
      <li>
        <a href="./bastion-node.html#access-bastion-node"><span>Access bastion node</span></a>
      </li>
    </ul>
  </li>
  <li>
    <a href="./rotate-user-aws-credentials.html"><span>Rotate User AWS Credentials</span></a>
    <ul>
      <li>
        <ul>
          <li>
          </li>
        </ul>
      </li>
      <li>
        <a href="./rotate-user-aws-credentials.html#set-pingdom-environment-variables-optional"><span>Set pingdom environment variables(Optional)</span></a>
      </li>
      <li>
        <a href="./rotate-user-aws-credentials.html#target-the-live-cluster"><span>Target the live cluster</span></a>
      </li>
      <li>
        <a href="./rotate-user-aws-credentials.html#set-cluster-related-environment-variables"><span>Set cluster-related environment variables</span></a>
      </li>
      <li>
        <a href="./rotate-user-aws-credentials.html#set-the-namespace-name"><span>Set the namespace name</span></a>
      </li>
      <li>
        <a href="./rotate-user-aws-credentials.html#terraform-init"><span>Terraform Init</span></a>
      </li>
      <li>
        <a href="./rotate-user-aws-credentials.html#terraform-plan-apply"><span>Terraform Plan/Apply</span></a>
        <ul>
          <li>
            <a href="./rotate-user-aws-credentials.html#2-identify-the-compromised-terraform-object"><span>2. Identify the compromised terraform object</span></a>
          </li>
          <li>
            <a href="./rotate-user-aws-credentials.html#3-destroy-the-compromised-key"><span>3. Destroy the compromised key</span></a>
          </li>
          <li>
            <a href="./rotate-user-aws-credentials.html#4-let-terraform-create-a-new-key"><span>4. Let terraform create a new key</span></a>
          </li>
        </ul>
      </li>
    </ul>
  </li>
  <li>
    <a href="./aws-leaked-credentials.html"><span>AWS Compromised Credentials</span></a>
    <ul>
      <li>
        <a href="./aws-leaked-credentials.html#steps-for-a-leaked-credentials"><span>Steps for a leaked credentials</span></a>
      </li>
      <li>
        <a href="./aws-leaked-credentials.html#getting-new-credentials"><span>Getting new credentials</span></a>
      </li>
      <li>
        <a href="./aws-leaked-credentials.html#audit-the-compromised-credentials"><span>Audit the compromised credentials</span></a>
      </li>
    </ul>
  </li>
  <li>
    <a href="./aws-access-control.html"><span>AWS Console Access</span></a>
    <ul>
      <li>
        <a href="./aws-access-control.html#steps-to-create-delete-cloud-platform-team-users"><span>Steps to create/delete Cloud Platform team users</span></a>
      </li>
      <li>
        <a href="./aws-access-control.html#activating-mfa-for-new-users"><span>Activating MFA for new users</span></a>
      </li>
      <li>
        <a href="./aws-access-control.html#modifying-cloud-platform-users-permissions"><span>Modifying Cloud Platform users permissions</span></a>
        <ul>
          <li>
            <a href="./aws-access-control.html#troubleshooting-for-modifying-cloud-platform-users-permissions"><span>Troubleshooting for modifying Cloud Platform users permissions</span></a>
          </li>
        </ul>
      </li>
    </ul>
  </li>
  <li>
    <a href="./public-s3-bucket.html"><span>Make an S3 bucket public</span></a>
  </li>
  <li>
    <a href="./delete-prometheus-metrics.html"><span>Delete Prometheus Metrics</span></a>
    <ul>
      <li>
        <a href="./delete-prometheus-metrics.html#1-identify-the-metrics-you-want-to-delete"><span>1.  Identify the metrics you want to delete</span></a>
      </li>
      <li>
        <a href="./delete-prometheus-metrics.html#2-enable-the-admin-interface-in-prometheus"><span>2. Enable the admin interface in Prometheus</span></a>
      </li>
      <li>
        <a href="./delete-prometheus-metrics.html#3-launch-a-port-forward-pod"><span>3. Launch a port-forward pod</span></a>
      </li>
      <li>
        <a href="./delete-prometheus-metrics.html#4-forward-local-traffic-to-prometheus"><span>4. Forward local traffic to Prometheus</span></a>
      </li>
      <li>
        <a href="./delete-prometheus-metrics.html#5-use-curl-in-another-terminal-to-hit-the-api-endpoint"><span>5. Use curl (in another terminal) to hit the API endpoint</span></a>
      </li>
      <li>
        <a href="./delete-prometheus-metrics.html#6-use-this-script-to-delete-multiple-metrics"><span>6. Use this script to delete multiple metrics</span></a>
      </li>
      <li>
        <a href="./delete-prometheus-metrics.html#7-clean-up"><span>7. Clean up</span></a>
      </li>
    </ul>
  </li>
  <li>
    <a href="./manually-apply-namespace.html"><span>Manually Plan/Apply Namespace Resources in live cluster</span></a>
    <ul>
      <li>
        <a href="./manually-apply-namespace.html#start-in-the-appropriate-branch-of-the-environments-repo"><span>Start in the appropriate branch of the environments repo</span></a>
      </li>
      <li>
        <a href="./manually-apply-namespace.html#manually-plan-apply-namespace-resources-in-live-cluster-set-pingdom-environment-variables-optional"><span>Set pingdom environment variables(Optional)</span></a>
      </li>
      <li>
        <a href="./manually-apply-namespace.html#manually-plan-apply-namespace-resources-in-live-cluster-target-the-live-cluster"><span>Target the live cluster</span></a>
      </li>
      <li>
        <a href="./manually-apply-namespace.html#set-some-environment-variables"><span>Set some environment variables</span></a>
      </li>
      <li>
        <a href="./manually-apply-namespace.html#manually-plan-apply-namespace-resources-in-live-cluster-set-the-namespace-name"><span>Set the namespace name</span></a>
      </li>
      <li>
        <a href="./manually-apply-namespace.html#manually-plan-apply-namespace-resources-in-live-cluster-terraform-init"><span>Terraform Init</span></a>
      </li>
      <li>
        <a href="./manually-apply-namespace.html#manually-plan-apply-namespace-resources-in-live-cluster-terraform-plan-apply"><span>Terraform Plan/Apply</span></a>
      </li>
    </ul>
  </li>
  <li>
    <a href="./manually-delete-namespace-resources.html"><span>Manually Delete Namespace Resources</span></a>
    <ul>
      <li>
        <a href="./manually-delete-namespace-resources.html#prerequisites"><span>Prerequisites</span></a>
      </li>
      <li>
        <a href="./manually-delete-namespace-resources.html#environment-variables"><span>Environment Variables</span></a>
      </li>
      <li>
        <a href="./manually-delete-namespace-resources.html#deleting-a-namespace"><span>Deleting a namespace</span></a>
      </li>
      <li>
        <a href="./manually-delete-namespace-resources.html#locating-pr-number"><span>Locating PR number</span></a>
      </li>
    </ul>
  </li>
  <li>
    <a href="./export-elasticsearch-to-csv.html"><span>Export data from Elasticsearch into a CSV file</span></a>
    <ul>
      <li>
        <a href="./export-elasticsearch-to-csv.html#workaround"><span>Workaround</span></a>
        <ul>
          <li>
            <a href="./export-elasticsearch-to-csv.html#install-es2csv"><span>Install es2csv</span></a>
          </li>
          <li>
            <a href="./export-elasticsearch-to-csv.html#usage"><span>Usage</span></a>
          </li>
        </ul>
      </li>
    </ul>
  </li>
  <li>
    <a href="./resolve-opensearch-shard-issues.html"><span>Open search best practices</span></a>
    <ul>
      <li>
        <a href="./resolve-opensearch-shard-issues.html#some-general-info-about-shards"><span>Some general info about shards</span></a>
      </li>
      <li>
        <a href="./resolve-opensearch-shard-issues.html#freestoragespacetoolow-alerts"><span>FreeStorageSpaceTooLow alerts</span></a>
        <ul>
          <li>
            <a href="./resolve-opensearch-shard-issues.html#connecting-to-the-elastic-search-api"><span>Connecting to the Elastic search api</span></a>
          </li>
        </ul>
      </li>
      <li>
        <a href="./resolve-opensearch-shard-issues.html#connecting-to-the-opensearch-api"><span>Connecting to the OpenSearch api</span></a>
        <ul>
          <li>
            <a href="./resolve-opensearch-shard-issues.html#verify-you-39-re-connected-to-the-api"><span>Verify you‚Äôre connected to the api</span></a>
          </li>
        </ul>
      </li>
    </ul>
  </li>
  <li>
    <a href="./resolve-opensearch-no-logs.html"><span>Modsec logging architecture</span></a>
    <ul>
      <li>
        <a href="./resolve-opensearch-no-logs.html#debugging"><span>Debugging</span></a>
      </li>
    </ul>
  </li>
  <li>
    <a href="./remove-data-from-elasticsearch.html"><span>Remove data from Elasticsearch</span></a>
    <ul>
      <li>
        <a href="./remove-data-from-elasticsearch.html#stop-the-breach-first"><span>Stop the breach first</span></a>
      </li>
      <li>
        <a href="./remove-data-from-elasticsearch.html#things-to-know"><span>Things to know</span></a>
      </li>
      <li>
        <a href="./remove-data-from-elasticsearch.html#get-yourself-access"><span>Get yourself access</span></a>
      </li>
      <li>
        <a href="./remove-data-from-elasticsearch.html#build-your-query"><span>Build your query</span></a>
      </li>
      <li>
        <a href="./remove-data-from-elasticsearch.html#delete-by-query"><span>Delete by query</span></a>
      </li>
      <li>
        <a href="./remove-data-from-elasticsearch.html#removing-specific-logs-filtered-by-phrase"><span>Removing specific logs filtered by phrase</span></a>
        <ul>
          <li>
            <a href="./remove-data-from-elasticsearch.html#deleting-documents-stored-in-warm-storage"><span>Deleting documents stored in warm storage</span></a>
          </li>
        </ul>
      </li>
    </ul>
  </li>
  <li>
    <a href="./manage-grafana-snapshots.html"><span>Manage Published Grafana Dashboard Snapshots</span></a>
    <ul>
      <li>
        <a href="./manage-grafana-snapshots.html#steps-to-remove-snapshot"><span>Steps to remove Snapshot</span></a>
      </li>
    </ul>
  </li>
  <li>
    <a href="./kibana-podsecurity-violations-alert.html"><span>Kibana PodSecurity Violations Alert</span></a>
    <ul>
      <li>
        <a href="./kibana-podsecurity-violations-alert.html#kibana-alert-monitor"><span>Kibana Alert/Monitor</span></a>
      </li>
      <li>
        <a href="./kibana-podsecurity-violations-alert.html#checking-logs-for-psa-violations-in-kibana"><span>Checking logs for PSA violations in Kibana</span></a>
      </li>
      <li>
        <a href="./kibana-podsecurity-violations-alert.html#fixing-psa-violations"><span>Fixing PSA Violations</span></a>
      </li>
      <li>
        <a href="./kibana-podsecurity-violations-alert.html#slack-alert"><span>Slack Alert</span></a>
      </li>
    </ul>
  </li>
  <li>
    <a href="./delete-state-lock.html"><span>Delete terraform state lock</span></a>
    <ul>
      <li>
        <a href="./delete-state-lock.html#command-line-method"><span>Command-line method</span></a>
      </li>
      <li>
        <a href="./delete-state-lock.html#aws-console-method"><span>AWS Console method</span></a>
      </li>
      <li>
        <a href="./delete-state-lock.html#terraform-command"><span>Terraform command</span></a>
      </li>
    </ul>
  </li>
  <li>
    <a href="./error-refreshing-state.html"><span>Terraform state lock - Error refreshing state</span></a>
  </li>
  <li>
    <a href="./divergence-error.html"><span>How to Investigate Divergence Errors</span></a>
    <ul>
      <li>
        <a href="./divergence-error.html#reproduce-the-plan"><span>Reproduce the plan</span></a>
      </li>
    </ul>
  </li>
  <li>
    <a href="./external-dns-error.html"><span>How to Investigate External-Dns Errors</span></a>
    <ul>
      <li>
        <a href="./external-dns-error.html#troubleshooting"><span>Troubleshooting</span></a>
        <ul>
          <li>
            <a href="./external-dns-error.html#invalid-change-batch"><span>Invalid Change Batch</span></a>
          </li>
          <li>
            <a href="./external-dns-error.html#rate-limited-throttled"><span>Rate Limited / Throttled</span></a>
          </li>
        </ul>
      </li>
    </ul>
  </li>
  <li>
    <a href="./prometheus-reconcile-alert.html"><span>How to Investigate PrometheusOperatorReconcile Errors</span></a>
    <ul>
      <li>
        <a href="./prometheus-reconcile-alert.html#how-to-investigate-prometheusoperatorreconcile-errors-troubleshooting"><span>Troubleshooting</span></a>
      </li>
    </ul>
  </li>
  <li>
    <a href="./analyze-vpc-flow-logs.html"><span>Analyze VPC Flow Logs</span></a>
  </li>
  <li>
    <a href="./recycle-node.html"><span>Recycle-node</span></a>
  </li>
  <li>
    <a href="./recycle-all-nodes.html"><span>Recycle-all-nodes</span></a>
    <ul>
      <li>
        <a href="./recycle-all-nodes.html#recycling-process"><span>Recycling process</span></a>
        <ul>
          <li>
            <a href="./recycle-all-nodes.html#gotchas"><span>Gotchas</span></a>
          </li>
        </ul>
      </li>
    </ul>
  </li>
  <li>
    <a href="./revoke-user-auth0-kubeconfig-access-token.html"><span>Revoke auth0 kubeconfig access token</span></a>
    <ul>
      <li>
        <a href="./revoke-user-auth0-kubeconfig-access-token.html#1-revoke-existing-tokens-generated-from-github"><span>1. Revoke existing tokens generated from github</span></a>
      </li>
      <li>
        <a href="./revoke-user-auth0-kubeconfig-access-token.html#2-recreate-auth0-client-kubernetes"><span>2. Recreate ‚Äã‚Äãauth0_client.kubernetes</span></a>
        <ul>
          <li>
          </li>
        </ul>
      </li>
    </ul>
  </li>
  <li>
    <a href="./creating-a-live-like.html"><span>Creating a live-like cluster</span></a>
    <ul>
      <li>
        <a href="./creating-a-live-like.html#creating-a-live-like-cluster-pre-requisites"><span>Pre-requisites</span></a>
      </li>
      <li>
        <a href="./creating-a-live-like.html#setting-cluster-size-to-match-live"><span>Setting cluster size to match Live</span></a>
      </li>
      <li>
        <a href="./creating-a-live-like.html#installing-live-components-and-test-applications"><span>Installing live components and test applications</span></a>
      </li>
      <li>
        <a href="./creating-a-live-like.html#upgrading-a-live-like-test-cluster"><span>Upgrading a live-like test cluster</span></a>
      </li>
      <li>
        <a href="./creating-a-live-like.html#creating-a-live-like-cluster-monitoring-the-upgrade"><span>Monitoring the upgrade</span></a>
      </li>
      <li>
        <a href="./creating-a-live-like.html#final-tests"><span>Final Tests</span></a>
      </li>
      <li>
        <a href="./creating-a-live-like.html#tearing-down"><span>Tearing down</span></a>
      </li>
    </ul>
  </li>
  <li>
    <a href="./eks-cluster.html"><span>Provisioning EKS clusters</span></a>
    <ul>
      <li>
        <a href="./eks-cluster.html#provisioning-eks-clusters-pre-requisites"><span>Pre-requisites</span></a>
      </li>
      <li>
        <a href="./eks-cluster.html#provisioning-eks-clusters-environment-variables"><span>Environment Variables</span></a>
      </li>
      <li>
        <a href="./eks-cluster.html#provisioning-an-eks-cluster-with-the-cloud-platform-cli"><span>Provisioning an EKS cluster with the cloud-platform CLI</span></a>
      </li>
      <li>
        <a href="./eks-cluster.html#manually-provisioning-a-cluster"><span>Manually provisioning a cluster</span></a>
        <ul>
          <li>
            <a href="./eks-cluster.html#1-vpc"><span>1. VPC</span></a>
          </li>
          <li>
            <a href="./eks-cluster.html#2-creating-eks-cluster"><span>2. Creating EKS cluster</span></a>
          </li>
          <li>
            <a href="./eks-cluster.html#3-deploy-core"><span>3. Deploy core</span></a>
          </li>
          <li>
            <a href="./eks-cluster.html#4-deploy-components"><span>4. Deploy components</span></a>
          </li>
        </ul>
      </li>
      <li>
        <a href="./eks-cluster.html#deleting-your-test-cluster"><span>Deleting your test cluster</span></a>
      </li>
      <li>
        <a href="./eks-cluster.html#provisioning-a-custom-cluster"><span>Provisioning a custom cluster</span></a>
      </li>
    </ul>
  </li>
  <li>
    <a href="./change-alias-in-route53.html"><span>Change load balancer alias to the interface IP‚Äôs in Route53.</span></a>
    <ul>
      <li>
        <a href="./change-alias-in-route53.html#request-aws-to-restart-the-health-check"><span>Request AWS to restart the health check</span></a>
      </li>
      <li>
        <a href="./change-alias-in-route53.html#change-load-balancer-alias"><span>Change load balancer alias</span></a>
      </li>
    </ul>
  </li>
  <li>
    <a href="./expand.html"><span>Expanding Persistent Volumes created using StatefulSets</span></a>
  </li>
  <li>
    <a href="./velero.html"><span>Velero - Cluster backups and disaster recovery</span></a>
    <ul>
      <li>
        <ul>
          <li>
          </li>
        </ul>
      </li>
      <li>
        <a href="./velero.html#backups"><span>Backups</span></a>
        <ul>
          <li>
            <a href="./velero.html#backups-why"><span>Why?</span></a>
          </li>
          <li>
            <a href="./velero.html#what"><span>What?</span></a>
          </li>
          <li>
            <a href="./velero.html#backups-how"><span>How?</span></a>
          </li>
        </ul>
      </li>
    </ul>
  </li>
  <li>
    <a href="./helm-repository.html"><span>Cloud Platform helm chart repository</span></a>
    <ul>
      <li>
        <a href="./helm-repository.html#performing-crud-on-cloud-platform-helm-repository"><span>Performing CRUD on Cloud Platform Helm repository</span></a>
      </li>
    </ul>
  </li>
  <li>
    <a href="./access-eks-cluster.html"><span>Access EKS cluster</span></a>
    <ul>
      <li>
        <a href="./access-eks-cluster.html#access-eks-cluster-pre-requisites"><span>Pre-requisites</span></a>
        <ul>
          <li>
            <a href="./access-eks-cluster.html#create-kubeconfig-using-aws-command"><span>Create kubeconfig using aws command</span></a>
          </li>
          <li>
            <a href="./access-eks-cluster.html#create-kubeconfig-manually-using-a-template"><span>Create kubeconfig manually using a template</span></a>
          </li>
        </ul>
      </li>
    </ul>
  </li>
  <li>
    <a href="./get-audit-log-from-modsec.html"><span>OpenSearch modsec setup</span></a>
    <ul>
      <li>
        <a href="./get-audit-log-from-modsec.html#get-an-audit-log-from-modsec-when-fluent-bit-is-not-pushing-to-opensearch"><span>Get an audit log from modsec (when fluent-bit is not pushing to OpenSearch)</span></a>
        <ul>
          <li>
            <a href="./get-audit-log-from-modsec.html#how-do-i-check-the-audit-log"><span>How do I check the audit log</span></a>
          </li>
          <li>
            <a href="./get-audit-log-from-modsec.html#perform-a-search-for-the-unique-id-obtained-from-the-kibana-entry"><span>Perform a search for the unique-id (obtained from the Kibana entry)</span></a>
          </li>
        </ul>
      </li>
    </ul>
  </li>
  <li>
    <a href="./debugging-aws-console-access.html"><span>Debugging AWS Console read-only access issues</span></a>
    <ul>
      <li>
        <a href="./debugging-aws-console-access.html#github-teams-principal-tag-character-limit-exceeded"><span>GitHub teams Principal Tag character limit exceeded</span></a>
      </li>
    </ul>
  </li>
  <li>
    <a href="./eks-node-terminal-access.html"><span>Terminal access to EKS managed nodes</span></a>
    <ul>
      <li>
        <a href="./eks-node-terminal-access.html#overview"><span>Overview</span></a>
      </li>
      <li>
        <a href="./eks-node-terminal-access.html#terminal-access-to-eks-managed-nodes-pre-requisites"><span>Pre-requisites</span></a>
      </li>
      <li>
        <a href="./eks-node-terminal-access.html#steps-to-get-terminal-access-via-console"><span>Steps to get terminal access via Console</span></a>
      </li>
      <li>
        <a href="./eks-node-terminal-access.html#steps-to-get-terminal-access-via-aws-cli"><span>Steps to get terminal access via AWS cli</span></a>
      </li>
      <li>
        <a href="./eks-node-terminal-access.html#access-via-ssh-scp"><span>Access via SSH /SCP</span></a>
      </li>
    </ul>
  </li>
  <li>
    <a href="./cloud-platform-to-tgw.html"><span>Adding a route to connect to the MOJ Transit Gateway</span></a>
    <ul>
      <li>
        <a href="./cloud-platform-to-tgw.html#quick-introduction"><span>Quick introduction</span></a>
      </li>
      <li>
        <a href="./cloud-platform-to-tgw.html#transit-gateway"><span>Transit Gateway</span></a>
      </li>
      <li>
        <a href="./cloud-platform-to-tgw.html#making-the-change"><span>Making the change</span></a>
      </li>
      <li>
        <a href="./cloud-platform-to-tgw.html#adding-routes-from-live-2-vpc-to-moj-transit-gateway"><span>Adding routes from live-2 VPC to MoJ Transit Gateway</span></a>
      </li>
    </ul>
  </li>
  <li>
    <a href="./joiners-guide.html"><span>Onboarding into the Cloud Platform Team</span></a>
    <ul>
      <li>
        <a href="./joiners-guide.html#people-team"><span>People Team</span></a>
      </li>
      <li>
        <a href="./joiners-guide.html#service-desk"><span>Service Desk</span></a>
      </li>
      <li>
        <a href="./joiners-guide.html#sit-down-with-dm"><span>Sit down with DM</span></a>
      </li>
      <li>
        <a href="./joiners-guide.html#cloud-platform-team"><span>Cloud Platform team</span></a>
      </li>
      <li>
        <a href="./joiners-guide.html#access"><span>Access</span></a>
      </li>
    </ul>
  </li>
  <li>
    <a href="./add-new-opa-policy.html"><span>Open Policy Agent policies</span></a>
  </li>
  <li>
    <a href="./custom-default-backend.html"><span>Custom default-backend</span></a>
    <ul>
      <li>
        <ul>
          <li>
            <a href="./custom-default-backend.html#background"><span>Background</span></a>
          </li>
          <li>
            <a href="./custom-default-backend.html#use-platform-level-error-page"><span>Use platform-level error page</span></a>
          </li>
          <li>
            <a href="./custom-default-backend.html#not-use-platform-level-error-page"><span>Not use platform-level error page</span></a>
          </li>
        </ul>
      </li>
    </ul>
  </li>
  <li>
    <a href="./destroy-concourse-build-data.html"><span>Destroy Concourse Build Data</span></a>
    <ul>
      <li>
        <a href="./destroy-concourse-build-data.html#destroy-concourse-build-data-overview"><span>Overview</span></a>
      </li>
      <li>
        <a href="./destroy-concourse-build-data.html#steps-to-remove-the-build-data"><span>Steps to remove the build data</span></a>
      </li>
    </ul>
  </li>
  <li>
    <a href="./logs-to-soc-cortex-xsiam.html"><span>Pushing logs to the SOC team</span></a>
    <ul>
      <li>
        <a href="./logs-to-soc-cortex-xsiam.html#1-cloudtrail-logs"><span>1. Cloudtrail logs</span></a>
        <ul>
          <li>
            <a href="./logs-to-soc-cortex-xsiam.html#architecture"><span>Architecture</span></a>
          </li>
        </ul>
      </li>
      <li>
        <a href="./logs-to-soc-cortex-xsiam.html#2-live-1-vpc-flowlogs"><span>2. live-1 VPC FlowLogs</span></a>
        <ul>
          <li>
            <a href="./logs-to-soc-cortex-xsiam.html#2-live-1-vpc-flowlogs-architecture"><span>Architecture</span></a>
          </li>
        </ul>
      </li>
      <li>
        <a href="./logs-to-soc-cortex-xsiam.html#3-route53-logs"><span>3. Route53 logs</span></a>
        <ul>
          <li>
            <a href="./logs-to-soc-cortex-xsiam.html#3-route53-logs-architecture"><span>Architecture</span></a>
          </li>
        </ul>
      </li>
      <li>
        <a href="./logs-to-soc-cortex-xsiam.html#4-eks-logs"><span>4. EKS logs</span></a>
      </li>
      <li>
        <a href="./logs-to-soc-cortex-xsiam.html#todo"><span>Todo</span></a>
        <ul>
          <li>
            <a href="./logs-to-soc-cortex-xsiam.html#iam-user-access-keys-rotation"><span>IAM User access keys rotation</span></a>
          </li>
        </ul>
      </li>
    </ul>
  </li>
  <li>
    <a href="./leavers-guide.html"><span>Leavers Guide</span></a>
    <ul>
      <li>
        <a href="./leavers-guide.html#revoking-access"><span>Revoking Access</span></a>
        <ul>
          <li>
            <a href="./leavers-guide.html#digital-services"><span>Digital Services</span></a>
          </li>
          <li>
            <a href="./leavers-guide.html#aws-accounts"><span>AWS Accounts</span></a>
          </li>
          <li>
            <a href="./leavers-guide.html#other-3rd-party-accounts-access-removal"><span>Other 3rd Party Accounts access removal</span></a>
          </li>
        </ul>
      </li>
      <li>
        <a href="./leavers-guide.html#line-manager-actions"><span>Line manager actions</span></a>
      </li>
    </ul>
  </li>
  <li>
    <a href="./scheduled-pr-reminders.html"><span>Scheduled PR Reminders</span></a>
    <ul>
      <li>
        <ul>
          <li>
            <a href="./scheduled-pr-reminders.html#steps-required-for-new-repositories"><span>Steps required for new repositories</span></a>
          </li>
        </ul>
      </li>
    </ul>
  </li>
  <li>
    <a href="./grafana-dashboards.html"><span>Grafana Dashboards</span></a>
    <ul>
      <li>
        <a href="./grafana-dashboards.html#kubernetes-number-of-pods-per-node"><span>Kubernetes Number of Pods per Node</span></a>
        <ul>
          <li>
            <a href="./grafana-dashboards.html#dashboard-layout"><span>Dashboard Layout</span></a>
          </li>
        </ul>
      </li>
      <li>
        <a href="./grafana-dashboards.html#grafana-dashboards-troubleshooting"><span>Troubleshooting</span></a>
        <ul>
          <li>
            <a href="./grafana-dashboards.html#fixing-quot-failed-to-load-dashboard-quot-errors"><span>Fixing ‚Äúfailed to load dashboard‚Äù errors</span></a>
          </li>
          <li>
            <a href="./grafana-dashboards.html#fixing-quot-duplicate-dashboard-uid-quot-errors"><span>Fixing ‚Äúduplicate dashboard uid‚Äù errors</span></a>
          </li>
        </ul>
      </li>
    </ul>
  </li>
  <li>
    <a href="./on-call.html"><span>Going on call</span></a>
    <ul>
      <li>
        <a href="./on-call.html#what-s-expected"><span>What‚Äôs expected?</span></a>
        <ul>
          <li>
            <a href="./on-call.html#expected"><span>Expected:</span></a>
          </li>
          <li>
            <a href="./on-call.html#not-expected"><span>Not expected:</span></a>
          </li>
        </ul>
      </li>
      <li>
        <a href="./on-call.html#where-do-i-start"><span>Where do I start?</span></a>
      </li>
      <li>
        <a href="./on-call.html#what-do-i-get-for-being-on-call"><span>What do I get for being on call?</span></a>
      </li>
      <li>
        <a href="./on-call.html#civil-servants"><span>Civil servants</span></a>
      </li>
      <li>
        <a href="./on-call.html#contractors"><span>Contractors</span></a>
      </li>
    </ul>
  </li>
  <li>
    <a href="./cloud-platform-communications-plan.html"><span>Cloud Platform Communications Plan</span></a>
    <ul>
      <li>
        <a href="./cloud-platform-communications-plan.html#the-plan"><span>The Plan</span></a>
      </li>
      <li>
        <a href="./cloud-platform-communications-plan.html#tips-on-format-of-communications"><span>Tips on format of communications</span></a>
        <ul>
          <li>
            <a href="./cloud-platform-communications-plan.html#tips-on-format-of-communications-examples"><span>Examples</span></a>
          </li>
          <li>
            <a href="./cloud-platform-communications-plan.html#things-to-include-in-incident-communications"><span>Things to include in incident communications</span></a>
          </li>
          <li>
            <a href="./cloud-platform-communications-plan.html#example"><span>Example</span></a>
          </li>
          <li>
            <a href="./cloud-platform-communications-plan.html#things-to-include-in-upgrade-communications"><span>Things to include in upgrade communications</span></a>
          </li>
          <li>
            <a href="./cloud-platform-communications-plan.html#tips-on-format-of-communications-example"><span>Example</span></a>
          </li>
        </ul>
      </li>
      <li>
        <a href="./cloud-platform-communications-plan.html#sharing-information-with-the-wider-ministry-of-justice-and-the-public"><span>Sharing information with the wider Ministry of Justice and the Public</span></a>
      </li>
    </ul>
  </li>
  <li>
    <a href="./tips-and-tricks.html"><span>Tips and Tricks</span></a>
    <ul>
      <li>
        <a href="./tips-and-tricks.html#delete-an-rds-database-snapshot"><span>Delete an RDS database snapshot</span></a>
      </li>
      <li>
        <a href="./tips-and-tricks.html#check-the-expiration-date-of-the-ssl-certificate-for-a-live-domain"><span>Check the expiration date of the SSL certificate for a live domain</span></a>
      </li>
      <li>
        <a href="./tips-and-tricks.html#delete-a-quot-stuck-quot-resource"><span>Delete a ‚Äústuck‚Äù resource</span></a>
      </li>
      <li>
        <a href="./tips-and-tricks.html#filter-namespaces-by-specific-label-or-annotation"><span>Filter namespaces by specific label or annotation</span></a>
      </li>
      <li>
        <a href="./tips-and-tricks.html#find-all-pods-running-on-a-specific-worker-node"><span>Find all pods running on a specific worker node</span></a>
      </li>
      <li>
        <a href="./tips-and-tricks.html#count-pods-running-on-all-nodes"><span>Count pods running on all nodes</span></a>
      </li>
      <li>
        <a href="./tips-and-tricks.html#add-more-rss-feeds-to-cloud-platform-rss-channel"><span>Add more RSS feeds to #cloud-platform-rss channel</span></a>
      </li>
      <li>
        <a href="./tips-and-tricks.html#find-files-which-don-39-t-contain-a-particular-string"><span>Find files which don‚Äôt contain a particular string</span></a>
      </li>
      <li>
        <a href="./tips-and-tricks.html#get-aws-ec2-instance-information-for-a-node"><span>Get AWS EC2 instance information for a node</span></a>
      </li>
      <li>
        <a href="./tips-and-tricks.html#create-a-one-off-job-to-repeat-a-cronjob"><span>Create a one-off job to repeat a cronjob</span></a>
      </li>
      <li>
        <a href="./tips-and-tricks.html#hijack-a-concourse-job-container"><span>Hijack a concourse job container</span></a>
      </li>
      <li>
        <a href="./tips-and-tricks.html#help-when-manually-deleting-aws-resources"><span>Help when manually deleting AWS resources</span></a>
      </li>
      <li>
        <a href="./tips-and-tricks.html#find-out-why-your-namespace-isn-39-t-deleting"><span>Find out why your namespace isn‚Äôt deleting</span></a>
      </li>
      <li>
        <a href="./tips-and-tricks.html#modsec-false-positives"><span>Modsec false positives</span></a>
      </li>
    </ul>
  </li>
  <li>
    <a href="./google-search-indexing.html"><span>Google Search Console and Indexing</span></a>
  </li>
  <li>
    <a href="./add-a-new-runbook.html"><span>Add a new runbook</span></a>
    <ul>
      <li>
        <ul>
          <li>
          </li>
        </ul>
      </li>
    </ul>
  </li>
  <li>
    <a href="./elasticsearch-storage-issues.html"><span>Elasticsearch Storage Issues</span></a>
    <ul>
      <li>
        <a href="./elasticsearch-storage-issues.html#hot-warm-node-parity"><span>Hot/Warm Node Parity</span></a>
      </li>
      <li>
        <a href="./elasticsearch-storage-issues.html#manually-migrating-failed-indexes"><span>Manually migrating failed indexes</span></a>
      </li>
      <li>
        <a href="./elasticsearch-storage-issues.html#elasticsearch-storage-issues-further-reading"><span>Further Reading</span></a>
      </li>
    </ul>
  </li>
  <li>
    <a href="./debugging-101.html"><span>Debugging 101</span></a>
    <ul>
      <li>
        <a href="./debugging-101.html#debugging-101-grafana-dashboards"><span>Grafana Dashboards</span></a>
        <ul>
          <li>
            <a href="./debugging-101.html#kubernetes-view-nodes"><span>Kubernetes / View / Nodes</span></a>
          </li>
          <li>
            <a href="./debugging-101.html#kubernetes-compute-resources-node-pods"><span>Kubernetes / Compute Resources / Node (Pods)</span></a>
          </li>
          <li>
            <a href="./debugging-101.html#kubernetes-views-pods"><span>Kubernetes / Views / Pods</span></a>
          </li>
          <li>
            <a href="./debugging-101.html#kubernetes-nginx-ingress-controller-nextgen-devops-nirvana2"><span>Kubernetes Nginx Ingress Controller NextGen - DevOps Nirvana2</span></a>
          </li>
        </ul>
      </li>
    </ul>
  </li>
  <li>
    <a href="./investigating-blocked-ingress-spikes.html"><span>Investigating blocked ingress spikes</span></a>
    <ul>
      <li>
        <a href="./investigating-blocked-ingress-spikes.html#communication"><span>Communication</span></a>
      </li>
      <li>
        <a href="./investigating-blocked-ingress-spikes.html#other-links"><span>Other Links</span></a>
      </li>
    </ul>
  </li>
</ul>


              </nav>
            </div>
          </div>

        <div class="app-pane__content toc-open-disabled" aria-label="Content" tabindex="0">
          <main id="content" class="technical-documentation" data-module="anchored-headings">
            <h1 id="upgrade-terraform-version">Upgrade Terraform Version</h1>
<h2 id="introduction">Introduction</h2>
<p>The intention of this document is to provide you with a method to upgrade the Terraform version used in state across the MoJ Cloud Platform. This document won&rsquo;t go into detail on how to perform each task, as each upgrade will require different levels of attention.</p>
<h2 id="recommendations">Recommendations</h2>

<ul>
<li>Install <a href="https://github.com/tfutils/tfenv">tfenv</a> to allow you to switch between Terraform versions.</li>
</ul>
<h2 id="caveats">Caveats</h2>
<p>This document was originally written following the Terraform 0.13 to 0.14 upgrade, it&rsquo;s worth noting this was the best course of action for that particular upgrade. Over time this document will evolve and the process of upgrading will improve.</p>
<h2 id="how-to-perform-the-upgrade-divide-and-conquer">How to perform the upgrade - divide and conquer</h2>
<p>As the Cloud Platform team have decided to use a <a href="https://patrickleet.medium.com/mono-repo-or-multi-repo-why-choose-one-when-you-can-have-both-e9c77bd0c668">multi-repository</a> approach to Terraform modules it means we have a large distributed code base you&rsquo;ll be required to amend. This section of the guide will suggest an approach to break this work down and tackle it section by section. At a high level we have two Terraform state monoliths managed within the same state bucket:</p>

<ul>
<li>Cloud Platform Environments (referred to as &ldquo;Environments&rdquo; throughout this document). This holds tenant (user) state, things like a Kubernetes namespace or RDS instance.</li>
<li>Cloud Platform Infrastructure (referred to as &ldquo;Infrastructure&rdquo; throughout this document). This state represents everything required to build an MoJ Cloud Platform Kubernetes cluster, and it&rsquo;s accompanying components.</li>
</ul>
<p>Each of the sections above require individual action, outlined below.</p>
<p>Note - Not all Terraform upgrades require you to make a change to the code base.</p>
<h3 id="before-the-upgrade">Before the upgrade</h3>
<p>There are three recommended tasks required before upgrading Terraform.</p>
<h4 id="check-for-warnings-and-notices">Check for warnings and notices</h4>
<p>Terraform is good at warning end users of deprecations in future releases. Check the output of a Terraform init/validation/plan for messages of deprecations of resources that will disappear in future releases. For example, this message appeared in our Environments apply pipeline:</p>
<div class="highlight"><pre class="highlight shell" tabindex="0"><code>Warning: Interpolation-only expressions are deprecated

  on .terraform/modules/example_team_es/main.tf line 104, <span class="k">in </span>data <span class="s2">"aws_iam_policy_document"</span> <span class="s2">"elasticsearch_role_snapshot_policy"</span>:
</code></pre></div><p>It is recommended to act on these messages and look for how and why it&rsquo;s being deprecated.</p>
<h4 id="read-the-release-notes-carefully">Read the release notes carefully</h4>
<p>This sounds simple enough but it is vitally important you understand what <a href="https://github.com/hashicorp/terraform/blob/main/CHANGELOG.md">changes</a> are being made to your Terraform state.</p>
<h4 id="remove-any-test-clusters">Remove any test clusters</h4>
<p>After upgrading to a new version of Terraform you don&rsquo;t want test clusters lying around using the old version. Remove any test clusters before upgrading the Infrastructure state.</p>
<h3 id="environments-state-files">Environments state files</h3>
<p>The <a href="https://github.com/ministryofjustice/cloud-platform-environments">cloud-platform-environments</a> repository contains directories for every namespace in the MoJ Cloud Platform, for each namespace there is a single Terraform state file stored in an S3 bucket. As there are so many state files it is recommended to perform the following:</p>
<h4 id="use-the-quot-apply-quot-pipeline">Use the &ldquo;apply&rdquo; pipeline</h4>
<p>We currently use a <a href="https://concourse.cloud-platform.service.justice.gov.uk/teams/main/pipelines/environments-terraform/jobs/apply-live">concourse pipeline</a> to <code>terraform init/apply</code> everything in the cloud-platform-environments GitHub repository. This pipeline has a number of environment variables that allow it to communicate with the state bucket and amend the necessary state file. Use this pipeline to make amendments to any state in this repository.</p>
<h4 id="upgrade-the-tools-image">Upgrade the tools image</h4>
<p>Add your new Terraform version to the <a href="https://github.com/ministryofjustice/cloud-platform-tools-image">cloud-platform-tools</a> image along with the old version. This will allow you to run both versions simultaneously. You can see how this has been achieved <a href="https://github.com/ministryofjustice/cloud-platform-tools-image/commit/9d042e2fe2a5e15e992e9dbbd403fafd3098c10d">previously</a>.</p>
<h4 id="add-conditional-logic">Add conditional logic</h4>
<p>Add an if statement to the apply library that checks the version outlined in each <code>versions.tf</code> file in a namespace. Previously, this was achieved by simply making the <code>terraform</code> command <a href="https://github.com/ministryofjustice/cloud-platform-environments/pull/4366/files">variable</a>. This conditional logic allows you to upgrade the state slowly, ensuring you don&rsquo;t have issues in non-production namespaces before you upgrade production.</p>
<h4 id="upgrade-all-terraform-modules">Upgrade all Terraform modules</h4>
<p>Not all Terraform upgrades require this, but in 0.12 and 0.13 you were required to change some syntax in your code base. This can be a fairly tricky task as we maintain over 50 Terraform modules. Terraform does provide a <code>terraform upgrade</code> tool if a syntax change is required, but this will need to be executed against all modules and a new release created. This can be tedious if performed manually so there is some <a href="https://github.com/ministryofjustice/cloud-platform-terraform-upgrade">Go code</a> that does this on your behalf.</p>
<p>Using the example of upgrading to Terraform 0.13, the following was executed:</p>
<div class="highlight"><pre class="highlight shell" tabindex="0"><code>git clone https://github.com/ministryofjustice/cloud-platform-git-xargs
go run main.go <span class="nt">-o</span> <span class="s2">"ministryofjustice"</span> <span class="nt">-r</span> <span class="s2">"cloud-platform-terraform"</span> <span class="nt">-c</span> <span class="s2">"terraform 0.13upgrade"</span>
</code></pre></div><p>The code will pull down every repository in the &ldquo;ministryofjustice&rdquo; organisation with the name that contains &ldquo;cloud-platform-terraform&rdquo; and run the command &ldquo;terraform 0.13upgrade&rdquo;. It will then commit and create a Pull Request against each repository using your GitHub credentials.</p>
<p>This will result in a Pull Request output similar to the one outlined <a href="https://github.com/ministryofjustice/cloud-platform-terraform-rds-instance/pull/85/files">here</a>.</p>
<p>Once all the Pull Requests have been reviewed, merge them into main and create a new release.</p>
<p>Note: Terraform will release an <a href="https://www.terraform.io/docs/cli/commands/0.13upgrade">upgrade</a> command for each release that contains syntax changes, in the example above 0.13upgrade was used to create a more detailed <code>versions.tf</code>.</p>
<h4 id="upgrade-a-test-namespace">Upgrade a test namespace</h4>
<p>It is difficult to test an upgrade on the Environments state, this is the best way to do so, with examples.</p>

<ul>
<li><a href="https://github.com/ministryofjustice/cloud-platform-environments/commit/ad452137912a667c67c6ed065209eb2a92b85a7e#diff-b3457cb07a4d137eb78293d179b3344d1446bc9a0573b85f37639163029eaa07">Create</a> a test namespace in the cloud-platform-environments repository called <code>abdundance-namespace-dev</code> (will probably be the first namespace applied).</li>
<li>Add every resource available using the release before the Terraform upgrade work above, i.e. RDS, S3 (a full list can be found <a href="https://github.com/ministryofjustice/cloud-platform/blob/main/README.md#our-core-repos">here</a>).</li>
<li>Create a pull request and then merge to main.</li>
</ul>
<p>When the above resources are successfully built:</p>

<ul>
<li><a href="https://github.com/ministryofjustice/cloud-platform-environments/commit/2769a63f88117865440e60abe5ee0dc6e64e0761#diff-b3457cb07a4d137eb78293d179b3344d1446bc9a0573b85f37639163029eaa07">Bump</a> all of your resources to the latest, containing the Terraform upgrade.</li>
<li><a href="https://github.com/ministryofjustice/cloud-platform-environments/commit/2298836af43290e0bdb8020ffd2033703260fc51#diff-b3457cb07a4d137eb78293d179b3344d1446bc9a0573b85f37639163029eaa07">Change</a> the version in versions.tf in the cloud-platform-environments to reflect the new version.</li>
<li>Create a Pull Request against main.</li>
<li>Monitor possible changes in the plan. It should require no changes.</li>
<li>If you&rsquo;re happy with the output of the plan pipeline, merge it into main.</li>
</ul>
<h4 id="upgrade-all-non-production-namespaces">Upgrade all non-production namespaces</h4>
<p>When you&rsquo;re happy to begin upgrading users namespaces run the upgrade command against the cloud-platform-environments repository or upgrade all namespaces manually.</p>
<p>If you decide to use the tool above then perform the following:</p>
<div class="highlight"><pre class="highlight shell" tabindex="0"><code>git clone https://github.com/ministryofjustice/cloud-platform-terraform-upgrade
go run main.go <span class="nt">-o</span> <span class="s2">"ministryofjustice"</span> <span class="nt">-r</span> <span class="s2">"cloud-platform-environments"</span> <span class="nt">-c</span> <span class="s2">"terraform 0.13upgrade"</span> <span class="nt">--no-commit</span>
<span class="nb">cd </span>repositories
</code></pre></div><p>The <code>no-commit</code> argument pulls down the required repository and stores it in a directory called &lsquo;repositories&rsquo;, it then runs the upgrade against all namespaces but doesn&rsquo;t commit the changes. You&rsquo;ll want to pick and choose which namespaces to commit to ensure you&rsquo;re happy. I&rsquo;d recommend creating a new branch and commiting the non-production namespaces only, i.e. any namespace that isn&rsquo;t &ldquo;-prod&rdquo;.</p>
<p>Create a pull request against main and watch the plan pipeline once more. Again this should be clean.</p>
<p>If the plan applies no changes and you&rsquo;re happy, merge this into main.</p>
<h4 id="upgrade-all-production-namespaces">Upgrade all production namespaces</h4>
<p>Perform the above on all production namespaces.</p>
<h4 id="tidying-up">Tidying up</h4>
<p>When all namespaces in the cloud-platform-environments repository are using the new version of Terraform you can begin to clean-up any changes you&rsquo;ve made.</p>

<ul>
<li><a href="https://github.com/ministryofjustice/cloud-platform-tools-image/commit/3827ea89a95cf78146812a0275b40f3c2d20ed21">Remove</a> the multiple Terraform binaries from the cloud-platform-tools image, leaving only the new version.</li>
<li><a href="https://github.com/ministryofjustice/cloud-platform-environments/commit/b11b0372fe71289e51739395664355014df0e655">Remove</a> the conditional logic in the apply library.</li>
</ul>
<h3 id="infrastructure-state-files">Infrastructure state files</h3>
<p>The Infrastructure state we have in the Cloud Platform is structured in a tree related to its dependency,
so for example, the <a href="https://github.com/ministryofjustice/cloud-platform-infrastructure/tree/main/terraform/aws-accounts/cloud-platform-aws/vpc/eks/components">components</a> state (in the output below) relies heavily on the directory above and so on.
Here is a snapshot of how our directory looks but this is likely to change:</p>
<div class="highlight"><pre class="highlight plaintext" tabindex="0"><code>aws-accounts
‚îú‚îÄ‚îÄ cloud-platform-aws
‚îÇ   ‚îú‚îÄ‚îÄ account                  # AWS Account specific configuration.
‚îÇ   ‚îî‚îÄ‚îÄ vpc                  # VPC creation. Workspaces for individual clusters
‚îÇ       ‚îú‚îÄ‚îÄ eks                  # Holding EKS, workspaces for individual clusters.
‚îÇ       ‚îÇ   ‚îî‚îÄ‚îÄ components       # EKS components. Workspaces for individual clusters
‚îÇ       ‚îî‚îÄ‚îÄ kops                 # Holding KOPS, workspaces for individual clusters.
‚îú‚îÄ‚îÄ cloud-platform-dsd
‚îÇ   ‚îî‚îÄ‚îÄ main.tf
‚îú‚îÄ‚îÄ cloud-platform-ephemeral-test
‚îÇ   ‚îú‚îÄ‚îÄ account
‚îÇ   ‚îî‚îÄ‚îÄ vpc
‚îÇ       ‚îú‚îÄ‚îÄ eks
‚îÇ       ‚îÇ   ‚îî‚îÄ‚îÄ components
‚îî‚îÄ‚îÄ README.md
</code></pre></div><h4 id="where-to-start">Where to start</h4>
<p>Because of the structure outlined above, it&rsquo;s best to start at the components layer and work in.</p>
<h4 id="run-terraform-init-validate">Run terraform init/validate</h4>
<p>Using a tool such as tf-switch, switch to your new version and perform the command <code>terraform init -backend=false</code>. The output of this command will give you a general idea of what needs to change before your perform the upgrade. the <code>-backend=false</code> ensures the state isn&rsquo;t touched.</p>
<h4 id="infrastructure-state-files-upgrade-all-terraform-modules">Upgrade all Terraform modules</h4>
<p>Like the Environments, you need to ensure all Terraform modules will work with the new Terraform version. If there is a syntax change, it&rsquo;s recommended to run the <code>terraform upgrade</code> command on all repositories that contain &ldquo;cloud-platform-terraform&rdquo;. Either perform this manually or:</p>
<div class="highlight"><pre class="highlight shell" tabindex="0"><code>git clone https://github.com/ministryofjustice/cloud-platform-terraform-upgrade
go run main.go <span class="nt">-o</span> <span class="s2">"ministryofjustice"</span> <span class="nt">-r</span> <span class="s2">"cloud-platform-terraform"</span> <span class="nt">-c</span> <span class="s2">"&lt;insert upgrade command here&gt;"</span>
</code></pre></div><p>Which will perform the upgrade command on each repository containing &ldquo;cloud-platform-terraform&rdquo; in the name and then create a Pull Request.</p>
<h4 id="ensure-all-quot-third-party-quot-modules-conform">Ensure all &ldquo;third-party&rdquo; modules conform</h4>
<p>We use a number of third party Terraform modules (modules we don&rsquo;t control), these mainly belong to AWS, so it&rsquo;s important that you update the version of these modules and ensure it works with the Terraform version you&rsquo;re upgrading to. <a href="https://github.com/ministryofjustice/cloud-platform-terraform-monitoring/commit/ce9fb73249775c8efe09020d3db7c96ccb9ef251">Here&rsquo;s</a> an example of a change to a third party module.</p>
<h4 id="perform-terraform-init-validate-manually">Perform terraform init/validate manually</h4>
<p>With all the leg work complete, you can now perform a Terraform upgrade. We do have a pipeline that can do this on your behalf but I&rsquo;d recommend manually performing a <code>terraform init &amp;&amp; terraform apply</code>.</p>
<h4 id="work-inwards">Work inwards</h4>
<p>When you complete the upgrade on the directory/state you&rsquo;ve chosen, e.g. components, then you can work on the directory above and perform the same steps as outlined.</p>
<h4 id="upgrade-the-cloud-platform-cli-image">Upgrade the cloud-platform-cli image</h4>
<p>Finally, following the successful upgrade to your new Terraform version, upgrade the version of Terraform used in the cloud-platform-cli docker image.</p>

              <div data-module='page-expiry' data-last-reviewed-on="2024-11-24">
    <div class='page-expiry--not-expired'>
      This page was last reviewed on 24 May 2024.

        It needs to be reviewed again on 24 November 2024
        by the page owner <a href="https://mojdt.slack.com/messages/cloud-platform">#cloud-platform</a>
        .
    </div>

    <div class='page-expiry--expired'>
      This page was set to be reviewed before 24 November 2024
       by the page owner <a href="https://mojdt.slack.com/messages/cloud-platform">#cloud-platform</a>.
      This might mean the content is out of date.
    </div>
  </div>

          </main>

          <aside>
              <ul class="contribution-banner">
                <li><a href="https://github.com/ministryofjustice/cloud-platform/blob/main/runbooks/source/upgrade-terraform-version.html.md.erb">View source</a></li>
                <li><a href="https://github.com/ministryofjustice/cloud-platform/issues/new?body=Problem+with+%27Upgrade+Terraform+Version%27+%28https%3A%2F%2Frunbooks.cloud-platform.service.justice.gov.uk%2Fupgrade-terraform-version.html%29&amp;labels=bug&amp;title=Re%3A+%27Upgrade+Terraform+Version%27">Report problem</a></li>
                <li><a href="https://github.com/ministryofjustice/cloud-platform">GitHub Repo</a></li>
              </ul>
          </aside>

          <footer class="govuk-footer app-footer" role="contentinfo">
  <div class="govuk-footer__meta">
    <div class="govuk-footer__meta-item govuk-footer__meta-item--grow">


      <svg
        aria-hidden="true"
        focusable="false"
        class="govuk-footer__licence-logo"
        xmlns="http://www.w3.org/2000/svg"
        viewbox="0 0 483.2 195.7"
        height="17"
        width="41"
      >
        <path
          fill="currentColor"
          d="M421.5 142.8V.1l-50.7 32.3v161.1h112.4v-50.7zm-122.3-9.6A47.12 47.12 0 0 1 221 97.8c0-26 21.1-47.1 47.1-47.1 16.7 0 31.4 8.7 39.7 21.8l42.7-27.2A97.63 97.63 0 0 0 268.1 0c-36.5 0-68.3 20.1-85.1 49.7A98 98 0 0 0 97.8 0C43.9 0 0 43.9 0 97.8s43.9 97.8 97.8 97.8c36.5 0 68.3-20.1 85.1-49.7a97.76 97.76 0 0 0 149.6 25.4l19.4 22.2h3v-87.8h-80l24.3 27.5zM97.8 145c-26 0-47.1-21.1-47.1-47.1s21.1-47.1 47.1-47.1 47.2 21 47.2 47S123.8 145 97.8 145"
        />
      </svg>
      <span class="govuk-footer__licence-description">
        All content is available under the
        <a
          class="govuk-footer__link"
          href="https://www.nationalarchives.gov.uk/doc/open-government-licence/version/3/"
          rel="license"
        >Open Government Licence v3.0</a>, except where otherwise stated
      </span>
    </div>
    <div class="govuk-footer__meta-item">
      <a
        class="govuk-footer__link govuk-footer__copyright-logo"
        href="https://www.nationalarchives.gov.uk/information-management/re-using-public-sector-information/uk-government-licensing-framework/crown-copyright/"
      >¬© Crown copyright</a>
    </div>
  </div>
</footer>

        </div>
      </div>
    </div>

    
    <script src="javascripts/application.js"></script>
  </body>
</html>
