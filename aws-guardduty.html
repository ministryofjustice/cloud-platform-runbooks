<!doctype html>
<html lang="en" class="govuk-template no-js">
  <head>
    <meta content="IE=edge" http-equiv="X-UA-Compatible">
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover">
      <meta name="robots" content="noindex">

    <title>AWS GuardDuty Information / How to Implement - Cloud Platform Runbooks</title>

    <link href="/stylesheets/manifest.css" rel="stylesheet" />

    <link rel="canonical" href="https://runbooks.cloud-platform.service.justice.gov.uk/aws-guardduty.html">


      <meta property="og:image" content="https://runbooks.cloud-platform.service.justice.gov.uk/images/govuk-large.png" />
      <meta property="og:site_name" content="Cloud Platform Runbooks" />
      <meta property="og:title" content="AWS GuardDuty Information / How to Implement" />
      <meta property="og:type" content="object" />
      <meta property="og:url" content="https://runbooks.cloud-platform.service.justice.gov.uk/aws-guardduty.html" />
      <meta property="twitter:card" content="summary" />
      <meta property="twitter:domain" content="runbooks.cloud-platform.service.justice.gov.uk" />
      <meta property="twitter:image" content="https://runbooks.cloud-platform.service.justice.gov.uk/images/govuk-large.png" />
      <meta property="twitter:title" content="AWS GuardDuty Information / How to Implement - Cloud Platform Runbooks" />
      <meta property="twitter:url" content="https://runbooks.cloud-platform.service.justice.gov.uk/aws-guardduty.html" />

    
  </head>

  <body class="govuk-template__body">
    <script>document.body.className = ((document.body.className) ? document.body.className + ' js-enabled' : 'js-enabled');</script>

    <div class="app-pane">
      <div class="app-pane__header toc-open-disabled">
        <a href="#content" class="govuk-skip-link">Skip to main content</a>

        <header class="govuk-header app-header" role="banner" data-module="govuk-header">
  <div class="govuk-header__container govuk-header__container--full-width">
    <div class="govuk-header__logo">
      <a href="/" class="govuk-header__link govuk-header__link--homepage">
        <span class="govuk-header__product-name">
          Cloud Platform Runbooks
        </span>
      </a>
    </div>
    <div class="govuk-header__content">
      <button type="button" class="govuk-header__menu-button govuk-js-header-toggle" aria-controls="navigation" aria-label="Show or hide Top Level Navigation">Menu</button>
      <nav>
        <ul id="navigation" class="govuk-header__navigation govuk-header__navigation--end" aria-label="Top Level Navigation">
            <li class="govuk-header__navigation-item">
              <a class="govuk-header__link" href="mailto:platforms+runbooks@digital.justice.gov.uk?subject=Runbooks+feedback">Feedback / Report a problem</a>
            </li>
            <li class="govuk-header__navigation-item">
              <a class="govuk-header__link" href="/">Documentation</a>
            </li>
            <li class="govuk-header__navigation-item">
              <a class="govuk-header__link" href="https://github.com/ministryofjustice/cloud-platform/tree/main/runbooks">GitHub</a>
            </li>
        </ul>
      </nav>
    </div>
  </div>
</header>

      </div>

        <div id="toc-heading" class="toc-show fixedsticky">
          <a href="#toc" class="toc-show__label js-toc-show" aria-controls="toc">
            Table of contents <span class="toc-show__icon"></span>
          </a>
        </div>

      <div class="app-pane__body" data-module="in-page-navigation">
          <div class="app-pane__toc">
            <div class="toc" data-module="table-of-contents">
              <div class="search" data-module="search">
  <form action="https://www.google.co.uk/search" method="get" role="search">
    <input type="hidden" name="as_sitesearch" value="https://runbooks.cloud-platform.service.justice.gov.uk"/>
    <label class="govuk-label search__label" for="search">
      Search (via Google)
    </label>
    <input class="govuk-input govuk-!-margin-bottom-4" id="search" name="q" type="text" aria-controls="search-results" placeholder="Search">
  </form>
  <div id="search-results" class="search-results" aria-hidden="true" role="dialog" aria-labelledby="search-results-title">
    <div class="search-results__inner">
      <button class="search-results__close">Close<span class="search-results__close-label"> search results</span></button>
      <h2 id="search-results-title" class="search-results__title" aria-live="polite">Results</h2>
      <div class="search-results__content"></div>
    </div>
  </div>
</div>

              <a href="#" class="toc__close js-toc-close" aria-controls="toc" aria-label="Hide table of contents"></a>
              <nav id="toc" class="js-toc-list toc__list" aria-labelledby="toc-heading" data-module="collapsible-navigation">
                      <ul>
  <li>
    <a href="/#cloud-platform-runbooks"><span>Cloud Platform Runbooks</span></a>
  </li>
</ul>
<ul>
  <li>
    <a href="/how-we-work.html#how-we-work"><span>How We Work</span></a>
    <ul>
      <li>
        <a href="/how-we-work.html#getting-help"><span>Getting Help</span></a>
      </li>
      <li>
        <a href="/how-we-work.html#the-board-tickets"><span>The Board / Tickets</span></a>
        <ul>
          <li>
            <a href="/how-we-work.html#adding-tickets"><span>Adding tickets</span></a>
          </li>
          <li>
            <a href="/how-we-work.html#making-changes-to-code"><span>Making changes to code</span></a>
          </li>
          <li>
            <a href="/how-we-work.html#reviewing-merging-prs"><span>Reviewing/Merging PRs</span></a>
          </li>
        </ul>
      </li>
      <li>
        <a href="/how-we-work.html#the-hammer-of-justice"><span>The üî® Hammer of Justice</span></a>
        <ul>
          <li>
            <a href="/how-we-work.html#backlog-tickets"><span>Backlog Tickets</span></a>
          </li>
        </ul>
      </li>
      <li>
        <a href="/how-we-work.html#documentation"><span>Documentation</span></a>
      </li>
    </ul>
  </li>
</ul>
<ul>
  <li>
    <a href="/incident-process.html#incident-process"><span>Incident Process</span></a>
    <ul>
      <li>
        <a href="/incident-process.html#1-confirm-that-the-event-constitutes-an-incident"><span>1. Confirm that the event constitutes an incident</span></a>
      </li>
      <li>
        <a href="/incident-process.html#2-declare-the-incident"><span>2. Declare the incident</span></a>
        <ul>
          <li>
            <a href="/incident-process.html#examples"><span>Examples</span></a>
          </li>
        </ul>
      </li>
      <li>
        <a href="/incident-process.html#3-assign-roles"><span>3. Assign roles</span></a>
        <ul>
          <li>
            <a href="/incident-process.html#3-1-incident-lead"><span>3.1 Incident Lead</span></a>
          </li>
          <li>
            <a href="/incident-process.html#3-2-scribe"><span>3.2 Scribe</span></a>
          </li>
          <li>
            <a href="/incident-process.html#3-3-communications-lead"><span>3.3 Communications Lead</span></a>
          </li>
          <li>
            <a href="/incident-process.html#transferring-roles"><span>Transferring roles</span></a>
          </li>
        </ul>
      </li>
      <li>
        <a href="/incident-process.html#4-fix-the-problem"><span>4. Fix the problem</span></a>
      </li>
      <li>
        <a href="/incident-process.html#5-end-the-incident"><span>5. End the incident</span></a>
      </li>
      <li>
        <a href="/incident-process.html#6-post-incident-procedure"><span>6. Post-incident procedure</span></a>
      </li>
    </ul>
  </li>
</ul>
<ul>
  <li>
    <a href="/incident-log.html#incident-log"><span>Incident Log</span></a>
    <ul>
      <li>
        <a href="/incident-log.html#q4-2020-october-december"><span>Q4 2020 (October - December)</span></a>
        <ul>
          <li>
            <a href="/incident-log.html#incident-on-2020-10-06-09-07-intermittent-quot-micro-downtimes-quot-on-various-services-using-dedicated-ingress-controllers"><span>Incident on 2020-10-06 09:07 - Intermittent ‚Äúmicro-downtimes‚Äù on various services using dedicated ingress controllers</span></a>
          </li>
        </ul>
      </li>
      <li>
        <a href="/incident-log.html#q3-2020-july-september"><span>Q3 2020 (July - September)</span></a>
        <ul>
          <li>
            <a href="/incident-log.html#incident-on-2020-09-28-13-10-termination-of-nodes-updating-kops-instance-group"><span>Incident on 2020-09-28 13:10 - Termination of nodes updating kops Instance Group.</span></a>
          </li>
          <li>
            <a href="/incident-log.html#incident-on-2020-09-21-18-27-some-cloud-platform-components-destroyed"><span>Incident on 2020-09-21 18:27 - Some cloud-platform components destroyed.</span></a>
          </li>
          <li>
            <a href="/incident-log.html#incident-on-2020-09-07-12-54-all-users-are-unable-to-create-new-ingress-rules"><span>Incident on 2020-09-07 12:54 - All users are unable to create new ingress rules</span></a>
          </li>
          <li>
            <a href="/incident-log.html#incident-on-2020-08-25-11-26-connectivity-issues-with-eu-west-2a"><span>Incident on 2020-08-25 11:26 - Connectivity issues with eu-west-2a</span></a>
          </li>
          <li>
            <a href="/incident-log.html#incident-on-2020-08-14-11-01-ingress-controllers-crashlooping"><span>Incident on 2020-08-14 11:01 - Ingress-controllers crashlooping</span></a>
          </li>
          <li>
            <a href="/incident-log.html#incident-on-2020-08-07-16-39-master-node-provisioning-failure"><span>Incident on 2020-08-07 16:39 - Master node provisioning failure</span></a>
          </li>
        </ul>
      </li>
      <li>
        <a href="/incident-log.html#q2-2020-april-june"><span>Q2 2020 (April - June)</span></a>
        <ul>
          <li>
            <a href="/incident-log.html#incident-on-2020-08-04-17-13"><span>Incident on 2020-08-04 17:13</span></a>
          </li>
          <li>
            <a href="/incident-log.html#incident-on-2020-04-15-10-58-nginx-tls"><span>Incident on 2020-04-15 10:58 Nginx/TLS</span></a>
          </li>
        </ul>
      </li>
      <li>
        <a href="/incident-log.html#q1-2020-january-march"><span>Q1 2020 (January - March)</span></a>
        <ul>
          <li>
            <a href="/incident-log.html#incident-on-2020-02-25-10-58"><span>Incident on 2020-02-25 10:58</span></a>
          </li>
          <li>
            <a href="/incident-log.html#incident-on-2020-02-18-14-13-utc"><span>Incident on 2020-02-18 14:13 UTC</span></a>
          </li>
          <li>
            <a href="/incident-log.html#incident-on-2020-02-12-11-45-utc"><span>Incident on 2020-02-12 11:45 UTC</span></a>
          </li>
        </ul>
      </li>
      <li>
        <a href="/incident-log.html#about-this-incident-log"><span>About this incident log</span></a>
      </li>
      <li>
        <a href="/incident-log.html#template"><span>Template</span></a>
        <ul>
          <li>
            <a href="/incident-log.html#incident-on-yyyy-mm-dd-hh-mm-brief-description"><span>Incident on YYYY-MM-DD HH:MM - [Brief description]</span></a>
          </li>
        </ul>
      </li>
      <li>
        <a href="/incident-log.html#key-events"><span>Key events</span></a>
      </li>
      <li>
        <a href="/incident-log.html#impact"><span>Impact:</span></a>
      </li>
      <li>
        <a href="/incident-log.html#context"><span>Context:</span></a>
      </li>
      <li>
        <a href="/incident-log.html#resolution"><span>Resolution:</span></a>
      </li>
    </ul>
  </li>
</ul>
<ul>
  <li>
    <a href="/create-cluster.html#create-a-new-cluster"><span>Create a new cluster</span></a>
    <ul>
      <li>
        <a href="/create-cluster.html#pre-requisites"><span>Pre-requisites</span></a>
      </li>
      <li>
        <a href="/create-cluster.html#environment-variables"><span>Environment Variables</span></a>
      </li>
      <li>
        <a href="/create-cluster.html#run-the-build-script-via-the-tools-image"><span>Run the build script, via the tools image</span></a>
      </li>
      <li>
        <a href="/create-cluster.html#alerts"><span>Alerts</span></a>
        <ul>
          <li>
            <a href="/create-cluster.html#apply-the-changes"><span>Apply the changes</span></a>
          </li>
        </ul>
      </li>
      <li>
        <a href="/create-cluster.html#authenticating"><span>Authenticating</span></a>
      </li>
    </ul>
  </li>
</ul>
<ul>
  <li>
    <a href="/add-concourse-to-cluster.html#add-concourse-to-a-test-cluster"><span>Add Concourse to a test cluster</span></a>
    <ul>
      <li>
        <a href="/add-concourse-to-cluster.html#add-concourse-to-a-test-cluster-pre-requisites"><span>Pre-requisites</span></a>
      </li>
      <li>
        <a href="/add-concourse-to-cluster.html#process"><span>Process</span></a>
      </li>
    </ul>
  </li>
</ul>
<ul>
  <li>
    <a href="/changes-in-cloudplatform.html#change-process-in-cloud-platform"><span>Change Process in Cloud Platform</span></a>
    <ul>
      <li>
        <a href="/changes-in-cloudplatform.html#making-changes-to-cloud-plarform-infrastructure"><span>Making Changes to cloud-plarform-infrastructure</span></a>
      </li>
      <li>
        <a href="/changes-in-cloudplatform.html#marking-changes-to-terraform-modules"><span>Marking Changes to terraform modules</span></a>
      </li>
      <li>
        <a href="/changes-in-cloudplatform.html#making-changes-to-helm-charts"><span>Making Changes to Helm Charts</span></a>
      </li>
      <li>
        <a href="/changes-in-cloudplatform.html#making-changes-to-environments-service-teams"><span>Making changes to environments (Service Teams)</span></a>
      </li>
      <li>
        <a href="/changes-in-cloudplatform.html#communications"><span>Communications</span></a>
      </li>
    </ul>
  </li>
</ul>
<ul>
  <li>
    <a href="/upgrade-cluster.html#upgrade-a-cluster"><span>Upgrade a cluster</span></a>
    <ul>
      <li>
        <a href="/upgrade-cluster.html#planning"><span>Planning</span></a>
      </li>
      <li>
        <a href="/upgrade-cluster.html#upgrade-a-cluster-pre-requisites"><span>Pre-requisites</span></a>
        <ul>
          <li>
            <a href="/upgrade-cluster.html#setup-environment"><span>Setup environment</span></a>
          </li>
          <li>
            <a href="/upgrade-cluster.html#run-integration-tests"><span>Run integration tests</span></a>
          </li>
          <li>
            <a href="/upgrade-cluster.html#sanity-checks"><span>Sanity checks</span></a>
          </li>
          <li>
            <a href="/upgrade-cluster.html#run-a-shell-in-the-tools-image"><span>Run a shell in the tools image</span></a>
          </li>
        </ul>
      </li>
      <li>
        <a href="/upgrade-cluster.html#run-the-upgrade"><span>Run the upgrade</span></a>
        <ul>
          <li>
            <a href="/upgrade-cluster.html#authenticate-to-the-cluster"><span>Authenticate to the cluster</span></a>
          </li>
          <li>
            <a href="/upgrade-cluster.html#update-the-live-cluster-manifest"><span>Update the live cluster manifest</span></a>
          </li>
          <li>
            <a href="/upgrade-cluster.html#push-changes-to-kops-state"><span>Push changes to kops state</span></a>
          </li>
          <li>
            <a href="/upgrade-cluster.html#perform-a-rolling-update"><span>Perform a rolling-update</span></a>
          </li>
          <li>
            <a href="/upgrade-cluster.html#take-stock-of-current-running-worker-nodes"><span>Take stock of current running worker nodes</span></a>
          </li>
          <li>
            <a href="/upgrade-cluster.html#create-new-worker-instance-group"><span>Create new worker instance group</span></a>
          </li>
          <li>
            <a href="/upgrade-cluster.html#cordon-old-workers"><span>Cordon old workers</span></a>
          </li>
          <li>
            <a href="/upgrade-cluster.html#scale-number-of-ingress-controllers"><span>Scale number of ingress controllers</span></a>
          </li>
          <li>
            <a href="/upgrade-cluster.html#drain-the-old-worker-nodes"><span>Drain the old worker nodes</span></a>
          </li>
          <li>
            <a href="/upgrade-cluster.html#validate-the-cluster"><span>Validate the cluster</span></a>
          </li>
          <li>
            <a href="/upgrade-cluster.html#run-integration-tests-again"><span>Run integration tests again</span></a>
          </li>
          <li>
            <a href="/upgrade-cluster.html#delete-the-old-instance-group"><span>Delete the old instance group</span></a>
          </li>
          <li>
            <a href="/upgrade-cluster.html#scale-the-ingress-controllers-down"><span>Scale the ingress-controllers down</span></a>
          </li>
        </ul>
      </li>
      <li>
        <a href="/upgrade-cluster.html#commit-changes-back-to-master"><span>Commit changes back to master</span></a>
      </li>
    </ul>
  </li>
</ul>
<ul>
  <li>
    <a href="/upgrade-eks-cluster.html#upgrade-eks-cluster-s"><span>Upgrade EKS cluster(s)</span></a>
    <ul>
      <li>
        <a href="/upgrade-eks-cluster.html#upgrade-eks-cluster-s-pre-requisites"><span>Pre-requisites</span></a>
      </li>
      <li>
        <a href="/upgrade-eks-cluster.html#upgrade-eks-cluster-s-run-the-upgrade"><span>Run the upgrade</span></a>
        <ul>
          <li>
            <a href="/upgrade-eks-cluster.html#upgrade-control-plane"><span>Upgrade Control Plane</span></a>
          </li>
          <li>
            <a href="/upgrade-eks-cluster.html#upgrade-node-groups"><span>Upgrade Node Groups</span></a>
          </li>
        </ul>
      </li>
    </ul>
  </li>
</ul>
<ul>
  <li>
    <a href="/delete-cluster.html#delete-a-cluster"><span>Delete a cluster</span></a>
    <ul>
      <li>
        <a href="/delete-cluster.html#delete-the-cluster-using-the-script"><span>Delete the cluster using the script</span></a>
        <ul>
          <li>
            <a href="/delete-cluster.html#first-run-make-tools-shell"><span>First, run make tools-shell</span></a>
          </li>
        </ul>
      </li>
      <li>
        <a href="/delete-cluster.html#delete-the-cluster-using-concourse-fly-commands"><span>Delete the cluster using concourse fly commands</span></a>
      </li>
      <li>
        <a href="/delete-cluster.html#delete-the-cluster-manually"><span>Delete the cluster manually</span></a>
      </li>
      <li>
        <a href="/delete-cluster.html#delete-an-eks-cluster"><span>Delete an EKS cluster</span></a>
      </li>
    </ul>
  </li>
</ul>
<ul>
  <li>
    <a href="/add-nodes-to-the-cluster.html#add-nodes-to-the-cluster"><span>Add nodes to the cluster</span></a>
    <ul>
      <li>
        <ul>
          <li>
            <a href="/add-nodes-to-the-cluster.html#requirements"><span>Requirements</span></a>
          </li>
          <li>
            <a href="/add-nodes-to-the-cluster.html#inline-edit"><span>Inline edit</span></a>
          </li>
          <li>
            <a href="/add-nodes-to-the-cluster.html#persisting-the-changes"><span>Persisting the changes</span></a>
          </li>
        </ul>
      </li>
    </ul>
  </li>
</ul>
<ul>
  <li>
    <a href="/add-nodes-to-the-eks-cluster.html#add-nodes-change-the-instance-type-of-the-aws-eks-cluster"><span>Add nodes/change the instance type of the AWS EKS cluster</span></a>
    <ul>
      <li>
        <a href="/add-nodes-to-the-eks-cluster.html#add-nodes-to-the-eks-cluster"><span>Add nodes to the eks cluster</span></a>
        <ul>
          <li>
            <a href="/add-nodes-to-the-eks-cluster.html#add-nodes-to-the-eks-cluster-requirements"><span>Requirements</span></a>
          </li>
          <li>
            <a href="/add-nodes-to-the-eks-cluster.html#cluster-configuration"><span>Cluster configuration:</span></a>
          </li>
          <li>
            <a href="/add-nodes-to-the-eks-cluster.html#issue"><span>Issue</span></a>
          </li>
        </ul>
      </li>
      <li>
        <a href="/add-nodes-to-the-eks-cluster.html#change-the-aws-eks-instance-type-worker-node-machine-type"><span>Change the AWS EKS instance type (worker_node_machine_type)</span></a>
      </li>
    </ul>
  </li>
</ul>
<ul>
  <li>
    <a href="/auth0-rotation.html#credentials-rotation-for-auth0-apps"><span>Credentials rotation for auth0 apps</span></a>
    <ul>
      <li>
        <a href="/auth0-rotation.html#preparation"><span>Preparation</span></a>
      </li>
      <li>
        <a href="/auth0-rotation.html#1-taint-resources-terraform"><span>1) Taint resources (terraform)</span></a>
      </li>
      <li>
        <a href="/auth0-rotation.html#2-rolling-update-of-cluster-kops"><span>2) Rolling update of cluster (kops)</span></a>
      </li>
      <li>
        <a href="/auth0-rotation.html#3-apply-changes-within-components-terraform"><span>3) Apply changes within components (terraform)</span></a>
      </li>
      <li>
        <a href="/auth0-rotation.html#4-update-environment-repo"><span>4) Update environment repo</span></a>
      </li>
      <li>
        <a href="/auth0-rotation.html#5-verifiying-changes"><span>5) Verifiying changes</span></a>
      </li>
      <li>
        <a href="/auth0-rotation.html#6-update-pipelines"><span>6) Update pipelines</span></a>
      </li>
    </ul>
  </li>
</ul>
<ul>
  <li>
    <a href="/rotate-git-crypt-key.html#git-crypt"><span>Git-crypt</span></a>
    <ul>
      <li>
        <a href="/rotate-git-crypt-key.html#adding-new-user-to-the-keyring"><span>Adding new user to the keyring</span></a>
      </li>
      <li>
        <a href="/rotate-git-crypt-key.html#rotating-the-git-crypt-key"><span>Rotating the git-crypt key</span></a>
        <ul>
          <li>
          </li>
        </ul>
      </li>
    </ul>
  </li>
</ul>
<ul>
  <li>
    <a href="/virtual-memory-nginx.html#failed-to-allocate-shared-memory"><span>Failed to allocate shared memory</span></a>
  </li>
</ul>
<ul>
  <li>
    <a href="/custom-domain.html#add-a-custom-domain"><span>Add a custom domain</span></a>
  </li>
</ul>
<ul>
  <li>
    <a href="/add-new-receiver-alert-manager.html#add-a-new-alertmanager-receiver-and-a-slack-webhook"><span>Add a new Alertmanager receiver and a slack webhook</span></a>
    <ul>
      <li>
        <a href="/add-new-receiver-alert-manager.html#add-a-new-alertmanager-receiver-and-a-slack-webhook-pre-requisites"><span>Pre-requisites</span></a>
      </li>
      <li>
        <a href="/add-new-receiver-alert-manager.html#creating-a-new-receiver-set"><span>Creating a new receiver set</span></a>
      </li>
      <li>
        <a href="/add-new-receiver-alert-manager.html#information-alerts"><span>Information Alerts</span></a>
      </li>
    </ul>
  </li>
</ul>
<ul>
  <li>
    <a href="/disaster-recovery.html#cloud-platform-disaster-recovery"><span>Cloud Platform Disaster Recovery</span></a>
    <ul>
      <li>
        <a href="/disaster-recovery.html#restore-process"><span>Restore process</span></a>
      </li>
      <li>
        <a href="/disaster-recovery.html#apply-cloud-platform-resources"><span>Apply cloud-platform resources</span></a>
      </li>
      <li>
        <a href="/disaster-recovery.html#cloud-platform-disaster-recovery-create-a-new-cluster"><span>Create a new cluster</span></a>
      </li>
      <li>
        <a href="/disaster-recovery.html#perform-the-restore"><span>Perform the restore</span></a>
        <ul>
          <li>
            <a href="/disaster-recovery.html#perform-the-restore-pre-requisites"><span>Pre-requisites</span></a>
          </li>
          <li>
            <a href="/disaster-recovery.html#restore-the-cluster-using-etcd-manager-ctl-on-your-computer"><span>Restore the cluster using etcd-manager-ctl on your computer.</span></a>
          </li>
          <li>
            <a href="/disaster-recovery.html#restore-process-inside-the-etcd-container-using-etcd-manager-ctl"><span>Restore process inside the etcd container using etcd-manager-ctl.</span></a>
          </li>
        </ul>
      </li>
      <li>
        <a href="/disaster-recovery.html#cleanup"><span>Cleanup</span></a>
      </li>
      <li>
        <a href="/disaster-recovery.html#possible-issues"><span>Possible Issues</span></a>
      </li>
    </ul>
  </li>
</ul>
<ul>
  <li>
    <a href="/disaster-recovery-scenarios.html#cloud-platform-disaster-recovery-scenarios"><span>Cloud Platform Disaster Recovery Scenarios</span></a>
    <ul>
      <li>
        <a href="/disaster-recovery-scenarios.html#losing-a-namespace"><span>Losing a Namespace</span></a>
        <ul>
          <li>
            <a href="/disaster-recovery-scenarios.html#losing-a-namespace-impact"><span>Impact</span></a>
          </li>
          <li>
            <a href="/disaster-recovery-scenarios.html#possible-cause"><span>Possible Cause</span></a>
          </li>
          <li>
            <a href="/disaster-recovery-scenarios.html#losing-a-namespace-restore-process"><span>Restore process</span></a>
          </li>
        </ul>
      </li>
      <li>
        <a href="/disaster-recovery-scenarios.html#losing-a-kubernetes-component-or-object"><span>Losing a Kubernetes Component or Object</span></a>
        <ul>
          <li>
            <a href="/disaster-recovery-scenarios.html#losing-a-kubernetes-component-or-object-impact"><span>Impact</span></a>
          </li>
          <li>
            <a href="/disaster-recovery-scenarios.html#losing-a-kubernetes-component-or-object-possible-cause"><span>Possible Cause</span></a>
          </li>
          <li>
            <a href="/disaster-recovery-scenarios.html#losing-a-kubernetes-component-or-object-restore-process"><span>Restore process</span></a>
          </li>
        </ul>
      </li>
      <li>
        <a href="/disaster-recovery-scenarios.html#losing-the-whole-cluster"><span>Losing the whole cluster</span></a>
        <ul>
          <li>
            <a href="/disaster-recovery-scenarios.html#losing-the-whole-cluster-impact"><span>Impact</span></a>
          </li>
          <li>
            <a href="/disaster-recovery-scenarios.html#losing-the-whole-cluster-possible-cause"><span>Possible Cause</span></a>
          </li>
          <li>
            <a href="/disaster-recovery-scenarios.html#how-this-plan-is-tested"><span>How this plan is tested:</span></a>
          </li>
          <li>
            <a href="/disaster-recovery-scenarios.html#assumptions"><span>Assumptions</span></a>
          </li>
          <li>
            <a href="/disaster-recovery-scenarios.html#losing-the-whole-cluster-restore-process"><span>Restore process</span></a>
          </li>
        </ul>
      </li>
      <li>
        <a href="/disaster-recovery-scenarios.html#deleted-corrupted-the-kops-state"><span>Deleted/corrupted the kops state</span></a>
        <ul>
          <li>
            <a href="/disaster-recovery-scenarios.html#deleted-corrupted-the-kops-state-impact"><span>Impact</span></a>
          </li>
          <li>
            <a href="/disaster-recovery-scenarios.html#deleted-corrupted-the-kops-state-possible-cause"><span>Possible Cause</span></a>
          </li>
          <li>
            <a href="/disaster-recovery-scenarios.html#restore-process-for-corrupted-kops-state"><span>Restore process for corrupted kops state</span></a>
          </li>
          <li>
            <a href="/disaster-recovery-scenarios.html#restore-process-for-deleted-s3-bucket-where-kops-state-is-stored"><span>Restore process for deleted S3 bucket where kops state is stored</span></a>
          </li>
        </ul>
      </li>
      <li>
        <a href="/disaster-recovery-scenarios.html#deleted-terraform-state"><span>Deleted terraform state</span></a>
        <ul>
          <li>
            <a href="/disaster-recovery-scenarios.html#deleted-terraform-state-impact"><span>Impact</span></a>
          </li>
          <li>
            <a href="/disaster-recovery-scenarios.html#deleted-terraform-state-possible-cause"><span>Possible Cause</span></a>
          </li>
          <li>
            <a href="/disaster-recovery-scenarios.html#deleted-terraform-state-restore-process"><span>Restore process</span></a>
          </li>
          <li>
            <a href="/disaster-recovery-scenarios.html#recovering-more-complex-scenarios"><span>Recovering more complex scenarios</span></a>
          </li>
        </ul>
      </li>
      <li>
        <a href="/disaster-recovery-scenarios.html#lost-or-corrupt-etcd-volume"><span>Lost or corrupt etcd volume</span></a>
        <ul>
          <li>
            <a href="/disaster-recovery-scenarios.html#lost-or-corrupt-etcd-volume-impact"><span>Impact</span></a>
          </li>
          <li>
            <a href="/disaster-recovery-scenarios.html#lost-or-corrupt-etcd-volume-possible-cause"><span>Possible Cause</span></a>
          </li>
          <li>
            <a href="/disaster-recovery-scenarios.html#lost-or-corrupt-etcd-volume-restore-process"><span>Restore process</span></a>
          </li>
        </ul>
      </li>
      <li>
        <a href="/disaster-recovery-scenarios.html#overwriting-kops-cluster-39-s-components-with-eks-components"><span>Overwriting KOPS cluster‚Äôs components with EKS components</span></a>
        <ul>
          <li>
            <a href="/disaster-recovery-scenarios.html#overwriting-kops-cluster-39-s-components-with-eks-components-impact"><span>Impact</span></a>
          </li>
          <li>
            <a href="/disaster-recovery-scenarios.html#overwriting-kops-cluster-39-s-components-with-eks-components-possible-cause"><span>Possible Cause</span></a>
          </li>
          <li>
            <a href="/disaster-recovery-scenarios.html#overwriting-kops-cluster-39-s-components-with-eks-components-restore-process"><span>Restore process</span></a>
          </li>
          <li>
            <a href="/disaster-recovery-scenarios.html#reproducing-incident-steps"><span>Reproducing Incident Steps</span></a>
          </li>
          <li>
            <a href="/disaster-recovery-scenarios.html#velero-backup"><span>Velero Backup</span></a>
          </li>
          <li>
            <a href="/disaster-recovery-scenarios.html#apply-the-eks-components-to-the-kops-cluster"><span>Apply the EKS components to the KOPS cluster</span></a>
          </li>
          <li>
            <a href="/disaster-recovery-scenarios.html#observations-of-incident"><span>Observations of Incident</span></a>
          </li>
          <li>
            <a href="/disaster-recovery-scenarios.html#destroy-the-eks-components"><span>Destroy the EKS components</span></a>
          </li>
          <li>
            <a href="/disaster-recovery-scenarios.html#re-apply-the-kops-components"><span>Re-apply the KOPS components</span></a>
          </li>
        </ul>
      </li>
    </ul>
  </li>
</ul>
<ul>
  <li>
    <a href="/replacing-live1.html#replacing-live-1-would-be-hard-because"><span>Replacing Live-1 Would be Hard Because‚Ä¶</span></a>
    <ul>
      <li>
        <a href="/replacing-live1.html#reasons-replacing-live-1-is-hard"><span>Reasons replacing live-1 is hard:</span></a>
      </li>
      <li>
        <a href="/replacing-live1.html#solved-issues"><span>Solved issues</span></a>
      </li>
    </ul>
  </li>
</ul>
<ul>
  <li>
    <a href="/rotate-user-aws-credentials.html#rotate-user-aws-credentials"><span>Rotate User AWS Credentials</span></a>
    <ul>
      <li>
        <ul>
          <li>
          </li>
          <li>
            <a href="/rotate-user-aws-credentials.html#2-identify-the-compromised-terraform-object"><span>2. Identify the compromised terraform object</span></a>
          </li>
          <li>
            <a href="/rotate-user-aws-credentials.html#3-destroy-the-compromised-key"><span>3. Destroy the compromised key</span></a>
          </li>
          <li>
            <a href="/rotate-user-aws-credentials.html#4-let-terraform-create-a-new-key"><span>4. Let terraform create a new key</span></a>
          </li>
        </ul>
      </li>
    </ul>
  </li>
</ul>
<ul>
  <li>
    <a href="/aws-leaked-credentials.html#aws-compromised-credentials"><span>AWS Compromised Credentials</span></a>
    <ul>
      <li>
        <a href="/aws-leaked-credentials.html#steps-for-a-leaked-credentials"><span>Steps for a leaked credentials</span></a>
      </li>
      <li>
        <a href="/aws-leaked-credentials.html#getting-new-credentials"><span>Getting new credentials</span></a>
      </li>
    </ul>
  </li>
</ul>
<ul>
  <li>
    <a href="/aws-create-user.html#aws-console-access"><span>AWS Console Access</span></a>
    <ul>
      <li>
        <a href="/aws-create-user.html#steps-to-create-delete-users"><span>Steps to create/delete users</span></a>
      </li>
      <li>
        <a href="/aws-create-user.html#activating-mfa-for-new-users"><span>Activating MFA for new users</span></a>
      </li>
    </ul>
  </li>
</ul>
<ul>
  <li>
    <a href="/aws-guardduty.html#aws-guardduty-information-how-to-implement"><span>AWS GuardDuty Information / How to Implement</span></a>
    <ul>
      <li>
        <ul>
          <li>
            <a href="/aws-guardduty.html#aws-guardduty-accounts"><span>AWS GuardDuty Accounts</span></a>
          </li>
        </ul>
      </li>
      <li>
        <a href="/aws-guardduty.html#our-current-setup"><span>Our Current setup</span></a>
        <ul>
          <li>
            <a href="/aws-guardduty.html#aws-guardduty-findings-for-live-1-aws-resources"><span>AWS GuardDuty Findings for live-1 AWS resources</span></a>
          </li>
          <li>
            <a href="/aws-guardduty.html#aws-guardduty-findings-for-aws-member-account-resources"><span>AWS GuardDuty Findings for AWS member account resources</span></a>
          </li>
        </ul>
      </li>
      <li>
        <a href="/aws-guardduty.html#table-of-contents"><span>Table of contents</span></a>
        <ul>
          <li>
            <a href="/aws-guardduty.html#1-prerequisite-files"><span>1. Prerequisite files</span></a>
          </li>
          <li>
            <a href="/aws-guardduty.html#2-adding-a-new-member-account"><span>2. Adding a new member account</span></a>
          </li>
          <li>
            <a href="/aws-guardduty.html#3-applying-the-terraform-changes"><span>3. Applying the terraform changes</span></a>
          </li>
        </ul>
      </li>
    </ul>
  </li>
</ul>
<ul>
  <li>
    <a href="/public-s3-bucket.html#make-an-s3-bucket-public"><span>Make an S3 bucket public</span></a>
  </li>
</ul>
<ul>
  <li>
    <a href="/delete-prometheus-metrics.html#delete-prometheus-metrics"><span>Delete Prometheus Metrics</span></a>
    <ul>
      <li>
        <a href="/delete-prometheus-metrics.html#1-identify-the-metrics-you-want-to-delete"><span>1.  Identify the metrics you want to delete</span></a>
      </li>
      <li>
        <a href="/delete-prometheus-metrics.html#2-enable-the-admin-interface-in-prometheus"><span>2. Enable the admin interface in Prometheus</span></a>
      </li>
      <li>
        <a href="/delete-prometheus-metrics.html#3-launch-a-port-forward-pod"><span>3. Launch a port-forward pod</span></a>
      </li>
      <li>
        <a href="/delete-prometheus-metrics.html#4-forward-local-traffic-to-prometheus"><span>4. Forward local traffic to Prometheus</span></a>
      </li>
      <li>
        <a href="/delete-prometheus-metrics.html#5-use-curl-in-another-terminal-to-hit-the-api-endpoint"><span>5. Use curl (in another terminal) to hit the API endpoint</span></a>
      </li>
      <li>
        <a href="/delete-prometheus-metrics.html#6-use-this-script-to-delete-multiple-metrics"><span>6. Use this script to delete multiple metrics</span></a>
      </li>
      <li>
        <a href="/delete-prometheus-metrics.html#7-clean-up"><span>7. Clean up</span></a>
      </li>
    </ul>
  </li>
</ul>
<ul>
  <li>
    <a href="/remove-orphaned-namespace.html#remove-39-orphaned-39-namespaces-and-aws-resources"><span>Remove ‚Äòorphaned‚Äô namespaces and AWS resources</span></a>
    <ul>
      <li>
        <ul>
          <li>
            <a href="/remove-orphaned-namespace.html#1-git-clone-the-environments-checker-repository"><span>1. git clone the environments checker repository</span></a>
          </li>
          <li>
            <a href="/remove-orphaned-namespace.html#2-create-a-env-live1-file-containing-the-environment-variables-the-checker-requires"><span>2. Create a .env.live1 file, containing the environment variables the checker requires</span></a>
          </li>
          <li>
            <a href="/remove-orphaned-namespace.html#3-do-a-dry-run-of-deleting-the-target-namespace"><span>3. Do a dry run of deleting the target namespace</span></a>
          </li>
          <li>
            <a href="/remove-orphaned-namespace.html#4-delete-the-aws-resources-and-the-cluster-namespace"><span>4. Delete the AWS resources and the cluster namespace</span></a>
          </li>
        </ul>
      </li>
    </ul>
  </li>
</ul>
<ul>
  <li>
    <a href="/manually-apply-namespace.html#manually-plan-apply-namespace-resources"><span>Manually Plan/Apply Namespace Resources</span></a>
    <ul>
      <li>
        <a href="/manually-apply-namespace.html#start-in-the-appropriate-branch-of-the-environments-repo"><span>Start in the appropriate branch of the environments repo</span></a>
      </li>
      <li>
        <a href="/manually-apply-namespace.html#set-pingdom-environment-variables-optional"><span>Set pingdom environment variables(Optional)</span></a>
      </li>
      <li>
        <a href="/manually-apply-namespace.html#target-the-live-1-cluster"><span>Target the live-1 cluster</span></a>
      </li>
      <li>
        <a href="/manually-apply-namespace.html#set-some-environment-variables"><span>Set some environment variables</span></a>
      </li>
      <li>
        <a href="/manually-apply-namespace.html#set-the-namespace-name"><span>Set the namespace name</span></a>
      </li>
      <li>
        <a href="/manually-apply-namespace.html#terraform-init"><span>Terraform Init</span></a>
      </li>
      <li>
        <a href="/manually-apply-namespace.html#terraform-plan-apply"><span>Terraform Plan/Apply</span></a>
      </li>
    </ul>
  </li>
</ul>
<ul>
  <li>
    <a href="/manually-delete-namespace-resources.html#manually-delete-namespace-resources"><span>Manually Delete Namespace Resources</span></a>
  </li>
</ul>
<ul>
  <li>
    <a href="/remove-data-from-elasticsearch.html#remove-data-from-elasticsearch"><span>Remove data from Elasticsearch</span></a>
    <ul>
      <li>
        <a href="/remove-data-from-elasticsearch.html#stop-the-breach-first"><span>Stop the breach first</span></a>
      </li>
      <li>
        <a href="/remove-data-from-elasticsearch.html#things-to-know"><span>Things to know</span></a>
      </li>
      <li>
        <a href="/remove-data-from-elasticsearch.html#build-your-query"><span>Build your query</span></a>
      </li>
      <li>
        <a href="/remove-data-from-elasticsearch.html#delete-by-query"><span>Delete by query</span></a>
      </li>
      <li>
        <a href="/remove-data-from-elasticsearch.html#removing-specific-logs-filtered-by-phrase"><span>Removing specific logs filtered by phrase</span></a>
      </li>
    </ul>
  </li>
</ul>
<ul>
  <li>
    <a href="/export-elasticsearch-to-csv.html#export-data-from-elasticsearch-into-a-csv-file"><span>Export data from Elasticsearch into a CSV file</span></a>
    <ul>
      <li>
        <a href="/export-elasticsearch-to-csv.html#workaround"><span>Workaround</span></a>
        <ul>
          <li>
            <a href="/export-elasticsearch-to-csv.html#install-es2csv"><span>Install es2csv</span></a>
          </li>
          <li>
            <a href="/export-elasticsearch-to-csv.html#usage"><span>Usage</span></a>
          </li>
        </ul>
      </li>
    </ul>
  </li>
</ul>
<ul>
  <li>
    <a href="/delete-state-lock.html#delete-terraform-state-lock"><span>Delete terraform state lock</span></a>
  </li>
</ul>
<ul>
  <li>
    <a href="/error-refreshing-state.html#terraform-state-lock-error-refreshing-state"><span>Terraform state lock - Error refreshing state</span></a>
  </li>
</ul>
<ul>
  <li>
    <a href="/divergence-error.html#how-to-investigate-divergence-errors"><span>How to Investigate Divergence Errors</span></a>
    <ul>
      <li>
        <a href="/divergence-error.html#reproduce-the-plan"><span>Reproduce the plan</span></a>
      </li>
    </ul>
  </li>
</ul>
<ul>
  <li>
    <a href="/replacing-failed-master-node.html#recover-from-an-etcd-failure"><span>Recover from an etcd failure</span></a>
    <ul>
      <li>
        <a href="/replacing-failed-master-node.html#recover-from-an-etcd-failure-pre-requisites"><span>Pre-requisites</span></a>
      </li>
      <li>
        <a href="/replacing-failed-master-node.html#identify-the-failed-master-node"><span>Identify the failed master node</span></a>
      </li>
      <li>
        <a href="/replacing-failed-master-node.html#remove-the-unhealthy-etcd-member"><span>Remove the unhealthy etcd member.</span></a>
      </li>
      <li>
        <a href="/replacing-failed-master-node.html#replacing-the-failed-master-via-kops"><span>Replacing the failed master via kops</span></a>
        <ul>
          <li>
          </li>
        </ul>
      </li>
    </ul>
  </li>
</ul>
<ul>
  <li>
    <a href="/recycle-node.html#recycle-node"><span>Recycle-node</span></a>
    <ul>
      <li>
        <a href="/recycle-node.html#guidance-for-the-cloud-platform-team-when-the-recycle-node-pipeline-job-fails"><span>Guidance for the Cloud Platform team, when the recycle-node pipeline job fails:</span></a>
      </li>
    </ul>
  </li>
</ul>
<ul>
  <li>
    <a href="/zero-downtime-ingress-upgrade.html#zero-downtime-ingress-controller-upgrade"><span>Zero-downtime Ingress Controller Upgrade</span></a>
    <ul>
      <li>
        <a href="/zero-downtime-ingress-upgrade.html#procedure"><span>Procedure</span></a>
      </li>
    </ul>
  </li>
</ul>
<ul>
  <li>
    <a href="/multiple-clusters.html#managing-multiple-clusters"><span>Managing Multiple Clusters</span></a>
    <ul>
      <li>
        <ul>
          <li>
            <a href="/multiple-clusters.html#overview"><span>Overview</span></a>
          </li>
        </ul>
      </li>
    </ul>
  </li>
</ul>
<ul>
  <li>
    <a href="/eks-tools-cluster.html#provisioning-eks-clusters"><span>Provisioning EKS clusters</span></a>
    <ul>
      <li>
        <a href="/eks-tools-cluster.html#provisioning-eks-clusters-pre-requisites"><span>Pre-requisites</span></a>
      </li>
      <li>
        <a href="/eks-tools-cluster.html#provisioning"><span>Provisioning</span></a>
        <ul>
          <li>
            <a href="/eks-tools-cluster.html#1-vpc"><span>1. VPC</span></a>
          </li>
          <li>
            <a href="/eks-tools-cluster.html#2-creating-eks-cluster"><span>2. Creating EKS cluster</span></a>
          </li>
          <li>
            <a href="/eks-tools-cluster.html#3-deploy-components"><span>3. Deploy components</span></a>
          </li>
          <li>
            <a href="/eks-tools-cluster.html#4-delete-the-eks-cluster"><span>4. Delete the EKS cluster</span></a>
          </li>
        </ul>
      </li>
    </ul>
  </li>
</ul>
<ul>
  <li>
    <a href="/post-migration.html#post-migration-cleanup"><span>Post migration cleanup</span></a>
    <ul>
      <li>
        <a href="/post-migration.html#post-migration-cleanup-table-of-contents"><span>Table of contents</span></a>
      </li>
      <li>
        <a href="/post-migration.html#when-to-use-this-document"><span>When to use this document?</span></a>
      </li>
      <li>
        <a href="/post-migration.html#0-pre-requisites"><span>0. Pre-requisites</span></a>
        <ul>
          <li>
          </li>
        </ul>
      </li>
      <li>
        <a href="/post-migration.html#1-turn-off-template-deploy-monitoring-and-alerting"><span>1. Turn off Template Deploy monitoring and alerting</span></a>
        <ul>
          <li>
          </li>
        </ul>
      </li>
      <li>
        <a href="/post-migration.html#2-archive-the-deployment-repository"><span>2. Archive the deployment repository</span></a>
        <ul>
          <li>
          </li>
        </ul>
      </li>
      <li>
        <a href="/post-migration.html#3-backup-old-template-deploy-data"><span>3. Backup old Template Deploy data</span></a>
        <ul>
          <li>
          </li>
        </ul>
      </li>
      <li>
        <a href="/post-migration.html#4-delete-the-old-cloudformation-stack"><span>4. Delete the old CloudFormation stack</span></a>
        <ul>
          <li>
          </li>
        </ul>
      </li>
      <li>
        <a href="/post-migration.html#5-ensure-removal-of-resources"><span>5. Ensure removal of resources</span></a>
        <ul>
          <li>
          </li>
        </ul>
      </li>
      <li>
        <a href="/post-migration.html#6-ensure-live-service-is-still-functioning"><span>6. Ensure live service is still functioning!</span></a>
        <ul>
          <li>
          </li>
        </ul>
      </li>
    </ul>
  </li>
</ul>
<ul>
  <li>
    <a href="/expand.html#expanding-persistent-volumes-created-using-statefulsets"><span>Expanding Persistent Volumes created using StatefulSets</span></a>
  </li>
</ul>
<ul>
  <li>
    <a href="/velero.html#velero-cluster-backups-and-disaster-recovery"><span>Velero - Cluster backups and disaster recovery</span></a>
    <ul>
      <li>
        <ul>
          <li>
          </li>
        </ul>
      </li>
      <li>
        <a href="/velero.html#backups"><span>Backups</span></a>
        <ul>
          <li>
            <a href="/velero.html#why"><span>Why?</span></a>
          </li>
          <li>
            <a href="/velero.html#what"><span>What?</span></a>
          </li>
          <li>
            <a href="/velero.html#how"><span>How?</span></a>
          </li>
        </ul>
      </li>
    </ul>
  </li>
</ul>
<ul>
  <li>
    <a href="/sonarqube-scan.html#sonarqube-code-quality-and-security-scanning"><span>Sonarqube - Code quality and security scanning</span></a>
    <ul>
      <li>
        <a href="/sonarqube-scan.html#sonarqube-scanning"><span>Sonarqube scanning</span></a>
        <ul>
          <li>
            <a href="/sonarqube-scan.html#sonarqube-scan-all-repositories"><span>Sonarqube scan all repositories</span></a>
          </li>
          <li>
            <a href="/sonarqube-scan.html#sonarqube-github-action"><span>Sonarqube Github Action</span></a>
          </li>
        </ul>
      </li>
    </ul>
  </li>
</ul>
<ul>
  <li>
    <a href="/virtualenv.html#virtual-environment-copy-for-template-deploy-updates"><span>Virtual environment copy for template deploy updates</span></a>
    <ul>
      <li>
        <ul>
          <li>
          </li>
        </ul>
      </li>
    </ul>
  </li>
</ul>
<ul>
  <li>
    <a href="/running-kops-update-rollingupdate.html#running-kops-update-and-rollingupdate"><span>Running Kops Update and Rollingupdate</span></a>
    <ul>
      <li>
        <a href="/running-kops-update-rollingupdate.html#using-kops-to-change-the-cluster"><span>Using kops to change the cluster</span></a>
      </li>
      <li>
        <a href="/running-kops-update-rollingupdate.html#running-kops-update-and-rollingupdate-pre-requisites"><span>Pre-requisites</span></a>
      </li>
      <li>
        <a href="/running-kops-update-rollingupdate.html#updating-the-kops-state"><span>Updating the kops state</span></a>
        <ul>
          <li>
            <a href="/running-kops-update-rollingupdate.html#generating-an-updated-kops-config-file"><span>Generating an updated kops config file</span></a>
          </li>
          <li>
            <a href="/running-kops-update-rollingupdate.html#applying-local-changes-to-the-kops-state-store"><span>Applying local changes to the kops state store</span></a>
          </li>
        </ul>
      </li>
      <li>
        <a href="/running-kops-update-rollingupdate.html#running-kops-update"><span>Running Kops update</span></a>
      </li>
      <li>
        <a href="/running-kops-update-rollingupdate.html#running-kops-rolling-update"><span>Running Kops rolling-update</span></a>
      </li>
      <li>
        <a href="/running-kops-update-rollingupdate.html#possible-errors"><span>Possible Errors</span></a>
      </li>
    </ul>
  </li>
</ul>
<ul>
  <li>
    <a href="/helm-repository.html#cloud-platform-helm-chart-repository"><span>Cloud Platform helm chart repository</span></a>
    <ul>
      <li>
        <a href="/helm-repository.html#performing-crud-on-cloud-platform-helm-repository"><span>Performing CRUD on Cloud Platform Helm repository</span></a>
      </li>
    </ul>
  </li>
</ul>
<ul>
  <li>
    <a href="/access-eks-cluster.html#access-eks-cluster"><span>Access EKS cluster</span></a>
    <ul>
      <li>
        <a href="/access-eks-cluster.html#access-eks-cluster-pre-requisites"><span>Pre-requisites</span></a>
        <ul>
          <li>
            <a href="/access-eks-cluster.html#create-kubeconfig-using-aws-command"><span>Create kubeconfig using aws command</span></a>
          </li>
          <li>
            <a href="/access-eks-cluster.html#create-kubeconfig-manually-using-template"><span>Create kubeconfig manually using template</span></a>
          </li>
        </ul>
      </li>
    </ul>
  </li>
</ul>
<ul>
  <li>
    <a href="/joiners-guide.html#onboarding-into-the-cloud-platform-team"><span>Onboarding into the Cloud Platform Team</span></a>
    <ul>
      <li>
        <a href="/joiners-guide.html#people-team"><span>People Team</span></a>
      </li>
      <li>
        <a href="/joiners-guide.html#service-desk"><span>Service Desk</span></a>
      </li>
      <li>
        <a href="/joiners-guide.html#sit-down-with-dm"><span>Sit down with DM</span></a>
      </li>
      <li>
        <a href="/joiners-guide.html#cloud-platform-team"><span>Cloud Platform team</span></a>
      </li>
      <li>
        <a href="/joiners-guide.html#access"><span>ACCESS</span></a>
      </li>
    </ul>
  </li>
</ul>
<ul>
  <li>
    <a href="/add-new-opa-policy.html#open-policy-agent-policies"><span>Open Policy Agent policies</span></a>
    <ul>
      <li>
        <a href="/add-new-opa-policy.html#adding-a-policy"><span>Adding a policy</span></a>
      </li>
      <li>
        <a href="/add-new-opa-policy.html#writing-tests"><span>Writing tests</span></a>
      </li>
      <li>
        <a href="/add-new-opa-policy.html#references"><span>References</span></a>
      </li>
    </ul>
  </li>
</ul>
<ul>
  <li>
    <a href="/leavers-guide.html#leavers-guide"><span>Leavers Guide</span></a>
    <ul>
      <li>
        <a href="/leavers-guide.html#revoking-access"><span>Revoking Access</span></a>
        <ul>
          <li>
            <a href="/leavers-guide.html#digital-services"><span>Digital Services</span></a>
          </li>
          <li>
            <a href="/leavers-guide.html#aws-accounts"><span>AWS Accounts</span></a>
          </li>
        </ul>
      </li>
    </ul>
  </li>
</ul>
<ul>
  <li>
    <a href="/scheduled-pr-reminders.html#scheduled-pr-reminders"><span>Scheduled PR Reminders</span></a>
    <ul>
      <li>
        <ul>
          <li>
            <a href="/scheduled-pr-reminders.html#steps-required-for-new-repositories"><span>Steps required for new repositories</span></a>
          </li>
        </ul>
      </li>
    </ul>
  </li>
</ul>
<ul>
  <li>
    <a href="/grafana-dashboards.html#grafana-dashboards"><span>Grafana Dashboards</span></a>
    <ul>
      <li>
        <a href="/grafana-dashboards.html#kubernetes-number-of-pods-per-node"><span>Kubernetes Number of Pods per Node</span></a>
        <ul>
          <li>
            <a href="/grafana-dashboards.html#dashboard-layout"><span>Dashboard Layout</span></a>
          </li>
        </ul>
      </li>
    </ul>
  </li>
</ul>
<ul>
  <li>
    <a href="/on-call.html#going-on-call"><span>Going on call</span></a>
    <ul>
      <li>
        <a href="/on-call.html#what-s-expected"><span>What‚Äôs expected?</span></a>
        <ul>
          <li>
            <a href="/on-call.html#expected"><span>Expected:</span></a>
          </li>
          <li>
            <a href="/on-call.html#not-expected"><span>Not Expected:</span></a>
          </li>
        </ul>
      </li>
      <li>
        <a href="/on-call.html#where-do-i-start"><span>Where do I start?</span></a>
      </li>
      <li>
        <a href="/on-call.html#what-do-i-get-for-being-on-call"><span>What do I get for being on call?</span></a>
      </li>
      <li>
        <a href="/on-call.html#civil-servants"><span>Civil servants</span></a>
      </li>
      <li>
        <a href="/on-call.html#contractors"><span>Contractors</span></a>
      </li>
    </ul>
  </li>
</ul>
<ul>
  <li>
    <a href="/manual-ssl-certificate-processes.html#create-manual-ssl-certificate-processes"><span>Create Manual SSL Certificate Processes</span></a>
    <ul>
      <li>
        <a href="/manual-ssl-certificate-processes.html#create-manual-ssl-certificate-processes-pre-requisites"><span>Pre-requisites</span></a>
      </li>
      <li>
        <a href="/manual-ssl-certificate-processes.html#requesting-a-new-certificate-via-gandi-net"><span>Requesting a new certificate via Gandi.net</span></a>
      </li>
      <li>
        <a href="/manual-ssl-certificate-processes.html#renewing-a-new-certificate-via-gandi-net"><span>Renewing a new certificate via Gandi.net</span></a>
      </li>
      <li>
        <a href="/manual-ssl-certificate-processes.html#revoking-gandi-net-certificates"><span>Revoking Gandi.net certificates</span></a>
      </li>
      <li>
        <a href="/manual-ssl-certificate-processes.html#costs-funding-information"><span>Costs/Funding information</span></a>
      </li>
    </ul>
  </li>
</ul>
<ul>
  <li>
    <a href="/os-places-api-key-management.html#os-places-api-key-management"><span>OS Places API Key Management</span></a>
    <ul>
      <li>
        <a href="/os-places-api-key-management.html#os-places-api-key-management-pre-requisites"><span>Pre-requisites</span></a>
      </li>
      <li>
        <a href="/os-places-api-key-management.html#creating-a-new-api-key"><span>Creating a new API key</span></a>
      </li>
      <li>
        <a href="/os-places-api-key-management.html#revoking-an-api-key"><span>Revoking an API key</span></a>
      </li>
    </ul>
  </li>
</ul>
<ul>
  <li>
    <a href="/cloud-platform-communications-plan.html#cloud-platform-communications-plan"><span>Cloud Platform Communications Plan</span></a>
    <ul>
      <li>
        <a href="/cloud-platform-communications-plan.html#the-plan"><span>The Plan</span></a>
      </li>
      <li>
        <a href="/cloud-platform-communications-plan.html#tips-on-format-of-communications"><span>Tips on format of communications</span></a>
        <ul>
          <li>
            <a href="/cloud-platform-communications-plan.html#tips-on-format-of-communications-examples"><span>Examples</span></a>
          </li>
          <li>
            <a href="/cloud-platform-communications-plan.html#things-to-include-in-incident-communications"><span>Things to include in incident communications</span></a>
          </li>
          <li>
            <a href="/cloud-platform-communications-plan.html#example"><span>Example</span></a>
          </li>
          <li>
            <a href="/cloud-platform-communications-plan.html#things-to-include-in-upgrade-communications"><span>Things to include in upgrade communications</span></a>
          </li>
          <li>
            <a href="/cloud-platform-communications-plan.html#tips-on-format-of-communications-example"><span>Example</span></a>
          </li>
        </ul>
      </li>
      <li>
        <a href="/cloud-platform-communications-plan.html#sharing-information-with-the-wider-ministry-of-justice-and-the-public"><span>Sharing information with the wider Ministry of Justice and the Public</span></a>
      </li>
    </ul>
  </li>
</ul>
<ul>
  <li>
    <a href="/tips-and-tricks.html#tips-and-tricks"><span>Tips and Tricks</span></a>
    <ul>
      <li>
        <a href="/tips-and-tricks.html#delete-an-rds-database-snapshot"><span>Delete an RDS database snapshot</span></a>
      </li>
      <li>
        <a href="/tips-and-tricks.html#check-the-expiration-date-of-the-ssl-certificate-for-a-live-domain"><span>Check the expiration date of the SSL certificate for a live domain</span></a>
      </li>
      <li>
        <a href="/tips-and-tricks.html#run-etcdctl-on-a-master-node"><span>Run etcdctl on a master node</span></a>
      </li>
      <li>
        <a href="/tips-and-tricks.html#delete-a-quot-stuck-quot-resource"><span>Delete a ‚Äústuck‚Äù resource</span></a>
      </li>
      <li>
        <a href="/tips-and-tricks.html#filter-namespaces-by-specific-label-or-annotation"><span>Filter namespaces by specific label or annotation</span></a>
      </li>
      <li>
        <a href="/tips-and-tricks.html#find-all-pods-running-on-a-specific-worker-node"><span>Find all pods running on a specific worker node</span></a>
      </li>
      <li>
        <a href="/tips-and-tricks.html#count-pods-running-on-all-nodes"><span>Count pods running on all nodes</span></a>
      </li>
      <li>
        <a href="/tips-and-tricks.html#install-tmux-and-docker-on-the-live-1-bastion-host"><span>Install tmux and docker on the live-1 bastion host</span></a>
      </li>
      <li>
        <a href="/tips-and-tricks.html#output-all-records-from-route53-as-a-csv-file"><span>Output all records from Route53 as a CSV file</span></a>
      </li>
      <li>
        <a href="/tips-and-tricks.html#add-more-rss-feeds-to-cloud-platform-rss-channel"><span>Add more RSS feeds to #cloud-platform-rss channel</span></a>
      </li>
      <li>
        <a href="/tips-and-tricks.html#find-files-which-don-39-t-contain-a-particular-string"><span>Find files which don‚Äôt contain a particular string</span></a>
      </li>
    </ul>
  </li>
</ul>
<ul>
  <li>
    <a href="/template-deploy-run-books.html#template-deploy-runbooks"><span>Template-deploy Runbooks</span></a>
    <ul>
      <li>
        <a href="/template-deploy-run-books.html#general-incident-procedure"><span>General Incident Procedure</span></a>
      </li>
      <li>
        <a href="/template-deploy-run-books.html#existing-runbooks"><span>Existing Runbooks</span></a>
      </li>
    </ul>
  </li>
</ul>
<ul>
  <li>
    <a href="/add-a-new-runbook.html#add-a-new-runbook"><span>Add a new runbook</span></a>
    <ul>
      <li>
        <ul>
          <li>
          </li>
        </ul>
      </li>
    </ul>
  </li>
</ul>
<ul>
  <li>
    <a href="/custom-default-backend.html#custom-default-backend"><span>Custom default-backend</span></a>
    <ul>
      <li>
        <ul>
          <li>
            <a href="/custom-default-backend.html#background"><span>Background</span></a>
          </li>
          <li>
            <a href="/custom-default-backend.html#use-platform-level-error-page"><span>Use platform-level error page</span></a>
          </li>
          <li>
            <a href="/custom-default-backend.html#not-use-platform-level-error-page"><span>Not use platform-level error page</span></a>
          </li>
        </ul>
      </li>
    </ul>
  </li>
</ul>


              </nav>
            </div>
          </div>

        <div class="app-pane__content toc-open-disabled">
          <main id="content" class="technical-documentation" data-module="anchored-headings">
              <h1 id="aws-guardduty-information-how-to-implement">AWS GuardDuty Information / How to Implement</h1><p><a href="https://docs.aws.amazon.com/guardduty/index.html">Amazon GuardDuty</a> is a continuous security monitoring service that analyzes and processes the following data sources:</p>

<ul>
<li>VPC Flow Logs</li>
<li>AWS CloudTrail event logs</li>
<li>DNS logs.</li>
</ul>
<p>It uses threat intelligence feeds to identify unexpected and potentially unauthorized and malicious activity within your AWS environment, such as:</p>

<ul>
<li>lists of malicious IPs</li>
<li>lists of malicious domains</li>
<li>machine learning</li>
</ul>
<p>GuardDuty informs you of the status of your AWS environment by producing security <a href="https://eu-west-2.console.aws.amazon.com/guardduty/home?region=eu-west-2#/findings?macros=current">findings</a> that can be viewed in the GuardDuty console or through Amazon CloudWatch events.</p>
<p>GuardDuty findings include issues like escalations of privilege, uses of exposed credentials, or communication with malicious IPs, URLs, or domains. For example, GuardDuty can detect compromised EC2 instances serving malware or mining bitcoin.</p>
<p>It also monitors AWS account access behaviour for signs of compromise, such as unauthorized infrastructure deployments (e.g. instances deployed in a region that has never been used), or unusual API calls (e.g. a password policy change to reduce password strength).</p>
<h3 id="aws-guardduty-accounts">AWS GuardDuty Accounts</h3>
<ul>
<li><a href="https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_accounts.html#guardduty_master">Master Account</a></li>
</ul>
<p>A designated account that can configure GuardDuty as well as view and manage GuardDuty findings for its own account and all associated member accounts.</p>

<ul>
<li><a href="https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_accounts.html#guardduty_member">Member Accounts</a></li>
</ul>
<p>Invited (by Master Account) to enable GuardDuty and become associated with the Master AWS account (once an invitation has been accepted).</p>
<h2 id="our-current-setup">Our Current setup</h2><p>Our setup at the moment is as follows:</p>

<ul>
<li><p>There are at present two master GuardDuty accounts - both in the moj-cp AWS account:</p>

<ul>
<li> One set up in the London AWS region

<ul>
<li> This is for our cloud-platform live-1 AWS resources <a href="https://eu-west-2.console.aws.amazon.com/guardduty/home?region=eu-west-2#/findings?macros=current">moj-cp -London region</a></li>
</ul></li>
<li> One set up in the Ireland AWS region

<ul>
<li> this controls several member AWS linked accounts. It is mainly for template-deploy related <a href="https://eu-west-1.console.aws.amazon.com/guardduty/home?region=eu-west-1#/linked-accounts">member accounts</a>.</li>
</ul></li>
</ul></li>
</ul>
<h3 id="aws-guardduty-findings-for-live-1-aws-resources">AWS GuardDuty Findings for live-1 AWS resources</h3>
<ul>
<li>Findings that AWS GuardDuty reports for Global AWS resources/services (i.e IAM, S3 etc) are in the master account &ldquo;AWS GuardDuty Findings&rdquo; dashboard in the Ireland AWS region.</li>
<li>Findings that AWS GuardDuty reports for specific regional AWS resources/services (i.e EC2, VPC etc) are in the master account &ldquo;AWS GuardDuty Findings&rdquo; dashboard in the London AWS region.</li>
</ul>
<h3 id="aws-guardduty-findings-for-aws-member-account-resources">AWS GuardDuty Findings for AWS member account resources</h3>
<ul>
<li>Findings that AWS GuardDuty reports for  AWS member accounts appear in the AWS GuardDuty Findings dashboard for the relevant member (in that AWS account) and are collated in the master account (Ireland AWS region)</li>
</ul>
<p>Any findings in GuardDuty are sent to Cloudwatch event rules that then integrate with AWS SNS (Simple Notification Service) topics and subscriptions. These are alerted to Pagerduty (presently &lsquo;in office hours&rsquo;) and then onto slack channels (at the moment #lower-priority-alarms)</p>
<p>Please see <a href="https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_settingup.html">AWS GuardDuty</a> regarding setting up AWS GuardDuty.</p>
<p>Also see here <a href="https://aws.amazon.com/guardduty/faqs/">AWS Cloudwatch frequently asked questions</a> where most general information regarding this service can be found</p>
<p>Please also see <a href="https://www.terraform.io/docs/providers/aws/r/guardduty_detector.html">terraform AWS GuardDuty detector </a> regarding setting up the config (here) for terraform AWS GuardDuty detector</p>
<h2 id="table-of-contents">Table of contents</h2>
<ul>
<li><a href="#1-prerequisite-files">1. Prerequisite files</a></li>
<li><a href="#2-adding-a-new-member-account">2. Adding a new member account</a></li>
<li><a href="#3-applying-the-terraform-changes">3. Applying the terraform changes</a></li>
<li><a href="#4-pagerduty-to-slack-integration">4. Pagerduty to Slack integration</a></li>
</ul>
<h3 id="1-prerequisite-files">1. Prerequisite files</h3>
<ul>
<li><a href="#main-configuration-file">Main Configuration File</a> (guardduty.tf)</li>
<li><a href="#terraform-variables-file">Terraform Variables File</a> (terraform.tfvars)</li>
<li><a href="#aws-cloudwatch-event-rules-file">AWS Cloudwatch Event Rules File</a> (event-pattern.json)</li>
<li><a href="#trusted-ip-list-file">Trusted ip List File</a>  (iplist.txt)</li>
<li><a href="#variables-initialisation-file">Variables Initialisation File</a> (variables.tf)</li>
</ul>
<h4 id="main-configuration-file">Main Configuration File</h4><p><a href="https://github.com/ministryofjustice/cloud-platform-infrastructure/blob/main/terraform/global-resources/guardduty.tf">&lsquo;guardduty.tf&rsquo;</a> contains code for the following config:</p>

<ul>
<li>Enabling and turning GuardDuty on for the master account.</li>
<li>Enabling and turning GuardDuty on for the member account.</li>
<li>Setting up the S3 bucket and then adding trusted IP ranges etc to its contents.</li>
<li>On the master account - setting up the IAM group with the appropriate IAM policies, allowing the setup, configuration and use of GuardDuty. Also allowing full access to the contents of the security bucket.</li>
<li>On the master account - Adding chosen IAM users to the IAM groups so that they have admin permissions to set up and use GuardDuty.</li>
<li>On the master account - Setting up AWS Cloudwatch Event rules to integrate with &lsquo;AWS GuardDuty Findings&rsquo; and config to alert to the relevant AWS SNS topic (and thence onto PagerDuty).</li>
<li>On the master account - Setting up the relevant GuardDuty AWS SNS (Simple Notification Service) topic and subscription.</li>
</ul>
<h4 id="terraform-variables-file">Terraform Variables File</h4><p><a href="https://github.com/ministryofjustice/cloud-platform-infrastructure/blob/main/terraform/global-resources/terraform.tfvars">terraform.tfvars</a> contains code for the following config variables:</p>

<ul>
<li><code>aws_region</code></li>
<li><code>aws_profile</code> for the master and member accounts (set locally in <code>~/.aws/credentials</code>). This is set up using the format <code>moj-[account]</code> (see <a href="https://github.com/ministryofjustice/cloud-platform-infrastructure/blob/main/terraform/global-resources/terraform.tfvars">terraform.tfvars</a>)</li>
<li><code>aws_account_id</code> (the id for the master and member AWS accounts)</li>
<li><code>integration_key</code> (the Amazon-GuardDuty service integration key configured in PagerDuty to integrate with AWS Guardduty)</li>
<li><code>users</code> (admin AWS IAM  users)</li>
<li><code>topic_arn = &quot;arn:aws:sns:eu-west-1:[aws-account-id]:GuardDuty-notifications&quot;</code> (this is how it will be configured as an AWS SNS (Simple Notification Service) topic</li>
<li><code>endpoint = https://events.pagerduty.com/integration/[pagerduty to AWS Guardduty integraion_key]/enqueue</code> this is required by the SNS subscription endpoint configuration)</li>
<li>member_email (the email to which the initial invitation email(s) should be sent {from the master account} when setting up GuardDuty on the member account - this must match the email used to set up the root account)</li>
</ul>
<h4 id="aws-cloudwatch-event-rules-file">AWS Cloudwatch Event Rules File</h4><p><a href="https://github.com/ministryofjustice/cloud-platform-infrastructure/blob/main/terraform/global-resources/resources/event-pattern.json">event-pattern.json</a></p>

<ul>
<li>A JSON object that is used by &lsquo;AWS Cloudwatch Event Rules&rsquo; and related &lsquo;Targets&rsquo; to select &lsquo;AWS Guardduty Events&rsquo; (findings) and route them to the AWS SNS targets.</li>
</ul>
<p>When raising the actual finding in an AWS account, GuardDuty normalizes the raised finding to have one of three integer values. See <a href="https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_findings.html#guardduty_filter-findings">AWS Findings</a> for further information:</p>

<ul>
<li>  Severity Rating/ScoreRange: Value for Raised Findings

<ul>
<li>  Low (0.1-3.9): 2</li>
<li>  Medium (4.0-6.9): 5</li>
<li>  High (7.0-8.9): 8</li>
<li>  (9.0 - 10.0) - NA (Reserved by AWS and NOT Implemented for any active findings)</li>
</ul></li>
</ul>
<p>Example JSON file, configured for high priority:</p>
<div class="highlight"><pre class="highlight plaintext"><code>{
  "detail-type": [
    "GuardDuty Finding"
  ],
  "source": [
    "aws.guardduty"
  ],
    "detail": {
      "severity": [
        7,
        7.0,
        7.1,
        7.2,
        7.3,
        7.4,
        7.5,
        7.6,
        7.7,
        7.8,
        7.9,
        8,
        8.0,
        8.1,
        8.2,
        8.3,
        8.4,
        8.5,
        8.6,
        8.7,
        8.8,
        8.9
      ]
    }
  }
</code></pre></div><h4 id="trusted-ip-list-file">Trusted IP List File</h4><p><a href="https://github.com/ministryofjustice/cloud-platform-infrastructure/blob/main/terraform/global-resources/resources/iplist.txt">iplist.txt</a></p>

<ul>
<li>A trusted IP list. </li>
</ul>
<p>GuardDuty does not generate findings for IP addresses that are included in this trusted IP list/s</p>
<p>At this point in time terraform is unable to update this list via <code>terraform apply</code></p>
<p>The list has to be manually deleted in the AWS dashboard &gt;  Guardduty &gt; Lists &gt; Trusted IP Lists. Then you can run the <code>terraform apply</code></p>
<h4 id="variables-initialisation-file">Variables Initialisation File</h4><p><a href="https://github.com/ministryofjustice/cloud-platform-infrastructure/blob/main/terraform/global-resources/variables.tf">variables.tf</a></p>

<ul>
<li>Used to set up the terraform variables and defaults required by terraform &lsquo;guardduty.tf&rsquo;</li>
</ul>
<h3 id="2-adding-a-new-member-account">2. Adding a new member account</h3>
<ul>
<li>In <code>guardduty.tf</code> add the following (incrementing the membership number as required):</li>
</ul>
<div class="highlight"><pre class="highlight plaintext"><code># -----------------------------------------------------------
# membership7 account provider
# -----------------------------------------------------------

provider "aws.member7" {
  region  = "${var.aws_region}"
  profile = "${var.aws_member7_profile}"
}

# -----------------------------------------------------------
# membership7 account GuardDuty detector
# -----------------------------------------------------------

resource "aws_guardduty_detector" "member7" {
  provider = "aws.member7"

  enable                       = true
  finding_publishing_frequency = "FIFTEEN_MINUTES"
}

# -----------------------------------------------------------
# membership7 account GuardDuty member
# -----------------------------------------------------------

resource "aws_guardduty_member" "member7" {
  account_id         = "${aws_guardduty_detector.member7.account_id}"
  detector_id        = "${aws_guardduty_detector.master.id}"
  email              = "${var.member7_email}"
  invite             = true
  invitation_message = "please accept guardduty invitation"
}
</code></pre></div>
<ul>
<li>In <code>variable.tf</code> add the following (incrementing the membership number as required):</li>
</ul>
<div class="highlight"><pre class="highlight plaintext"><code>variable "aws_member7_account_id" {}
variable "aws_member7_profile" {}
variable "member7_email" {}
</code></pre></div>
<ul>
<li>In <code>terraform.tfvars</code> add the following (incrementing the membership number as required):</li>
</ul>
<div class="highlight"><pre class="highlight plaintext"><code>aws_member7_profile = "moj-[account name]"
aws_member7_account_id = "[aws account id]"
member7_email = "[root email address at time of account creation]"
</code></pre></div>
<ul>
<li>In the AWS member account dashboard go to: GuardDuty link &gt; Accounts &gt; Accept the invite</li>
</ul>
<p>This will add GuardDuty in the member account. Findings will now also appear in the GuardDuty master account.</p>
<h3 id="3-applying-the-terraform-changes">3. Applying the terraform changes</h3><div class="highlight"><pre class="highlight plaintext"><code>terraform init
terraform plan
terraform apply (answer 'yes' to actually update remote config)
</code></pre></div>
<ul>
<li>As at 16/03/2020 there was a problem where an actual AWS account had been removed/deactivated (and credentials no longer worked) - that related to a GuardDuty membership account.</li>
</ul>
<p>If possible to alleviate this problem - take the following action in the following order (before the AWS account is actually deactivated/deleted:</p>

<ul>
<li> remove &lsquo;resource &ldquo;aws_guardduty_detector&rdquo; &ldquo;member&hellip;.&rdquo;&rsquo; - terraform apply</li>
<li> remove &lsquo;resource &ldquo;aws_guardduty_member&rdquo; &ldquo;member&hellip;.&rdquo;&rsquo;   - terraform apply</li>
<li> then delete/deactivate the actual AWS account</li>
</ul>
<p>If the above is not possible - due to the AWS account having already been deleted then:</p>
<div class="highlight"><pre class="highlight plaintext"><code>terraform state rm aws_guardduty_detector.member....
terraform state rm aws_guardduty_member.member....
</code></pre></div>

              <div data-module='page-expiry' data-last-reviewed-on="2021-01-09">
    <div class='page-expiry--not-expired'>
      This page was last reviewed on 9 October 2020.

        It needs to be reviewed again on 9 January 2021
        by the page owner <a href="https://mojdt.slack.com/messages/cloud-platform">#cloud-platform</a>
        .
    </div>

    <div class='page-expiry--expired'>
      This page was set to be reviewed before 9 January 2021
       by the page owner <a href="https://mojdt.slack.com/messages/cloud-platform">#cloud-platform</a>.
      This might mean the content is out of date.
    </div>
  </div>

          </main>

          <aside>
              <ul class="contribution-banner">
                <li><a href="https://github.com/ministryofjustice/cloud-platform/blob/main/runbooks/source/aws-guardduty.html.md.erb">View source</a></li>
                <li><a href="https://github.com/ministryofjustice/cloud-platform/issues/new?labels=bug&amp;title=Re:%20'AWS%20GuardDuty%20Information%20/%20How%20to%20Implement'&amp;body=Problem%20with%20'AWS%20GuardDuty%20Information%20/%20How%20to%20Implement'%20(https://runbooks.cloud-platform.service.justice.gov.uk/aws-guardduty.html)">Report problem</a></li>
                <li><a href="https://github.com/ministryofjustice/cloud-platform">GitHub Repo</a></li>
              </ul>
          </aside>

          <footer class="govuk-footer app-footer" role="contentinfo">
  <div class="govuk-footer__meta">
    <div class="govuk-footer__meta-item govuk-footer__meta-item--grow">


      <svg
        aria-hidden="true"
        focusable="false"
        class="govuk-footer__licence-logo"
        xmlns="http://www.w3.org/2000/svg"
        viewbox="0 0 483.2 195.7"
        height="17"
        width="41"
      >
        <path
          fill="currentColor"
          d="M421.5 142.8V.1l-50.7 32.3v161.1h112.4v-50.7zm-122.3-9.6A47.12 47.12 0 0 1 221 97.8c0-26 21.1-47.1 47.1-47.1 16.7 0 31.4 8.7 39.7 21.8l42.7-27.2A97.63 97.63 0 0 0 268.1 0c-36.5 0-68.3 20.1-85.1 49.7A98 98 0 0 0 97.8 0C43.9 0 0 43.9 0 97.8s43.9 97.8 97.8 97.8c36.5 0 68.3-20.1 85.1-49.7a97.76 97.76 0 0 0 149.6 25.4l19.4 22.2h3v-87.8h-80l24.3 27.5zM97.8 145c-26 0-47.1-21.1-47.1-47.1s21.1-47.1 47.1-47.1 47.2 21 47.2 47S123.8 145 97.8 145"
        />
      </svg>
      <span class="govuk-footer__licence-description">
        All content is available under the
        <a
          class="govuk-footer__link"
          href="https://www.nationalarchives.gov.uk/doc/open-government-licence/version/3/"
          rel="license"
        >Open Government Licence v3.0</a>, except where otherwise stated
      </span>
    </div>
    <div class="govuk-footer__meta-item">
      <a
        class="govuk-footer__link govuk-footer__copyright-logo"
        href="https://www.nationalarchives.gov.uk/information-management/re-using-public-sector-information/uk-government-licensing-framework/crown-copyright/"
      >¬© Crown copyright</a>
    </div>
  </div>
</footer>

        </div>
      </div>
    </div>

    
    <script src="/javascripts/application.js"></script>
  </body>
</html>
