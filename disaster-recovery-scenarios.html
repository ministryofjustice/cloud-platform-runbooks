<!doctype html>
<html lang="en" class="govuk-template no-js">
  <head>
    <meta content="IE=edge" http-equiv="X-UA-Compatible">
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover">

    <title>Cloud Platform Disaster Recovery Scenarios - Cloud Platform Runbooks</title>

    <link href="/stylesheets/manifest.css" rel="stylesheet" />

    <link rel="canonical" href="https://runbooks.cloud-platform.service.justice.gov.uk/disaster-recovery-scenarios.html">

      <meta name="robots" content="noindex" />
      <meta name="twitter:card" content="summary" />
      <meta name="twitter:domain" content="runbooks.cloud-platform.service.justice.gov.uk" />
      <meta name="twitter:image" content="https://runbooks.cloud-platform.service.justice.gov.uk/images/govuk-large.png" />
      <meta name="twitter:title" content="Cloud Platform Disaster Recovery Scenarios - Cloud Platform Runbooks" />
      <meta name="twitter:url" content="https://runbooks.cloud-platform.service.justice.gov.uk/disaster-recovery-scenarios.html" />

      <meta property="og:image" content="https://runbooks.cloud-platform.service.justice.gov.uk/images/govuk-large.png" />
      <meta property="og:site_name" content="Cloud Platform Runbooks" />
      <meta property="og:title" content="Cloud Platform Disaster Recovery Scenarios" />
      <meta property="og:type" content="object" />
      <meta property="og:url" content="https://runbooks.cloud-platform.service.justice.gov.uk/disaster-recovery-scenarios.html" />

    
  </head>

  <body class="govuk-template__body">
    <script>document.body.className = ((document.body.className) ? document.body.className + ' js-enabled' : 'js-enabled');</script>

    <div class="app-pane">
      <div class="app-pane__header toc-open-disabled">
        <a href="#content" class="govuk-skip-link">Skip to main content</a>

        <header class="govuk-header app-header" role="banner" data-module="govuk-header">
  <div class="govuk-header__container govuk-header__container--full-width">
    <div class="govuk-header__logo">
      <a href="/" class="govuk-header__link govuk-header__link--homepage">
        <span class="govuk-header__product-name">
          Cloud Platform Runbooks
        </span>
      </a>
    </div>
    <div class="govuk-header__content">
      <button type="button" class="govuk-header__menu-button govuk-js-header-toggle" aria-controls="navigation" aria-label="Show or hide Top Level Navigation">Menu</button>
      <nav>
        <ul id="navigation" class="govuk-header__navigation govuk-header__navigation--end" aria-label="Top Level Navigation">
            <li class="govuk-header__navigation-item">
              <a class="govuk-header__link" href="mailto:platforms+runbooks@digital.justice.gov.uk?subject=Runbooks+feedback">Feedback / Report a problem</a>
            </li>
            <li class="govuk-header__navigation-item">
              <a class="govuk-header__link" href="/">Documentation</a>
            </li>
            <li class="govuk-header__navigation-item">
              <a class="govuk-header__link" href="https://github.com/ministryofjustice/cloud-platform/tree/main/runbooks">GitHub</a>
            </li>
        </ul>
      </nav>
    </div>
  </div>
</header>

      </div>

        <div id="toc-heading" class="toc-show fixedsticky">
          <button type="button" class="toc-show__label js-toc-show" aria-controls="toc">
            Table of contents <span class="toc-show__icon"></span>
          </button>
        </div>

      <div class="app-pane__body" data-module="in-page-navigation">
          <div class="app-pane__toc">
            <div class="toc" data-module="table-of-contents" tabindex="-1" aria-label="Table of contents" role="dialog">
              <div class="search" data-module="search">
  <form action="https://www.google.co.uk/search" method="get" role="search" class="search__form govuk-!-margin-bottom-4">
    <input type="hidden" name="as_sitesearch" value="https://runbooks.cloud-platform.service.justice.gov.uk"/>
    <label class="govuk-label search__label" for="search" aria-hidden="true">
      Search (via Google)
    </label>
    <input
      type="text"
      id="search" name="q"
      class="govuk-input govuk-!-margin-bottom-0 search__input"
      aria-controls="search-results"
      placeholder="Search">
    <button type="submit" class="search__button">Search</button>
  </form>
  <div id="search-results" class="search-results" aria-hidden="true" role="dialog" aria-labelledby="search-results-title">
    <div class="search-results__inner">
      <button class="search-results__close">Close<span class="search-results__close-label"> search results</span></button>
      <h2 id="search-results-title" class="search-results__title" aria-live="assertive" role="alert">Results</h2>
      <div class="search-results__content"></div>
    </div>
  </div>
</div>

              <button type="button" class="toc__close js-toc-close" aria-controls="toc" aria-label="Hide table of contents"></button>
              <nav id="toc" class="js-toc-list toc__list" aria-labelledby="toc-heading" data-module="collapsible-navigation">
                      <ul>
  <li>
    <a href="/#cloud-platform-runbooks"><span>Cloud Platform Runbooks</span></a>
  </li>
</ul>
<ul>
  <li>
    <a href="/how-we-work.html#how-we-work"><span>How We Work</span></a>
    <ul>
      <li>
        <a href="/how-we-work.html#getting-help"><span>Getting Help</span></a>
      </li>
      <li>
        <a href="/how-we-work.html#the-board-tickets"><span>The Board / Tickets</span></a>
        <ul>
          <li>
            <a href="/how-we-work.html#adding-tickets"><span>Adding tickets</span></a>
          </li>
          <li>
            <a href="/how-we-work.html#making-changes-to-code"><span>Making changes to code</span></a>
          </li>
          <li>
            <a href="/how-we-work.html#reviewing-merging-prs"><span>Reviewing/Merging PRs</span></a>
          </li>
        </ul>
      </li>
      <li>
        <a href="/how-we-work.html#the-hammer-of-justice"><span>The 🔨 Hammer of Justice</span></a>
        <ul>
          <li>
            <a href="/how-we-work.html#backlog-tickets"><span>Backlog Tickets</span></a>
          </li>
        </ul>
      </li>
      <li>
        <a href="/how-we-work.html#documentation"><span>Documentation</span></a>
      </li>
    </ul>
  </li>
</ul>
<ul>
  <li>
    <a href="/how-to-update-gems.html#how-to-update-gem-files-in-technical-documentation"><span>How to update gem files in technical documentation</span></a>
    <ul>
      <li>
        <a href="/how-to-update-gems.html#when-to-update"><span>When to update</span></a>
      </li>
      <li>
        <a href="/how-to-update-gems.html#how-to-update"><span>How to update</span></a>
      </li>
    </ul>
  </li>
</ul>
<ul>
  <li>
    <a href="/incident-process.html#incident-process"><span>Incident Process</span></a>
    <ul>
      <li>
        <a href="/incident-process.html#1-confirm-that-the-event-constitutes-an-incident"><span>1. Confirm that the event constitutes an incident</span></a>
      </li>
      <li>
        <a href="/incident-process.html#2-declare-the-incident"><span>2. Declare the incident</span></a>
        <ul>
          <li>
            <a href="/incident-process.html#examples"><span>Examples</span></a>
          </li>
        </ul>
      </li>
      <li>
        <a href="/incident-process.html#3-assign-roles"><span>3. Assign roles</span></a>
        <ul>
          <li>
            <a href="/incident-process.html#3-1-incident-lead"><span>3.1 Incident Lead</span></a>
          </li>
          <li>
            <a href="/incident-process.html#3-2-scribe"><span>3.2 Scribe</span></a>
          </li>
          <li>
            <a href="/incident-process.html#3-3-communications-lead"><span>3.3 Communications Lead</span></a>
          </li>
          <li>
            <a href="/incident-process.html#transferring-roles"><span>Transferring roles</span></a>
          </li>
        </ul>
      </li>
      <li>
        <a href="/incident-process.html#4-fix-the-problem"><span>4. Fix the problem</span></a>
      </li>
      <li>
        <a href="/incident-process.html#5-end-the-incident"><span>5. End the incident</span></a>
      </li>
      <li>
        <a href="/incident-process.html#6-post-incident-procedure"><span>6. Post-incident procedure</span></a>
      </li>
    </ul>
  </li>
</ul>
<ul>
  <li>
    <a href="/incident-log.html#incident-log"><span>Incident Log</span></a>
    <ul>
      <li>
        <a href="/incident-log.html#q1-2022-january-to-march"><span>Q1 2022 (January to March)</span></a>
        <ul>
          <li>
            <a href="/incident-log.html#incident-on-2022-03-10-11-48-all-ingress-resources-using-apps-live-cloud-platform-urls-showing-certificate-issue"><span>Incident on 2022-03-10 11:48 - All ingress resources using *.apps.live.cloud-platform urls showing certificate issue</span></a>
          </li>
          <li>
            <a href="/incident-log.html#incident-on-2022-01-22-11-57-some-dns-records-got-deleted-at-the-weekend"><span>Incident on 2022-01-22 11:57 - some DNS records got deleted at the weekend</span></a>
          </li>
        </ul>
      </li>
      <li>
        <a href="/incident-log.html#q4-2021-october-to-december"><span>Q4 2021 (October to December)</span></a>
        <ul>
          <li>
            <a href="/incident-log.html#incident-on-2021-11-05-modsec-ingress-controller-is-erroring"><span>Incident on 2021-11-05 - ModSec ingress controller is erroring</span></a>
          </li>
        </ul>
      </li>
      <li>
        <a href="/incident-log.html#q3-2021-july-september"><span>Q3 2021 (July-September)</span></a>
        <ul>
          <li>
            <a href="/incident-log.html#incident-on-2021-09-30-ssl-certificate-issue-in-browsers"><span>Incident on 2021-09-30 - SSL Certificate Issue in browsers</span></a>
          </li>
          <li>
            <a href="/incident-log.html#incident-on-2021-09-04-22-05-pingdom-check-prometheus-cloud-platform-healthcheck-is-down"><span>Incident on 2021-09-04 22:05 - Pingdom check Prometheus Cloud-Platform - Healthcheck is DOWN</span></a>
          </li>
          <li>
            <a href="/incident-log.html#incident-on-2021-07-12-15-24-all-ingress-resources-using-apps-live-1-domain-names-stop-working"><span>Incident on 2021-07-12 15:24 - All ingress resources using *apps.live-1 domain names stop working</span></a>
          </li>
        </ul>
      </li>
      <li>
        <a href="/incident-log.html#q2-2021-april-june"><span>Q2 2021 (April-June)</span></a>
        <ul>
          <li>
            <a href="/incident-log.html#incident-on-2021-06-09-12-47-all-users-are-unable-to-create-new-ingress-rules-following-bad-modsec-ingress-controller-upgrade"><span>Incident on 2021-06-09 12:47 - All users are unable to create new ingress rules, following bad ModSec Ingress-controller upgrade</span></a>
          </li>
          <li>
            <a href="/incident-log.html#incident-on-2021-05-10-12-15-apply-pipeline-downtime-due-to-accidental-destroy-of-manager-cluster"><span>Incident on 2021-05-10 12:15 - Apply Pipeline downtime due to accidental destroy of Manager cluster</span></a>
          </li>
        </ul>
      </li>
      <li>
        <a href="/incident-log.html#q1-2021-january-march"><span>Q1 2021 (January - March)</span></a>
        <ul>
          <li>
            <a href="/incident-log.html#no-incidents-declared"><span>No incidents declared</span></a>
          </li>
        </ul>
      </li>
      <li>
        <a href="/incident-log.html#q4-2020-october-december"><span>Q4 2020 (October - December)</span></a>
        <ul>
          <li>
            <a href="/incident-log.html#incident-on-2020-10-06-09-07-intermittent-quot-micro-downtimes-quot-on-various-services-using-dedicated-ingress-controllers"><span>Incident on 2020-10-06 09:07 - Intermittent “micro-downtimes” on various services using dedicated ingress controllers</span></a>
          </li>
        </ul>
      </li>
      <li>
        <a href="/incident-log.html#q3-2020-july-september"><span>Q3 2020 (July - September)</span></a>
        <ul>
          <li>
            <a href="/incident-log.html#incident-on-2020-09-28-13-10-termination-of-nodes-updating-kops-instance-group"><span>Incident on 2020-09-28 13:10 - Termination of nodes updating kops Instance Group.</span></a>
          </li>
          <li>
            <a href="/incident-log.html#incident-on-2020-09-21-18-27-some-cloud-platform-components-destroyed"><span>Incident on 2020-09-21 18:27 - Some cloud-platform components destroyed.</span></a>
          </li>
          <li>
            <a href="/incident-log.html#incident-on-2020-09-07-12-54-all-users-are-unable-to-create-new-ingress-rules"><span>Incident on 2020-09-07 12:54 - All users are unable to create new ingress rules</span></a>
          </li>
          <li>
            <a href="/incident-log.html#incident-on-2020-08-25-11-26-connectivity-issues-with-eu-west-2a"><span>Incident on 2020-08-25 11:26 - Connectivity issues with eu-west-2a</span></a>
          </li>
          <li>
            <a href="/incident-log.html#incident-on-2020-08-14-11-01-ingress-controllers-crashlooping"><span>Incident on 2020-08-14 11:01 - Ingress-controllers crashlooping</span></a>
          </li>
          <li>
            <a href="/incident-log.html#incident-on-2020-08-07-16-39-master-node-provisioning-failure"><span>Incident on 2020-08-07 16:39 - Master node provisioning failure</span></a>
          </li>
        </ul>
      </li>
      <li>
        <a href="/incident-log.html#q2-2020-april-june"><span>Q2 2020 (April - June)</span></a>
        <ul>
          <li>
            <a href="/incident-log.html#incident-on-2020-08-04-17-13"><span>Incident on 2020-08-04 17:13</span></a>
          </li>
          <li>
            <a href="/incident-log.html#incident-on-2020-04-15-10-58-nginx-tls"><span>Incident on 2020-04-15 10:58 Nginx/TLS</span></a>
          </li>
        </ul>
      </li>
      <li>
        <a href="/incident-log.html#q1-2020-january-march"><span>Q1 2020 (January - March)</span></a>
        <ul>
          <li>
            <a href="/incident-log.html#incident-on-2020-02-25-10-58"><span>Incident on 2020-02-25 10:58</span></a>
          </li>
          <li>
            <a href="/incident-log.html#incident-on-2020-02-18-14-13-utc"><span>Incident on 2020-02-18 14:13 UTC</span></a>
          </li>
          <li>
            <a href="/incident-log.html#incident-on-2020-02-12-11-45-utc"><span>Incident on 2020-02-12 11:45 UTC</span></a>
          </li>
        </ul>
      </li>
      <li>
        <a href="/incident-log.html#about-this-incident-log"><span>About this incident log</span></a>
      </li>
      <li>
        <a href="/incident-log.html#template"><span>Template</span></a>
        <ul>
          <li>
            <a href="/incident-log.html#incident-on-yyyy-mm-dd-hh-mm-brief-description"><span>Incident on YYYY-MM-DD HH:MM - [Brief description]</span></a>
          </li>
        </ul>
      </li>
      <li>
        <a href="/incident-log.html#incident-log-impact"><span>Impact:</span></a>
      </li>
      <li>
        <a href="/incident-log.html#context"><span>Context:</span></a>
      </li>
      <li>
        <a href="/incident-log.html#resolution"><span>Resolution:</span></a>
      </li>
      <li>
        <a href="/incident-log.html#review-actions"><span>Review actions:</span></a>
      </li>
    </ul>
  </li>
</ul>
<ul>
  <li>
    <a href="/create-cluster.html#create-a-new-cluster"><span>Create a new cluster</span></a>
    <ul>
      <li>
        <a href="/create-cluster.html#pre-requisites"><span>Pre-requisites</span></a>
      </li>
      <li>
        <a href="/create-cluster.html#environment-variables"><span>Environment Variables</span></a>
      </li>
      <li>
        <a href="/create-cluster.html#run-the-build-script-via-the-tools-image"><span>Run the build script, via the tools image</span></a>
      </li>
      <li>
        <a href="/create-cluster.html#alerts"><span>Alerts</span></a>
        <ul>
          <li>
            <a href="/create-cluster.html#apply-the-changes"><span>Apply the changes</span></a>
          </li>
        </ul>
      </li>
      <li>
        <a href="/create-cluster.html#authenticating"><span>Authenticating</span></a>
      </li>
      <li>
        <a href="/create-cluster.html#docker-authentication"><span>Docker authentication</span></a>
        <ul>
          <li>
            <a href="/create-cluster.html#adding-a-docker-config-file-to-your-cluster"><span>Adding a Docker config file to your cluster</span></a>
          </li>
        </ul>
      </li>
    </ul>
  </li>
</ul>
<ul>
  <li>
    <a href="/add-concourse-to-cluster.html#add-concourse-to-a-test-cluster"><span>Add Concourse to a test cluster</span></a>
    <ul>
      <li>
        <a href="/add-concourse-to-cluster.html#add-concourse-to-a-test-cluster-pre-requisites"><span>Pre-requisites</span></a>
      </li>
      <li>
        <a href="/add-concourse-to-cluster.html#process"><span>Process</span></a>
      </li>
    </ul>
  </li>
</ul>
<ul>
  <li>
    <a href="/changes-in-cloudplatform.html#change-process-in-cloud-platform"><span>Change Process in Cloud Platform</span></a>
    <ul>
      <li>
        <a href="/changes-in-cloudplatform.html#making-changes-to-cloud-plarform-infrastructure"><span>Making Changes to cloud-plarform-infrastructure</span></a>
      </li>
      <li>
        <a href="/changes-in-cloudplatform.html#marking-changes-to-terraform-modules"><span>Marking Changes to terraform modules</span></a>
      </li>
      <li>
        <a href="/changes-in-cloudplatform.html#making-changes-to-helm-charts"><span>Making Changes to Helm Charts</span></a>
      </li>
      <li>
        <a href="/changes-in-cloudplatform.html#making-changes-to-environments-service-teams"><span>Making changes to environments (Service Teams)</span></a>
      </li>
      <li>
        <a href="/changes-in-cloudplatform.html#communications"><span>Communications</span></a>
      </li>
    </ul>
  </li>
</ul>
<ul>
  <li>
    <a href="/upgrade-cluster.html#upgrade-a-cluster"><span>Upgrade a cluster</span></a>
    <ul>
      <li>
        <a href="/upgrade-cluster.html#planning"><span>Planning</span></a>
      </li>
      <li>
        <a href="/upgrade-cluster.html#upgrade-a-cluster-pre-requisites"><span>Pre-requisites</span></a>
        <ul>
          <li>
            <a href="/upgrade-cluster.html#setup-environment"><span>Setup environment</span></a>
          </li>
          <li>
            <a href="/upgrade-cluster.html#run-the-integration-tests"><span>Run the integration tests</span></a>
          </li>
          <li>
            <a href="/upgrade-cluster.html#sanity-checks"><span>Sanity checks</span></a>
          </li>
          <li>
            <a href="/upgrade-cluster.html#run-a-shell-in-the-tools-image"><span>Run a shell in the tools image</span></a>
          </li>
        </ul>
      </li>
      <li>
        <a href="/upgrade-cluster.html#run-the-upgrade"><span>Run the upgrade</span></a>
        <ul>
          <li>
            <a href="/upgrade-cluster.html#authenticate-to-the-cluster"><span>Authenticate to the cluster</span></a>
          </li>
          <li>
            <a href="/upgrade-cluster.html#update-the-live-cluster-manifest"><span>Update the live cluster manifest</span></a>
          </li>
          <li>
            <a href="/upgrade-cluster.html#push-changes-to-kops-state"><span>Push changes to kops state</span></a>
          </li>
          <li>
            <a href="/upgrade-cluster.html#perform-a-rolling-update"><span>Perform a rolling-update</span></a>
          </li>
          <li>
            <a href="/upgrade-cluster.html#take-stock-of-current-running-worker-nodes"><span>Take stock of current running worker nodes</span></a>
          </li>
          <li>
            <a href="/upgrade-cluster.html#create-new-worker-instance-groups"><span>Create new worker instance groups</span></a>
          </li>
          <li>
            <a href="/upgrade-cluster.html#cordon-old-workers"><span>Cordon old workers</span></a>
          </li>
          <li>
            <a href="/upgrade-cluster.html#scale-the-number-of-ingress-controllers"><span>Scale the number of ingress controllers</span></a>
          </li>
          <li>
            <a href="/upgrade-cluster.html#drain-the-old-worker-nodes"><span>Drain the old worker nodes</span></a>
          </li>
          <li>
            <a href="/upgrade-cluster.html#validate-the-cluster"><span>Validate the cluster</span></a>
          </li>
          <li>
            <a href="/upgrade-cluster.html#run-the-integration-tests-again"><span>Run the integration tests again</span></a>
          </li>
          <li>
            <a href="/upgrade-cluster.html#delete-the-old-instance-groups"><span>Delete the old instance groups</span></a>
          </li>
          <li>
            <a href="/upgrade-cluster.html#scale-the-ingress-controllers-down"><span>Scale the ingress-controllers down</span></a>
          </li>
        </ul>
      </li>
      <li>
        <a href="/upgrade-cluster.html#commit-changes-back-to-main-branch"><span>Commit changes back to main branch</span></a>
      </li>
    </ul>
  </li>
</ul>
<ul>
  <li>
    <a href="/upgrade-eks-cluster.html#upgrade-eks-cluster"><span>Upgrade EKS cluster</span></a>
    <ul>
      <li>
        <a href="/upgrade-eks-cluster.html#run-the-upgrade-via-the-tools-image"><span>Run the upgrade, via the tools image</span></a>
      </li>
      <li>
        <a href="/upgrade-eks-cluster.html#upgrade-eks-cluster-pre-requisites"><span>Pre-requisites</span></a>
      </li>
      <li>
        <a href="/upgrade-eks-cluster.html#upgrade-steps"><span>Upgrade Steps</span></a>
        <ul>
          <li>
            <a href="/upgrade-eks-cluster.html#upgrade-eks-terraform-module"><span>Upgrade EKS Terraform Module</span></a>
          </li>
          <li>
            <a href="/upgrade-eks-cluster.html#upgrade-control-plane"><span>Upgrade Control Plane</span></a>
          </li>
          <li>
            <a href="/upgrade-eks-cluster.html#upgrade-node-group-s"><span>Upgrade Node Group(s)</span></a>
          </li>
          <li>
            <a href="/upgrade-eks-cluster.html#upgrade-addon-s"><span>Upgrade addon(s)</span></a>
          </li>
        </ul>
      </li>
    </ul>
  </li>
</ul>
<ul>
  <li>
    <a href="/upgrade-cluster-components.html#upgrade-cluster-components"><span>Upgrade cluster components</span></a>
    <ul>
      <li>
        <a href="/upgrade-cluster-components.html#upgrade-cluster-components-planning"><span>Planning</span></a>
      </li>
      <li>
        <a href="/upgrade-cluster-components.html#testing-the-upgrade-in-a-test-cluster"><span>Testing the upgrade in a test cluster</span></a>
        <ul>
          <li>
            <a href="/upgrade-cluster-components.html#testing-the-upgrade-in-a-test-cluster-setup-environment"><span>Setup environment</span></a>
          </li>
          <li>
            <a href="/upgrade-cluster-components.html#testing-the-upgrade-in-a-test-cluster-run-a-shell-in-the-tools-image"><span>Run a shell in the tools image</span></a>
          </li>
          <li>
            <a href="/upgrade-cluster-components.html#authenticate-to-the-test-cluster"><span>Authenticate to the test cluster</span></a>
          </li>
          <li>
            <a href="/upgrade-cluster-components.html#testing-the-upgrade-in-a-test-cluster-run-the-integration-tests"><span>Run the integration tests</span></a>
          </li>
          <li>
            <a href="/upgrade-cluster-components.html#testing-the-upgrade"><span>Testing the upgrade</span></a>
          </li>
          <li>
            <a href="/upgrade-cluster-components.html#things-to-observe-when-testing-the-upgrade"><span>Things to observe when testing the upgrade</span></a>
          </li>
          <li>
            <a href="/upgrade-cluster-components.html#performing-the-upgrade"><span>Performing the upgrade</span></a>
          </li>
        </ul>
      </li>
    </ul>
  </li>
</ul>
<ul>
  <li>
    <a href="/upgrade-terraform-version.html#upgrade-terraform-version"><span>Upgrade Terraform Version</span></a>
    <ul>
      <li>
        <a href="/upgrade-terraform-version.html#introduction"><span>Introduction</span></a>
      </li>
      <li>
        <a href="/upgrade-terraform-version.html#recommendations"><span>Recommendations</span></a>
      </li>
      <li>
        <a href="/upgrade-terraform-version.html#caveats"><span>Caveats</span></a>
      </li>
      <li>
        <a href="/upgrade-terraform-version.html#how-to-perform-the-upgrade-divide-and-conquer"><span>How to perform the upgrade - divide and conquer</span></a>
        <ul>
          <li>
            <a href="/upgrade-terraform-version.html#before-the-upgrade"><span>Before the upgrade</span></a>
          </li>
          <li>
            <a href="/upgrade-terraform-version.html#environments-state-files"><span>Environments state files</span></a>
          </li>
          <li>
            <a href="/upgrade-terraform-version.html#infrastructure-state-files"><span>Infrastructure state files</span></a>
          </li>
        </ul>
      </li>
    </ul>
  </li>
</ul>
<ul>
  <li>
    <a href="/delete-cluster.html#delete-a-cluster"><span>Delete a cluster</span></a>
    <ul>
      <li>
        <a href="/delete-cluster.html#delete-the-cluster-using-the-script"><span>Delete the cluster using the script</span></a>
        <ul>
          <li>
            <a href="/delete-cluster.html#first-run-make-tools-shell"><span>First, run make tools-shell</span></a>
          </li>
        </ul>
      </li>
      <li>
        <a href="/delete-cluster.html#delete-the-cluster-using-concourse-fly-commands"><span>Delete the cluster using concourse fly commands</span></a>
      </li>
      <li>
        <a href="/delete-cluster.html#delete-the-cluster-manually"><span>Delete the cluster manually</span></a>
      </li>
      <li>
        <a href="/delete-cluster.html#delete-an-eks-cluster"><span>Delete an EKS cluster</span></a>
      </li>
    </ul>
  </li>
</ul>
<ul>
  <li>
    <a href="/upgrade-user-components.html#upgrade-user-components"><span>Upgrade user components</span></a>
    <ul>
      <li>
        <a href="/upgrade-user-components.html#making-changes-to-your-module"><span>Making changes to your module</span></a>
      </li>
      <li>
        <a href="/upgrade-user-components.html#semantic-versioning-and-release"><span>Semantic Versioning and release</span></a>
      </li>
      <li>
        <a href="/upgrade-user-components.html#upgrading-a-user-component-in-environments"><span>Upgrading a user component in environments</span></a>
      </li>
    </ul>
  </li>
</ul>
<ul>
  <li>
    <a href="/add-nodes-to-the-cluster.html#add-nodes-to-the-cluster"><span>Add nodes to the cluster</span></a>
    <ul>
      <li>
        <ul>
          <li>
            <a href="/add-nodes-to-the-cluster.html#requirements"><span>Requirements</span></a>
          </li>
          <li>
            <a href="/add-nodes-to-the-cluster.html#inline-edit"><span>Inline edit</span></a>
          </li>
          <li>
            <a href="/add-nodes-to-the-cluster.html#persisting-the-changes"><span>Persisting the changes</span></a>
          </li>
        </ul>
      </li>
    </ul>
  </li>
</ul>
<ul>
  <li>
    <a href="/add-nodes-to-the-eks-cluster.html#add-nodes-change-the-instance-type-of-the-aws-eks-cluster"><span>Add nodes/change the instance type of the AWS EKS cluster</span></a>
    <ul>
      <li>
        <a href="/add-nodes-to-the-eks-cluster.html#add-nodes-to-the-eks-cluster"><span>Add nodes to the eks cluster</span></a>
        <ul>
          <li>
            <a href="/add-nodes-to-the-eks-cluster.html#add-nodes-to-the-eks-cluster-requirements"><span>Requirements</span></a>
          </li>
          <li>
            <a href="/add-nodes-to-the-eks-cluster.html#cluster-configuration"><span>Cluster configuration:</span></a>
          </li>
          <li>
            <a href="/add-nodes-to-the-eks-cluster.html#issue"><span>Issue</span></a>
          </li>
        </ul>
      </li>
      <li>
        <a href="/add-nodes-to-the-eks-cluster.html#change-the-aws-eks-instance-type-worker-node-machine-type"><span>Change the AWS EKS instance type (worker_node_machine_type)</span></a>
      </li>
    </ul>
  </li>
</ul>
<ul>
  <li>
    <a href="/auth0-rotation.html#credentials-rotation-for-auth0-apps"><span>Credentials rotation for auth0 apps</span></a>
    <ul>
      <li>
        <a href="/auth0-rotation.html#preparation"><span>Preparation</span></a>
      </li>
      <li>
        <a href="/auth0-rotation.html#1-taint-resources-terraform"><span>1) Taint resources (terraform)</span></a>
      </li>
      <li>
        <a href="/auth0-rotation.html#2-rolling-update-of-cluster-kops"><span>2) Rolling update of cluster (kops)</span></a>
      </li>
      <li>
        <a href="/auth0-rotation.html#3-apply-changes-within-components-terraform"><span>3) Apply changes within components (terraform)</span></a>
      </li>
      <li>
        <a href="/auth0-rotation.html#4-update-environment-repo"><span>4) Update environment repo</span></a>
      </li>
      <li>
        <a href="/auth0-rotation.html#5-verifiying-changes"><span>5) Verifiying changes</span></a>
      </li>
      <li>
        <a href="/auth0-rotation.html#6-update-pipelines"><span>6) Update pipelines</span></a>
      </li>
    </ul>
  </li>
</ul>
<ul>
  <li>
    <a href="/rotate-git-crypt-key.html#git-crypt"><span>Git-crypt</span></a>
    <ul>
      <li>
        <a href="/rotate-git-crypt-key.html#adding-new-user-to-the-keyring"><span>Adding new user to the keyring</span></a>
      </li>
      <li>
        <a href="/rotate-git-crypt-key.html#rotating-the-git-crypt-key"><span>Rotating the git-crypt key</span></a>
        <ul>
          <li>
          </li>
        </ul>
      </li>
    </ul>
  </li>
</ul>
<ul>
  <li>
    <a href="/custom-domain.html#add-a-custom-domain"><span>Add a custom domain</span></a>
  </li>
</ul>
<ul>
  <li>
    <a href="/add-new-receiver-alert-manager.html#add-a-new-alertmanager-receiver-and-a-slack-webhook"><span>Add a new Alertmanager receiver and a slack webhook</span></a>
    <ul>
      <li>
        <a href="/add-new-receiver-alert-manager.html#add-a-new-alertmanager-receiver-and-a-slack-webhook-pre-requisites"><span>Pre-requisites</span></a>
      </li>
      <li>
        <a href="/add-new-receiver-alert-manager.html#creating-a-new-receiver-set"><span>Creating a new receiver set</span></a>
      </li>
      <li>
        <a href="/add-new-receiver-alert-manager.html#information-alerts"><span>Information Alerts</span></a>
      </li>
    </ul>
  </li>
</ul>
<ul>
  <li>
    <a href="/disaster-recovery.html#cloud-platform-disaster-recovery"><span>Cloud Platform Disaster Recovery</span></a>
    <ul>
      <li>
        <a href="/disaster-recovery.html#cloud-platform-disaster-recovery-restore-process"><span>Restore process</span></a>
      </li>
      <li>
        <a href="/disaster-recovery.html#apply-cloud-platform-resources"><span>Apply cloud-platform resources</span></a>
      </li>
      <li>
        <a href="/disaster-recovery.html#cloud-platform-disaster-recovery-create-a-new-cluster"><span>Create a new cluster</span></a>
      </li>
      <li>
        <a href="/disaster-recovery.html#perform-the-restore"><span>Perform the restore</span></a>
        <ul>
          <li>
            <a href="/disaster-recovery.html#perform-the-restore-pre-requisites"><span>Pre-requisites</span></a>
          </li>
          <li>
            <a href="/disaster-recovery.html#restore-the-cluster-using-etcd-manager-ctl-on-your-computer"><span>Restore the cluster using etcd-manager-ctl on your computer.</span></a>
          </li>
          <li>
            <a href="/disaster-recovery.html#restore-process-inside-the-etcd-container-using-etcd-manager-ctl"><span>Restore process inside the etcd container using etcd-manager-ctl.</span></a>
          </li>
        </ul>
      </li>
      <li>
        <a href="/disaster-recovery.html#cleanup"><span>Cleanup</span></a>
      </li>
      <li>
        <a href="/disaster-recovery.html#possible-issues"><span>Possible Issues</span></a>
      </li>
    </ul>
  </li>
</ul>
<ul>
  <li>
    <a href="/disaster-recovery-scenarios.html#cloud-platform-disaster-recovery-scenarios"><span>Cloud Platform Disaster Recovery Scenarios</span></a>
    <ul>
      <li>
        <a href="/disaster-recovery-scenarios.html#losing-a-namespace"><span>Losing a Namespace</span></a>
        <ul>
          <li>
            <a href="/disaster-recovery-scenarios.html#impact"><span>Impact</span></a>
          </li>
          <li>
            <a href="/disaster-recovery-scenarios.html#possible-cause"><span>Possible Cause</span></a>
          </li>
          <li>
            <a href="/disaster-recovery-scenarios.html#restore-process"><span>Restore process</span></a>
          </li>
        </ul>
      </li>
      <li>
        <a href="/disaster-recovery-scenarios.html#losing-a-kubernetes-component-or-object"><span>Losing a Kubernetes Component or Object</span></a>
        <ul>
          <li>
            <a href="/disaster-recovery-scenarios.html#losing-a-kubernetes-component-or-object-impact"><span>Impact</span></a>
          </li>
          <li>
            <a href="/disaster-recovery-scenarios.html#losing-a-kubernetes-component-or-object-possible-cause"><span>Possible Cause</span></a>
          </li>
          <li>
            <a href="/disaster-recovery-scenarios.html#losing-a-kubernetes-component-or-object-restore-process"><span>Restore process</span></a>
          </li>
        </ul>
      </li>
      <li>
        <a href="/disaster-recovery-scenarios.html#losing-the-whole-cluster"><span>Losing the whole cluster</span></a>
        <ul>
          <li>
            <a href="/disaster-recovery-scenarios.html#losing-the-whole-cluster-impact"><span>Impact</span></a>
          </li>
          <li>
            <a href="/disaster-recovery-scenarios.html#losing-the-whole-cluster-possible-cause"><span>Possible Cause</span></a>
          </li>
          <li>
            <a href="/disaster-recovery-scenarios.html#how-this-plan-is-tested"><span>How this plan is tested:</span></a>
          </li>
          <li>
            <a href="/disaster-recovery-scenarios.html#assumptions"><span>Assumptions</span></a>
          </li>
          <li>
            <a href="/disaster-recovery-scenarios.html#losing-the-whole-cluster-restore-process"><span>Restore process</span></a>
          </li>
        </ul>
      </li>
      <li>
        <a href="/disaster-recovery-scenarios.html#deleted-corrupted-the-kops-state"><span>Deleted/corrupted the kops state</span></a>
        <ul>
          <li>
            <a href="/disaster-recovery-scenarios.html#deleted-corrupted-the-kops-state-impact"><span>Impact</span></a>
          </li>
          <li>
            <a href="/disaster-recovery-scenarios.html#deleted-corrupted-the-kops-state-possible-cause"><span>Possible Cause</span></a>
          </li>
          <li>
            <a href="/disaster-recovery-scenarios.html#restore-process-for-corrupted-kops-state"><span>Restore process for corrupted kops state</span></a>
          </li>
          <li>
            <a href="/disaster-recovery-scenarios.html#restore-process-for-deleted-s3-bucket-where-kops-state-is-stored"><span>Restore process for deleted S3 bucket where kops state is stored</span></a>
          </li>
        </ul>
      </li>
      <li>
        <a href="/disaster-recovery-scenarios.html#deleted-terraform-state"><span>Deleted terraform state</span></a>
        <ul>
          <li>
            <a href="/disaster-recovery-scenarios.html#deleted-terraform-state-impact"><span>Impact</span></a>
          </li>
          <li>
            <a href="/disaster-recovery-scenarios.html#deleted-terraform-state-possible-cause"><span>Possible Cause</span></a>
          </li>
          <li>
            <a href="/disaster-recovery-scenarios.html#deleted-terraform-state-restore-process"><span>Restore process</span></a>
          </li>
          <li>
            <a href="/disaster-recovery-scenarios.html#recovering-more-complex-scenarios"><span>Recovering more complex scenarios</span></a>
          </li>
        </ul>
      </li>
      <li>
        <a href="/disaster-recovery-scenarios.html#lost-or-corrupt-etcd-volume"><span>Lost or corrupt etcd volume</span></a>
        <ul>
          <li>
            <a href="/disaster-recovery-scenarios.html#lost-or-corrupt-etcd-volume-impact"><span>Impact</span></a>
          </li>
          <li>
            <a href="/disaster-recovery-scenarios.html#lost-or-corrupt-etcd-volume-possible-cause"><span>Possible Cause</span></a>
          </li>
          <li>
            <a href="/disaster-recovery-scenarios.html#lost-or-corrupt-etcd-volume-restore-process"><span>Restore process</span></a>
          </li>
        </ul>
      </li>
      <li>
        <a href="/disaster-recovery-scenarios.html#overwriting-kops-cluster-39-s-components-with-eks-components"><span>Overwriting KOPS cluster’s components with EKS components</span></a>
        <ul>
          <li>
            <a href="/disaster-recovery-scenarios.html#overwriting-kops-cluster-39-s-components-with-eks-components-impact"><span>Impact</span></a>
          </li>
          <li>
            <a href="/disaster-recovery-scenarios.html#overwriting-kops-cluster-39-s-components-with-eks-components-possible-cause"><span>Possible Cause</span></a>
          </li>
          <li>
            <a href="/disaster-recovery-scenarios.html#overwriting-kops-cluster-39-s-components-with-eks-components-restore-process"><span>Restore process</span></a>
          </li>
          <li>
            <a href="/disaster-recovery-scenarios.html#reproducing-incident-steps"><span>Reproducing Incident Steps</span></a>
          </li>
          <li>
            <a href="/disaster-recovery-scenarios.html#velero-backup"><span>Velero Backup</span></a>
          </li>
          <li>
            <a href="/disaster-recovery-scenarios.html#apply-the-eks-components-to-the-kops-cluster"><span>Apply the EKS components to the KOPS cluster</span></a>
          </li>
          <li>
            <a href="/disaster-recovery-scenarios.html#observations-of-incident"><span>Observations of Incident</span></a>
          </li>
          <li>
            <a href="/disaster-recovery-scenarios.html#destroy-the-eks-components"><span>Destroy the EKS components</span></a>
          </li>
          <li>
            <a href="/disaster-recovery-scenarios.html#re-apply-the-kops-components"><span>Re-apply the KOPS components</span></a>
          </li>
        </ul>
      </li>
    </ul>
  </li>
</ul>
<ul>
  <li>
    <a href="/rotate-user-aws-credentials.html#rotate-user-aws-credentials"><span>Rotate User AWS Credentials</span></a>
    <ul>
      <li>
        <ul>
          <li>
          </li>
        </ul>
      </li>
      <li>
        <a href="/rotate-user-aws-credentials.html#set-pingdom-environment-variables-optional"><span>Set pingdom environment variables(Optional)</span></a>
      </li>
      <li>
        <a href="/rotate-user-aws-credentials.html#target-the-live-cluster"><span>Target the live cluster</span></a>
      </li>
      <li>
        <a href="/rotate-user-aws-credentials.html#set-cluster-related-environment-variables"><span>Set cluster related environment variables</span></a>
      </li>
      <li>
        <a href="/rotate-user-aws-credentials.html#set-the-namespace-name"><span>Set the namespace name</span></a>
      </li>
      <li>
        <a href="/rotate-user-aws-credentials.html#terraform-init"><span>Terraform Init</span></a>
      </li>
      <li>
        <a href="/rotate-user-aws-credentials.html#terraform-plan-apply"><span>Terraform Plan/Apply</span></a>
        <ul>
          <li>
            <a href="/rotate-user-aws-credentials.html#2-identify-the-compromised-terraform-object"><span>2. Identify the compromised terraform object</span></a>
          </li>
          <li>
            <a href="/rotate-user-aws-credentials.html#3-destroy-the-compromised-key"><span>3. Destroy the compromised key</span></a>
          </li>
          <li>
            <a href="/rotate-user-aws-credentials.html#4-let-terraform-create-a-new-key"><span>4. Let terraform create a new key</span></a>
          </li>
        </ul>
      </li>
    </ul>
  </li>
  <li>
    <a href="/rotate-user-aws-credentials.html#rotate-rds-credentials"><span>Rotate RDS Credentials</span></a>
    <ul>
      <li>
        <ul>
          <li>
            <a href="/rotate-user-aws-credentials.html#let-terraform-create-a-new-password"><span>Let terraform create a new password</span></a>
          </li>
        </ul>
      </li>
    </ul>
  </li>
</ul>
<ul>
  <li>
    <a href="/aws-leaked-credentials.html#aws-compromised-credentials"><span>AWS Compromised Credentials</span></a>
    <ul>
      <li>
        <a href="/aws-leaked-credentials.html#steps-for-a-leaked-credentials"><span>Steps for a leaked credentials</span></a>
      </li>
      <li>
        <a href="/aws-leaked-credentials.html#getting-new-credentials"><span>Getting new credentials</span></a>
      </li>
      <li>
        <a href="/aws-leaked-credentials.html#audit-the-compromised-credentials"><span>Audit the compromised credentials</span></a>
      </li>
    </ul>
  </li>
</ul>
<ul>
  <li>
    <a href="/aws-create-user.html#aws-console-access"><span>AWS Console Access</span></a>
    <ul>
      <li>
        <a href="/aws-create-user.html#steps-to-create-delete-users"><span>Steps to create/delete users</span></a>
      </li>
      <li>
        <a href="/aws-create-user.html#activating-mfa-for-new-users"><span>Activating MFA for new users</span></a>
      </li>
    </ul>
  </li>
</ul>
<ul>
  <li>
    <a href="/public-s3-bucket.html#make-an-s3-bucket-public"><span>Make an S3 bucket public</span></a>
  </li>
</ul>
<ul>
  <li>
    <a href="/delete-prometheus-metrics.html#delete-prometheus-metrics"><span>Delete Prometheus Metrics</span></a>
    <ul>
      <li>
        <a href="/delete-prometheus-metrics.html#1-identify-the-metrics-you-want-to-delete"><span>1.  Identify the metrics you want to delete</span></a>
      </li>
      <li>
        <a href="/delete-prometheus-metrics.html#2-enable-the-admin-interface-in-prometheus"><span>2. Enable the admin interface in Prometheus</span></a>
      </li>
      <li>
        <a href="/delete-prometheus-metrics.html#3-launch-a-port-forward-pod"><span>3. Launch a port-forward pod</span></a>
      </li>
      <li>
        <a href="/delete-prometheus-metrics.html#4-forward-local-traffic-to-prometheus"><span>4. Forward local traffic to Prometheus</span></a>
      </li>
      <li>
        <a href="/delete-prometheus-metrics.html#5-use-curl-in-another-terminal-to-hit-the-api-endpoint"><span>5. Use curl (in another terminal) to hit the API endpoint</span></a>
      </li>
      <li>
        <a href="/delete-prometheus-metrics.html#6-use-this-script-to-delete-multiple-metrics"><span>6. Use this script to delete multiple metrics</span></a>
      </li>
      <li>
        <a href="/delete-prometheus-metrics.html#7-clean-up"><span>7. Clean up</span></a>
      </li>
    </ul>
  </li>
</ul>
<ul>
  <li>
    <a href="/manually-apply-namespace.html#manually-plan-apply-namespace-resources"><span>Manually Plan/Apply Namespace Resources</span></a>
    <ul>
      <li>
        <a href="/manually-apply-namespace.html#start-in-the-appropriate-branch-of-the-environments-repo"><span>Start in the appropriate branch of the environments repo</span></a>
      </li>
      <li>
        <a href="/manually-apply-namespace.html#manually-plan-apply-namespace-resources-set-pingdom-environment-variables-optional"><span>Set pingdom environment variables(Optional)</span></a>
      </li>
      <li>
        <a href="/manually-apply-namespace.html#target-the-live-1-cluster"><span>Target the live-1 cluster</span></a>
      </li>
      <li>
        <a href="/manually-apply-namespace.html#set-some-environment-variables"><span>Set some environment variables</span></a>
      </li>
      <li>
        <a href="/manually-apply-namespace.html#manually-plan-apply-namespace-resources-set-the-namespace-name"><span>Set the namespace name</span></a>
      </li>
      <li>
        <a href="/manually-apply-namespace.html#manually-plan-apply-namespace-resources-terraform-init"><span>Terraform Init</span></a>
      </li>
      <li>
        <a href="/manually-apply-namespace.html#manually-plan-apply-namespace-resources-terraform-plan-apply"><span>Terraform Plan/Apply</span></a>
      </li>
    </ul>
  </li>
</ul>
<ul>
  <li>
    <a href="/manually-delete-namespace-resources.html#manually-delete-namespace-resources"><span>Manually Delete Namespace Resources</span></a>
  </li>
</ul>
<ul>
  <li>
    <a href="/delete-migrated-namespaces.html#delete-namespace-migrated-to-live"><span>Delete namespace migrated to live</span></a>
  </li>
</ul>
<ul>
  <li>
    <a href="/remove-data-from-elasticsearch.html#remove-data-from-elasticsearch"><span>Remove data from Elasticsearch</span></a>
    <ul>
      <li>
        <a href="/remove-data-from-elasticsearch.html#stop-the-breach-first"><span>Stop the breach first</span></a>
      </li>
      <li>
        <a href="/remove-data-from-elasticsearch.html#things-to-know"><span>Things to know</span></a>
      </li>
      <li>
        <a href="/remove-data-from-elasticsearch.html#build-your-query"><span>Build your query</span></a>
      </li>
      <li>
        <a href="/remove-data-from-elasticsearch.html#delete-by-query"><span>Delete by query</span></a>
      </li>
      <li>
        <a href="/remove-data-from-elasticsearch.html#removing-specific-logs-filtered-by-phrase"><span>Removing specific logs filtered by phrase</span></a>
      </li>
    </ul>
  </li>
</ul>
<ul>
  <li>
    <a href="/export-elasticsearch-to-csv.html#export-data-from-elasticsearch-into-a-csv-file"><span>Export data from Elasticsearch into a CSV file</span></a>
    <ul>
      <li>
        <a href="/export-elasticsearch-to-csv.html#workaround"><span>Workaround</span></a>
        <ul>
          <li>
            <a href="/export-elasticsearch-to-csv.html#install-es2csv"><span>Install es2csv</span></a>
          </li>
          <li>
            <a href="/export-elasticsearch-to-csv.html#usage"><span>Usage</span></a>
          </li>
        </ul>
      </li>
    </ul>
  </li>
</ul>
<ul>
  <li>
    <a href="/delete-state-lock.html#delete-terraform-state-lock"><span>Delete terraform state lock</span></a>
    <ul>
      <li>
        <a href="/delete-state-lock.html#command-line-method"><span>Command-line method</span></a>
      </li>
      <li>
        <a href="/delete-state-lock.html#aws-console-method"><span>AWS Console method</span></a>
      </li>
      <li>
        <a href="/delete-state-lock.html#terraform-command"><span>Terraform command</span></a>
      </li>
    </ul>
  </li>
</ul>
<ul>
  <li>
    <a href="/error-refreshing-state.html#terraform-state-lock-error-refreshing-state"><span>Terraform state lock - Error refreshing state</span></a>
  </li>
</ul>
<ul>
  <li>
    <a href="/divergence-error.html#how-to-investigate-divergence-errors"><span>How to Investigate Divergence Errors</span></a>
    <ul>
      <li>
        <a href="/divergence-error.html#reproduce-the-plan"><span>Reproduce the plan</span></a>
      </li>
    </ul>
  </li>
</ul>
<ul>
  <li>
    <a href="/replacing-failed-master-node.html#recover-from-an-etcd-failure"><span>Recover from an etcd failure</span></a>
    <ul>
      <li>
        <a href="/replacing-failed-master-node.html#recover-from-an-etcd-failure-pre-requisites"><span>Pre-requisites</span></a>
      </li>
      <li>
        <a href="/replacing-failed-master-node.html#identify-the-failed-master-node"><span>Identify the failed master node</span></a>
      </li>
      <li>
        <a href="/replacing-failed-master-node.html#remove-the-unhealthy-etcd-member"><span>Remove the unhealthy etcd member.</span></a>
      </li>
      <li>
        <a href="/replacing-failed-master-node.html#replacing-the-failed-master-via-kops"><span>Replacing the failed master via kops</span></a>
        <ul>
          <li>
          </li>
        </ul>
      </li>
    </ul>
  </li>
</ul>
<ul>
  <li>
    <a href="/recycle-node.html#recycle-node"><span>Recycle-node</span></a>
    <ul>
      <li>
        <a href="/recycle-node.html#guidance-for-the-cloud-platform-team-when-the-recycle-node-pipeline-job-fails"><span>Guidance for the Cloud Platform team, when the recycle-node pipeline job fails:</span></a>
      </li>
    </ul>
  </li>
</ul>
<ul>
  <li>
    <a href="/eks-cluster.html#provisioning-eks-clusters"><span>Provisioning EKS clusters</span></a>
    <ul>
      <li>
        <a href="/eks-cluster.html#provisioning-eks-clusters-pre-requisites"><span>Pre-requisites</span></a>
      </li>
      <li>
        <a href="/eks-cluster.html#provisioning"><span>Provisioning</span></a>
        <ul>
          <li>
            <a href="/eks-cluster.html#1-vpc"><span>1. VPC</span></a>
          </li>
          <li>
            <a href="/eks-cluster.html#2-creating-eks-cluster"><span>2. Creating EKS cluster</span></a>
          </li>
          <li>
            <a href="/eks-cluster.html#3-deploy-components"><span>3. Deploy components</span></a>
          </li>
          <li>
            <a href="/eks-cluster.html#4-delete-the-eks-cluster"><span>4. Delete the EKS cluster</span></a>
          </li>
        </ul>
      </li>
    </ul>
  </li>
</ul>
<ul>
  <li>
    <a href="/expand.html#expanding-persistent-volumes-created-using-statefulsets"><span>Expanding Persistent Volumes created using StatefulSets</span></a>
  </li>
</ul>
<ul>
  <li>
    <a href="/velero.html#velero-cluster-backups-and-disaster-recovery"><span>Velero - Cluster backups and disaster recovery</span></a>
    <ul>
      <li>
        <ul>
          <li>
          </li>
        </ul>
      </li>
      <li>
        <a href="/velero.html#backups"><span>Backups</span></a>
        <ul>
          <li>
            <a href="/velero.html#why"><span>Why?</span></a>
          </li>
          <li>
            <a href="/velero.html#what"><span>What?</span></a>
          </li>
          <li>
            <a href="/velero.html#how"><span>How?</span></a>
          </li>
        </ul>
      </li>
    </ul>
  </li>
</ul>
<ul>
  <li>
    <a href="/sonarqube-scan.html#sonarqube-code-quality-and-security-scanning"><span>Sonarqube - Code quality and security scanning</span></a>
    <ul>
      <li>
        <a href="/sonarqube-scan.html#sonarqube-scanning"><span>Sonarqube scanning</span></a>
        <ul>
          <li>
            <a href="/sonarqube-scan.html#sonarqube-scan-all-repositories"><span>Sonarqube scan all repositories</span></a>
          </li>
          <li>
            <a href="/sonarqube-scan.html#sonarqube-github-action"><span>Sonarqube Github Action</span></a>
          </li>
        </ul>
      </li>
    </ul>
  </li>
</ul>
<ul>
  <li>
    <a href="/running-kops-update-rollingupdate.html#running-kops-update-and-rollingupdate"><span>Running Kops Update and Rollingupdate</span></a>
    <ul>
      <li>
        <a href="/running-kops-update-rollingupdate.html#using-kops-to-change-the-cluster"><span>Using kops to change the cluster</span></a>
      </li>
      <li>
        <a href="/running-kops-update-rollingupdate.html#running-kops-update-and-rollingupdate-pre-requisites"><span>Pre-requisites</span></a>
      </li>
      <li>
        <a href="/running-kops-update-rollingupdate.html#updating-the-kops-state"><span>Updating the kops state</span></a>
        <ul>
          <li>
            <a href="/running-kops-update-rollingupdate.html#generating-an-updated-kops-config-file"><span>Generating an updated kops config file</span></a>
          </li>
          <li>
            <a href="/running-kops-update-rollingupdate.html#applying-local-changes-to-the-kops-state-store"><span>Applying local changes to the kops state store</span></a>
          </li>
        </ul>
      </li>
      <li>
        <a href="/running-kops-update-rollingupdate.html#running-kops-update"><span>Running Kops update</span></a>
      </li>
      <li>
        <a href="/running-kops-update-rollingupdate.html#running-kops-rolling-update"><span>Running Kops rolling-update</span></a>
      </li>
      <li>
        <a href="/running-kops-update-rollingupdate.html#possible-errors"><span>Possible Errors</span></a>
      </li>
    </ul>
  </li>
</ul>
<ul>
  <li>
    <a href="/helm-repository.html#cloud-platform-helm-chart-repository"><span>Cloud Platform helm chart repository</span></a>
    <ul>
      <li>
        <a href="/helm-repository.html#performing-crud-on-cloud-platform-helm-repository"><span>Performing CRUD on Cloud Platform Helm repository</span></a>
      </li>
    </ul>
  </li>
</ul>
<ul>
  <li>
    <a href="/get-audit-log-from-modsec.html#get-an-audit-log-from-modsec"><span>Get an audit log from modsec</span></a>
    <ul>
      <li>
        <a href="/get-audit-log-from-modsec.html#how-do-i-check-the-audit-log"><span>How do I check the audit log</span></a>
      </li>
      <li>
        <a href="/get-audit-log-from-modsec.html#exec-into-the-pod"><span>Exec into the pod</span></a>
      </li>
      <li>
        <a href="/get-audit-log-from-modsec.html#perform-a-search-for-the-unique-id-obtained-from-the-kibana-entry"><span>Perform a search for the unique-id (obtained from the Kibana entry)</span></a>
      </li>
    </ul>
  </li>
</ul>
<ul>
  <li>
    <a href="/access-eks-cluster.html#access-eks-cluster"><span>Access EKS cluster</span></a>
    <ul>
      <li>
        <a href="/access-eks-cluster.html#access-eks-cluster-pre-requisites"><span>Pre-requisites</span></a>
        <ul>
          <li>
            <a href="/access-eks-cluster.html#create-kubeconfig-using-aws-command"><span>Create kubeconfig using aws command</span></a>
          </li>
          <li>
            <a href="/access-eks-cluster.html#create-kubeconfig-manually-using-a-template"><span>Create kubeconfig manually using a template</span></a>
          </li>
        </ul>
      </li>
    </ul>
  </li>
</ul>
<ul>
  <li>
    <a href="/auth-keys.html#how-to-add-authorized-keys"><span>How to add authorized keys</span></a>
  </li>
</ul>
<ul>
  <li>
    <a href="/eks-node-terminal-access.html#terminal-access-to-eks-managed-nodes"><span>Terminal access to EKS managed nodes</span></a>
    <ul>
      <li>
        <a href="/eks-node-terminal-access.html#overview"><span>Overview</span></a>
      </li>
      <li>
        <a href="/eks-node-terminal-access.html#terminal-access-to-eks-managed-nodes-pre-requisites"><span>Pre-requisites</span></a>
      </li>
      <li>
        <a href="/eks-node-terminal-access.html#steps-to-get-terminal-access-via-console"><span>Steps to get terminal access via Console</span></a>
      </li>
      <li>
        <a href="/eks-node-terminal-access.html#steps-to-get-terminal-access-via-aws-cli"><span>Steps to get terminal access via AWS cli</span></a>
      </li>
    </ul>
  </li>
</ul>
<ul>
  <li>
    <a href="/joiners-guide.html#onboarding-into-the-cloud-platform-team"><span>Onboarding into the Cloud Platform Team</span></a>
    <ul>
      <li>
        <a href="/joiners-guide.html#people-team"><span>People Team</span></a>
      </li>
      <li>
        <a href="/joiners-guide.html#service-desk"><span>Service Desk</span></a>
      </li>
      <li>
        <a href="/joiners-guide.html#sit-down-with-dm"><span>Sit down with DM</span></a>
      </li>
      <li>
        <a href="/joiners-guide.html#cloud-platform-team"><span>Cloud Platform team</span></a>
      </li>
      <li>
        <a href="/joiners-guide.html#access"><span>ACCESS</span></a>
      </li>
    </ul>
  </li>
</ul>
<ul>
  <li>
    <a href="/add-new-opa-policy.html#open-policy-agent-policies"><span>Open Policy Agent policies</span></a>
    <ul>
      <li>
        <a href="/add-new-opa-policy.html#adding-a-policy"><span>Adding a policy</span></a>
      </li>
      <li>
        <a href="/add-new-opa-policy.html#writing-tests"><span>Writing tests</span></a>
      </li>
      <li>
        <a href="/add-new-opa-policy.html#references"><span>References</span></a>
      </li>
    </ul>
  </li>
</ul>
<ul>
  <li>
    <a href="/custom-default-backend.html#custom-default-backend"><span>Custom default-backend</span></a>
    <ul>
      <li>
        <ul>
          <li>
            <a href="/custom-default-backend.html#background"><span>Background</span></a>
          </li>
          <li>
            <a href="/custom-default-backend.html#use-platform-level-error-page"><span>Use platform-level error page</span></a>
          </li>
          <li>
            <a href="/custom-default-backend.html#not-use-platform-level-error-page"><span>Not use platform-level error page</span></a>
          </li>
        </ul>
      </li>
    </ul>
  </li>
</ul>
<ul>
  <li>
    <a href="/destroy-concourse-build-data.html#destroy-concourse-build-data"><span>Destroy Concourse Build Data</span></a>
    <ul>
      <li>
        <a href="/destroy-concourse-build-data.html#destroy-concourse-build-data-overview"><span>Overview</span></a>
      </li>
      <li>
        <a href="/destroy-concourse-build-data.html#steps-to-remove-the-build-data"><span>Steps to remove the build data</span></a>
      </li>
    </ul>
  </li>
</ul>
<ul>
  <li>
    <a href="/cloud-platform-to-tgw.html#adding-a-route-to-connect-to-a-tgw"><span>Adding a route to connect to a TGW</span></a>
    <ul>
      <li>
        <a href="/cloud-platform-to-tgw.html#quick-introduction"><span>Quick introduction</span></a>
      </li>
      <li>
        <a href="/cloud-platform-to-tgw.html#transit-gateway"><span>Transit Gateway</span></a>
      </li>
      <li>
        <a href="/cloud-platform-to-tgw.html#making-the-change"><span>Making the change</span></a>
      </li>
    </ul>
  </li>
</ul>
<ul>
  <li>
    <a href="/destroy-concourse-worker-pv.html#destroy-concourse-worker-pv-39-s"><span>Destroy Concourse Worker PV’s</span></a>
    <ul>
      <li>
        <a href="/destroy-concourse-worker-pv.html#when-should-you-use-this-document"><span>When should you use this document</span></a>
      </li>
      <li>
        <a href="/destroy-concourse-worker-pv.html#how-to-fix-the-issue"><span>How to fix the issue</span></a>
      </li>
    </ul>
  </li>
</ul>
<ul>
  <li>
    <a href="/leavers-guide.html#leavers-guide"><span>Leavers Guide</span></a>
    <ul>
      <li>
        <a href="/leavers-guide.html#revoking-access"><span>Revoking Access</span></a>
        <ul>
          <li>
            <a href="/leavers-guide.html#digital-services"><span>Digital Services</span></a>
          </li>
          <li>
            <a href="/leavers-guide.html#aws-accounts"><span>AWS Accounts</span></a>
          </li>
        </ul>
      </li>
      <li>
        <a href="/leavers-guide.html#line-manager-actions"><span>Line manager actions</span></a>
        <ul>
          <li>
          </li>
        </ul>
      </li>
    </ul>
  </li>
</ul>
<ul>
  <li>
    <a href="/scheduled-pr-reminders.html#scheduled-pr-reminders"><span>Scheduled PR Reminders</span></a>
    <ul>
      <li>
        <ul>
          <li>
            <a href="/scheduled-pr-reminders.html#steps-required-for-new-repositories"><span>Steps required for new repositories</span></a>
          </li>
        </ul>
      </li>
    </ul>
  </li>
</ul>
<ul>
  <li>
    <a href="/grafana-dashboards.html#grafana-dashboards"><span>Grafana Dashboards</span></a>
    <ul>
      <li>
        <a href="/grafana-dashboards.html#kubernetes-number-of-pods-per-node"><span>Kubernetes Number of Pods per Node</span></a>
        <ul>
          <li>
            <a href="/grafana-dashboards.html#dashboard-layout"><span>Dashboard Layout</span></a>
          </li>
          <li>
            <a href="/grafana-dashboards.html#troubleshooting"><span>Troubleshooting</span></a>
          </li>
        </ul>
      </li>
    </ul>
  </li>
</ul>
<ul>
  <li>
    <a href="/on-call.html#going-on-call"><span>Going on call</span></a>
    <ul>
      <li>
        <a href="/on-call.html#what-s-expected"><span>What’s expected?</span></a>
        <ul>
          <li>
            <a href="/on-call.html#expected"><span>Expected:</span></a>
          </li>
          <li>
            <a href="/on-call.html#not-expected"><span>Not Expected:</span></a>
          </li>
        </ul>
      </li>
      <li>
        <a href="/on-call.html#where-do-i-start"><span>Where do I start?</span></a>
      </li>
      <li>
        <a href="/on-call.html#what-do-i-get-for-being-on-call"><span>What do I get for being on call?</span></a>
      </li>
      <li>
        <a href="/on-call.html#civil-servants"><span>Civil servants</span></a>
      </li>
      <li>
        <a href="/on-call.html#contractors"><span>Contractors</span></a>
      </li>
    </ul>
  </li>
</ul>
<ul>
  <li>
    <a href="/cloud-platform-communications-plan.html#cloud-platform-communications-plan"><span>Cloud Platform Communications Plan</span></a>
    <ul>
      <li>
        <a href="/cloud-platform-communications-plan.html#the-plan"><span>The Plan</span></a>
      </li>
      <li>
        <a href="/cloud-platform-communications-plan.html#tips-on-format-of-communications"><span>Tips on format of communications</span></a>
        <ul>
          <li>
            <a href="/cloud-platform-communications-plan.html#tips-on-format-of-communications-examples"><span>Examples</span></a>
          </li>
          <li>
            <a href="/cloud-platform-communications-plan.html#things-to-include-in-incident-communications"><span>Things to include in incident communications</span></a>
          </li>
          <li>
            <a href="/cloud-platform-communications-plan.html#example"><span>Example</span></a>
          </li>
          <li>
            <a href="/cloud-platform-communications-plan.html#things-to-include-in-upgrade-communications"><span>Things to include in upgrade communications</span></a>
          </li>
          <li>
            <a href="/cloud-platform-communications-plan.html#tips-on-format-of-communications-example"><span>Example</span></a>
          </li>
        </ul>
      </li>
      <li>
        <a href="/cloud-platform-communications-plan.html#sharing-information-with-the-wider-ministry-of-justice-and-the-public"><span>Sharing information with the wider Ministry of Justice and the Public</span></a>
      </li>
    </ul>
  </li>
</ul>
<ul>
  <li>
    <a href="/tips-and-tricks.html#tips-and-tricks"><span>Tips and Tricks</span></a>
    <ul>
      <li>
        <a href="/tips-and-tricks.html#delete-an-rds-database-snapshot"><span>Delete an RDS database snapshot</span></a>
      </li>
      <li>
        <a href="/tips-and-tricks.html#check-the-expiration-date-of-the-ssl-certificate-for-a-live-domain"><span>Check the expiration date of the SSL certificate for a live domain</span></a>
      </li>
      <li>
        <a href="/tips-and-tricks.html#run-etcdctl-on-a-master-node"><span>Run etcdctl on a master node</span></a>
      </li>
      <li>
        <a href="/tips-and-tricks.html#delete-a-quot-stuck-quot-resource"><span>Delete a “stuck” resource</span></a>
      </li>
      <li>
        <a href="/tips-and-tricks.html#filter-namespaces-by-specific-label-or-annotation"><span>Filter namespaces by specific label or annotation</span></a>
      </li>
      <li>
        <a href="/tips-and-tricks.html#find-all-pods-running-on-a-specific-worker-node"><span>Find all pods running on a specific worker node</span></a>
      </li>
      <li>
        <a href="/tips-and-tricks.html#count-pods-running-on-all-nodes"><span>Count pods running on all nodes</span></a>
      </li>
      <li>
        <a href="/tips-and-tricks.html#install-tmux-and-docker-on-the-live-1-bastion-host"><span>Install tmux and docker on the live-1 bastion host</span></a>
      </li>
      <li>
        <a href="/tips-and-tricks.html#output-all-records-from-route53-as-a-csv-file"><span>Output all records from Route53 as a CSV file</span></a>
      </li>
      <li>
        <a href="/tips-and-tricks.html#add-more-rss-feeds-to-cloud-platform-rss-channel"><span>Add more RSS feeds to #cloud-platform-rss channel</span></a>
      </li>
      <li>
        <a href="/tips-and-tricks.html#find-files-which-don-39-t-contain-a-particular-string"><span>Find files which don’t contain a particular string</span></a>
      </li>
      <li>
        <a href="/tips-and-tricks.html#get-aws-ec2-instance-information-for-a-node"><span>Get AWS EC2 instance information for a node</span></a>
      </li>
      <li>
        <a href="/tips-and-tricks.html#create-a-one-off-job-to-repeat-a-cronjob"><span>Create a one-off job to repeat a cronjob</span></a>
      </li>
      <li>
        <a href="/tips-and-tricks.html#hijack-a-concourse-job-container"><span>Hijack a concourse job container</span></a>
      </li>
      <li>
        <a href="/tips-and-tricks.html#help-when-manually-deleting-aws-resources"><span>Help when manually deleting AWS resources</span></a>
      </li>
      <li>
        <a href="/tips-and-tricks.html#find-out-why-your-namespace-isn-39-t-deleting"><span>Find out why your namespace isn’t deleting</span></a>
      </li>
    </ul>
  </li>
</ul>
<ul>
  <li>
    <a href="/add-a-new-runbook.html#add-a-new-runbook"><span>Add a new runbook</span></a>
    <ul>
      <li>
        <ul>
          <li>
          </li>
        </ul>
      </li>
    </ul>
  </li>
</ul>


              </nav>
            </div>
          </div>

        <div class="app-pane__content toc-open-disabled">
          <main id="content" class="technical-documentation" data-module="anchored-headings">
              <h1 id="cloud-platform-disaster-recovery-scenarios">Cloud Platform Disaster Recovery Scenarios</h1><p>This section will document various scenarios that will create an incident. Each scenario will have an impact and restore process.</p>
<h2 id="losing-a-namespace">Losing a Namespace</h2><h3 id="impact">Impact</h3><p>A loss of a namespace will result in losing all resources within the namespace including ingress.</p>
<h3 id="possible-cause">Possible Cause</h3><p>User error - Executing <code>kubectl delete ns my-namespace-dev</code></p>
<div class="highlight"><pre class="highlight plaintext" tabindex="0"><code>kubectl get all -n my-namespace-dev
No resources found in my-namespace-dev namespace.
</code></pre></div><h3 id="restore-process">Restore process</h3><p>As long as the namespace is over 3 hours old, it can be recovered using Velero.</p>
<p>First step is to find the name of the most recent backup of the <code>allnamespacebackup</code> schedule:</p>
<div class="highlight"><pre class="highlight plaintext" tabindex="0"><code>velero backup get

NAME                                       STATUS      CREATED                         EXPIRES   STORAGE LOCATION   SELECTOR
velero-allnamespacebackup-00000000000000   Completed   2020-03-30 12:00:37 +0100 BST   29d       default            &lt;none&gt;
</code></pre></div><p>Using the backup name, you can now run a <code>Velero restore</code> command to restore the deleted namespace.</p>
<p>Restore command:</p>
<div class="highlight"><pre class="highlight plaintext" tabindex="0"><code>velero restore create &lt;restore-name&gt; --from-backup &lt;backup-name&gt; --include-namespaces &lt;namespace&gt; --wait
</code></pre></div><p>Example:</p>
<div class="highlight"><pre class="highlight plaintext" tabindex="0"><code>velero restore create my-namespace-dev-restore --from-backup velero-allnamespacebackup-00000000000000 --include-namespaces my-namespace-dev --wait
</code></pre></div><p>Once completed, you should be able to see the namespace and all resources recovered:</p>
<div class="highlight"><pre class="highlight plaintext" tabindex="0"><code>kubectl get all -n my-namespace-dev

NAME                       READY   STATUS      RESTARTS   AGE
pod/pod1                   2/2     Running     0          1m

NAME                       TYPE        CLUSTER-IP       EXTERNAL-IP   PORT(S)      AGE
service/service1           ClusterIP   None             None          443/TCP      1m

NAME                                 READY   UP-TO-DATE   AVAILABLE   AGE
deployment.apps/deployment1          1/1     1            1           1m

NAME                                 DESIRED   CURRENT   READY   AGE
replicaset.apps/replicaset1          1         1         1       1m
</code></pre></div><h2 id="losing-a-kubernetes-component-or-object">Losing a Kubernetes Component or Object</h2><h3 id="losing-a-kubernetes-component-or-object-impact">Impact</h3><p>A loss of a kubernetes object such as a deployment, secret and Namespace can result in an application not working correctly. A loss of a Kubernetes component such as kube-scheduler or kube-control-manager can result in the cluster not working correctly.</p>
<h3 id="losing-a-kubernetes-component-or-object-possible-cause">Possible Cause</h3><p>User error - Executing <code>kubectl delete deployment/my-deployment-name ns my-namespace-dev</code></p>
<div class="highlight"><pre class="highlight plaintext" tabindex="0"><code>kubectl get deployment/my-deployment-name -n my-namespace-dev
Error from server (NotFound): deployments.extensions "my-deployment-name" not found.
</code></pre></div><h3 id="losing-a-kubernetes-component-or-object-restore-process">Restore process</h3><p>As long as the namespace is over 3 hours old, it can be recovered using Velero.</p>
<p>First step is to find the name of the most recent backup of the schedule:</p>
<div class="highlight"><pre class="highlight plaintext" tabindex="0"><code>velero backup get

NAME                                       STATUS      CREATED                         EXPIRES   STORAGE   LOCATION   SELECTOR
velero-backup-00000000000000              Completed   2020-03-30 12:00:37 +0100 BST     29d       default             &lt;none&gt;
</code></pre></div><p>Using the backup name, you can now run a <code>Velero restore</code> command to restore the deleted resource.</p>
<p>Restore command:</p>
<div class="highlight"><pre class="highlight plaintext" tabindex="0"><code>velero restore create &lt;restore-name&gt; --from-backup &lt;backup-name&gt; --include-namespaces &lt;namespace&gt; --wait
</code></pre></div><p>Example:</p>
<div class="highlight"><pre class="highlight plaintext" tabindex="0"><code>velero restore create my-namespace-dev-restore --from-backup velero-backup-00000000000000 --include-namespaces my-namespace-dev --wait
</code></pre></div><p>Once completed, you should be able to see the resources recovered:</p>
<div class="highlight"><pre class="highlight plaintext" tabindex="0"><code>kubectl get deployment/my-deployment-name -n my-namespace-dev

NAME                                     READY   UP-TO-DATE   AVAILABLE   AGE
deployment.apps/my-deployment-name        1/1       1            1         1m

</code></pre></div><h2 id="losing-the-whole-cluster">Losing the whole cluster</h2><h3 id="losing-the-whole-cluster-impact">Impact</h3><p>Severity : HIGH</p>
<p>Likelihood: LOW</p>
<p>Losing the whole kubernetes cluster will result in all services not being available. This means all the
resources within all namespaces, networking, monitoring and logging systems.</p>
<h3 id="losing-the-whole-cluster-possible-cause">Possible Cause</h3><p>Losing the whole cluster is less likely and the possible causes may vary.</p>
<p>User error - Deleting all EC2 instances of <code>&lt;cluster-name&gt;</code> from console by accident</p>
<p>The first sign of this happening is likely to be Pagerduty alarms to the high/low priority slack channels.</p>
<h3 id="how-this-plan-is-tested">How this plan is tested:</h3><p>This way of restoring the whole cluster have been tested with below procedure</p>

<ol>
<li>Create cluster using the <a href="https://github.com/ministryofjustice/cloud-platform-infrastructure/blob/main/create-cluster.rb">script</a></li>
<li>Deploy <a href="https://github.com/ministryofjustice/cloud-platform-terraform-starter-pack">starter pack</a> to replicate user namespaces</li>
<li>Take backup of the whole cluster using <a href="/velero.html#velero-cluster-backups-and-disaster-recovery">velero</a></li>
<li>Destroy the cluster excluding the VPC using the <a href="https://github.com/ministryofjustice/cloud-platform-infrastructure/blob/main/destroy-cluster.rb">script</a></li>
<li>Create a cluster with the same name. That way velero can match the backup storage location</li>
<li>Restore the cluster from the backup taken in Step 3</li>
</ol>
<h3 id="assumptions">Assumptions</h3>
<ul>
<li>VPC of the cluster is not deleted</li>
<li>Not all Kubernetes resources are tested for Recovery</li>
<li>Not all AWS resources are tested for reconnecting to application after restore</li>
<li>Smoke tests are run excluding one for <code>live-1</code></li>
<li>Terraform state have been recreated</li>
</ul>
<h3 id="losing-the-whole-cluster-restore-process">Restore process</h3><p>Any namespaces over 3 hours old can be recovered using Velero (newer namespaces might not have been backed up before the incident occurred).</p>
<p>Create the cluster with the <strong>same</strong> name from the <a href="https://github.com/ministryofjustice/cloud-platform-infrastructure/blob/main/create-cluster.rb">source code</a>
and provide the exisiting <code>vpc-name</code>. This will link the velero backup locations to the lost cluster.</p>
<p>Find the name of the most recent backup of the <code>allnamespacebackup</code> schedule:</p>
<div class="highlight"><pre class="highlight plaintext" tabindex="0"><code>velero backup get

NAME                                       STATUS      CREATED                         EXPIRES   STORAGE LOCATION   SELECTOR
velero-allnamespacebackup-00000000000000   Completed   2020-03-30 12:00:37 +0100 BST   29d       default            &lt;none&gt;
</code></pre></div><p>Using the backup name, you can now run a <code>velero restore</code> command to restore the deleted namespace.</p>
<p>Restore command:</p>
<div class="highlight"><pre class="highlight plaintext" tabindex="0"><code>velero restore create &lt;restore-name&gt; --from-backup &lt;backup-name&gt; --wait
</code></pre></div><p>Example:</p>
<div class="highlight"><pre class="highlight plaintext" tabindex="0"><code>velero restore create my-namespace-dev-restore --from-backup velero-allnamespacebackup-00000000000000 --wait
</code></pre></div><p>Once completed, you should be able to see resources in all namespaces recovered.</p>
<p>Check the status of the restore and look for errors and warnings:</p>
<div class="highlight"><pre class="highlight plaintext" tabindex="0"><code>velero restore describe velero-allnamespacebackup-00000000000000-00000000000000
</code></pre></div><p>Check the logs of the restore:</p>
<div class="highlight"><pre class="highlight plaintext" tabindex="0"><code>velero restore logs velero-allnamespacebackup-00000000000000-00000000000000

</code></pre></div><h2 id="deleted-corrupted-the-kops-state">Deleted/corrupted the kops state</h2><h3 id="deleted-corrupted-the-kops-state-impact">Impact</h3><p>Severity : LOW</p>
<p>Likelihood: LOW/MEDIUM</p>
<p>When the kops state is corrupted, in most cases the kubernetes cluster will still be operational.</p>
<p>This means the services will not have any impact, if the issue is resolved in a shorter amount of time.</p>
<p>Leaving the cluster in the corrupted kops state for a prolonged period will reduce the cluster being highly available
and not handle any failover in case one or more masters has gone down.</p>
<p>Hence, Cloud platform team will not be able to perform any infrastructure changes. Also, teams will not able to communicate with the cluster
to deploy applications or schedule any jobs.</p>
<h3 id="deleted-corrupted-the-kops-state-possible-cause">Possible Cause</h3><p>Kops state may get corruputed when the kops template is changed for</p>

<ul>
<li>upgrading kubernetes</li>
<li>changing an instancegroup</li>
<li>any other config changes</li>
</ul>
<p>It could also be corrupted/lost if a user deleted the s3 bucket by accident where the kops state is stored</p>
<p>The sign of this happening can be seen when doing <code>kops validate cluster &lt;cluster name&gt;</code></p>
<p>If the kops state is corrupted, some of the worker nodes or masters machines will not join the cluster.</p>
<p>The above command will show something similar to</p>
<div class="highlight"><pre class="highlight plaintext" tabindex="0"><code>
VALIDATION ERRORS
KIND    NAME            MESSAGE
Machine i-04195929decb7a43b             machine "i-04195929decb7a43b" has not yet joined cluster
Node    ip-172-20-74-189.eu-west-2.compute.internal node "ip-172-20-74-189.eu-west-2.compute.internal" is not ready
Pod kube-system/calico-node-kp6m7           kube-system pod "calico-node-kp6m7" is pending

Validation Failed
</code></pre></div><p>If the s3 bucket is deleted where the kops state is stored, then <code>kops validate ...</code> show as</p>
<div class="highlight"><pre class="highlight plaintext" tabindex="0"><code>
error reading cluster configuration: Cluster.kops.k8s.io "&lt;cluster name&gt;.cloud-platform.service.justice.gov.uk" not found
</code></pre></div><h3 id="restore-process-for-corrupted-kops-state">Restore process for corrupted kops state</h3><p>The cluster kops state is stored in the generated yaml file inside the folder kops/<code>&lt;CLUSTER_NAME&gt;</code>.yaml.</p>
<p>For <code>live-1</code> the generated kops yaml file is stored in the <a href="https://github.com/ministryofjustice/cloud-platform-infrastructure/blob/main/kops/live-1.yaml">github</a>.
So, checkout the previous working commit and update the remote kops state with that file.</p>
<p>If the cluster state is corrupted due to the latest changes to the yaml file, revert back the changes and update the remote kops state.</p>
<p>Below are the steps to update and restore the kops state</p>
<p>** Revert the kops yaml file kops/<code>&lt;CLUSTER_NAME&gt;</code>.yaml to previous working version.</p>
<p><strong>Authenticate to the cluster</strong></p>
<div class="highlight"><pre class="highlight plaintext" tabindex="0"><code>kops export kubecfg XXXXXXX.cloud-platform.service.justice.gov.uk
</code></pre></div><p><strong>Update the remote state with the reverted changes</strong></p>
<div class="highlight"><pre class="highlight plaintext" tabindex="0"><code>kops replace -f kops/&lt;CLUSTER_NAME&gt;.yaml
kops update cluster
</code></pre></div><p><strong>Update the cluster with &ndash;yes to apply the changes</strong></p>
<div class="highlight"><pre class="highlight plaintext" tabindex="0"><code>kops update cluster --yes
</code></pre></div><p><strong>If the above command reports that the cluster needs to be rolled, do the rolling-update and with <code>--yes</code> option</strong></p>
<div class="highlight"><pre class="highlight plaintext" tabindex="0"><code>kops rolling-update cluster --yes
</code></pre></div><p>For more information on kops update, rolling-update and debugging instructions, refer
<a href="/running-kops-update-rollingupdate.html#running-kops-update-and-rollingupdate">runbook for kops update</a></p>
<p>If the restore process require creating new instancegroup for worker nodes, follow the procedure mentioned
in <a href="https://runbooks.cloud-platform.service.justice.gov.uk/upgrade-cluster.html#upgrade-a-cluster">Upgrade a cluster</a>.</p>
<p>The difference to the upgrading procedure would be</p>

<ul>
<li><p>reverting the kops yaml file to old working version of kubernetes and</p></li>
<li><p>if new instancegroup for worker nodes is needed, then to create one with working kubernetes version and move workload back to that worker nodes.</p></li>
</ul>
<h3 id="restore-process-for-deleted-s3-bucket-where-kops-state-is-stored">Restore process for deleted S3 bucket where kops state is stored</h3><p>Kops state of all clusters are backed up in a different s3 bucket <code>kops-backup-replication</code> in the region <code>eu-west-2</code>.</p>
<p>If the entire folder where the cluster state is stored is lost/corrupted, copy the folder from the backup bucket by running below</p>
<div class="highlight"><pre class="highlight plaintext" tabindex="0"><code>aws s3 cp s3://kops-backup-replication/&lt;cluster_name&gt;.cloud-platform.service.justice.gov.uk/ s3://cloud-platform-kops-state/ --recursive
</code></pre></div><p>Validate the cluster</p>
<div class="highlight"><pre class="highlight plaintext" tabindex="0"><code>kops validate cluster &lt;cluster name&gt;
</code></pre></div><p>The validation should be success and should say</p>
<p><strong>&ldquo;Your cluster <code>&lt;cluster name&gt;</code>.cloud-platform.service.justice.gov.uk is ready&rdquo;</strong></p>
<h2 id="deleted-terraform-state">Deleted terraform state</h2><p>Severity : low</p>
<p>Likelihood: medium</p>
<h3 id="deleted-terraform-state-impact">Impact</h3><p>Items removed from the terraform state are not physically destroyed but no longer managed by terraform. This means infrastructure is orphaned with no state.</p>
<p>For example, if you remove an AWS instance from the state, the AWS instance will continue running, but terraform plan will no longer see that instance.</p>
<h3 id="deleted-terraform-state-possible-cause">Possible Cause</h3><p>User error - Executing <code>terraform state rm module.starter_pack.kubernetes_namespace.starter_pack</code>  will remove kubernetes starter_pack namespace from terraform state. When state is removed, running &ldquo;terraform apply&rdquo; will raise error, as terraform cannot track about existing resource and try to create new one.</p>
<div class="highlight"><pre class="highlight plaintext" tabindex="0"><code>terraform apply -target=module.starter_pack.kubernetes_namespace.starter_pack

Error: namespaces "starter-pack" already exists
</code></pre></div><h3 id="deleted-terraform-state-restore-process">Restore process</h3><p>In order to regain control of resource removed from terraform state, we will use the <a href="https://www.terraform.io/docs/import/index.html">import command</a> to recover the metadata for this resource. Import requires a resource address and the resource ID. The resource address is a combination of the resource type and resource name.</p>
<div class="highlight"><pre class="highlight plaintext" tabindex="0"><code>terraform import module.starter_pack.kubernetes_namespace.starter_pack starter-pack

</code></pre></div><p>The import command creates a new state file pulling in information about the specified kubernetes_namespace.</p>
<div class="highlight"><pre class="highlight plaintext" tabindex="0"><code>module.starter_pack.kubernetes_namespace.starter_pack: Importing from ID "starter-pack"...
module.starter_pack.kubernetes_namespace.starter_pack: Refreshing state... [id=starter-pack]

Import successful!

The resources that were imported are shown above. These resources are now in
your Terraform state and will henceforth be managed by Terraform.
</code></pre></div><p>Now running terraform apply after import, will not raise any error.</p>
<div class="highlight"><pre class="highlight plaintext" tabindex="0"><code>terraform apply -target=module.starter_pack.kubernetes_namespace.starter_pack

Apply complete! Resources: 0 added, 0 changed, 0 destroyed.
</code></pre></div><h3 id="recovering-more-complex-scenarios">Recovering more complex scenarios</h3><p>There are scenarios, where terraform state is corrupted or terraform state is removed for the whole module.
Executing <code>terraform state rm module.starter_pack</code>, will remove all resources in &ldquo;starter_pack&rdquo; module from terraform state.</p>
<div class="highlight"><pre class="highlight plaintext" tabindex="0"><code>terraform plan -target=module.starter_pack

Plan: 7 to add, 0 to change, 0 to destroy.
</code></pre></div><p>In this scenario, terraform state can be restored from the remote_state stored in the terraform backend S3 bucket.</p>
<p>For example <a href="https://github.com/ministryofjustice/cloud-platform-infrastructure/tree/main/terraform/aws-accounts/cloud-platform-aws/vpc/eks/components">eks-components</a> state is stored in &ldquo;aws-accounts/cloud-platform-aws/vpc/eks/components&rdquo; s3 bucket as defined <a href="https://github.com/ministryofjustice/cloud-platform-infrastructure/blob/main/terraform/aws-accounts/cloud-platform-aws/vpc/eks/components/main.tf/#L5-L14">here-eks</a>.</p>
<p>or <a href="https://github.com/ministryofjustice/cloud-platform-infrastructure/tree/main/terraform/aws-accounts/cloud-platform-aws/vpc/kops/components">kops-components</a> state is stored in &ldquo;aws-accounts/cloud-platform-aws/vpc/kops/components&rdquo; s3 bucket as defined <a href="https://github.com/ministryofjustice/cloud-platform-infrastructure/blob/main/terraform/aws-accounts/cloud-platform-aws/vpc/kops/components/main.tf/#L1-L11">here-kops</a>.</p>
<p>Access the S3 bucket where the effected terraform state is stored. From the list of terraform.tfstate file versions, identify the file before the state got removed and download as terraform.tfstate. Upload the file again, this will set uploaded file as latest version.</p>
<p>Now running terraform plan will show, infrastructure is up-to-date.</p>
<div class="highlight"><pre class="highlight plaintext" tabindex="0"><code>terraform plan -target=module.starter_pack

No changes. Infrastructure is up-to-date.
</code></pre></div><h2 id="lost-or-corrupt-etcd-volume">Lost or corrupt etcd volume</h2><p>Severity : low</p>
<p>Likelihood: medium</p>
<h3 id="lost-or-corrupt-etcd-volume-impact">Impact</h3><p>Kubernetes live-1 cluster deployed with kops stores the etcd state in two different AWS EBS volumes per master node. One volume is used to store the Kubernetes main data, the other one for events. For a cluster with three masters will result in six volumes for etcd data (one in each AZ).</p>
<p>Lost or corrupt etcd volume results in unhealthy <a href="https://github.com/kubernetes/kops/blob/master/docs/cluster_spec.md#etcdclusters">etcd cluster</a>. This means master node associated with the corrupt or Lost etcd volume will become not ready status and fail to join the cluster.</p>
<h3 id="lost-or-corrupt-etcd-volume-possible-cause">Possible Cause</h3>
<ul>
<li>Lost volume: Deleting one of the etcd volume associated with the master node from aws console by accident</li>
<li>Corrupt volume: Accidentally restoring etcd volume from a wrong snapshot and attach it to the working master node.</li>
</ul>
<p>We will see warnings like this in this master log file:</p>
<div class="highlight"><pre class="highlight plaintext" tabindex="0"><code>kubectl -n kube-system logs etcd-manager-main-ip-xxx-xx-xx-xxx.eu-west-2.compute.internal

etcdserver: failed to reach the peerURL(https://etcd-x.internal.&lt;cluster-name&gt;.cloud-platform.service.justice.gov.uk:2380) of member &lt;member-id&gt;
rafthttp: health check for peer &lt;member-id&gt; connect: connection refused (prober "ROUND_TRIPPER_SNAPSHOT")
rafthttp: health check for peer &lt;member-id&gt; connect: connection refused (prober "ROUND_TRIPPER_RAFT_MESSAGE")

</code></pre></div><div class="highlight"><pre class="highlight plaintext" tabindex="0"><code>kops validate cluster

VALIDATION ERRORS
KIND    NAME            MESSAGE
Node    &lt;node-name&gt;     master "&lt;node-name&gt;" is not ready

Validation Failed
</code></pre></div><h3 id="lost-or-corrupt-etcd-volume-restore-process">Restore process</h3><p>Restoring corrupt or lost etcd involves two steps: remove the unhealthy etcd member and replace the effected master node via kops. Covering both steps, we already have a <a href="https://runbooks.cloud-platform.service.justice.gov.uk/replacing-failed-master-node.html#replacing-a-failed-master-node">runbook</a>, follow it step by step to restore unhealthy etcd.</p>
<h2 id="overwriting-kops-cluster-39-s-components-with-eks-components">Overwriting KOPS cluster&rsquo;s components with EKS components</h2><h3 id="overwriting-kops-cluster-39-s-components-with-eks-components-impact">Impact</h3><p>Certain components that are unique to EKS such as concourse will be introduced to the KOPS cluster.
A number of components will have specific annotations applied to them that are only applicable for an EKS cluster.</p>
<h3 id="overwriting-kops-cluster-39-s-components-with-eks-components-possible-cause">Possible Cause</h3><p>The EKS components are applied whilst the <code>kubectl context</code> is set to a kops cluster.</p>
<h3 id="overwriting-kops-cluster-39-s-components-with-eks-components-restore-process">Restore process</h3><p>Use <code>terraform destroy</code> to delete all existing components from the <code>cloud-platform-eks/components</code> folder and re-apply using <code>terraform apply</code> from the <code>cloud-platform-components</code> folder.</p>
<p>Only those resources that are part of the state can be re-applied, however there are certain resources created by service teams such as certificates and resources created from CRDs that will not be restored by <code>terraform apply.</code>
For these resources a Velero restore will have to be executed.</p>
<h3 id="reproducing-incident-steps">Reproducing Incident Steps</h3><p>To test the recovery of the CRD resources, first ensure that they exist so that when recovering we can verify they are restored by Velero. Below are templates for each of the CRDs used.</p>
<p>Service Monitor</p>
<div class="highlight"><pre class="highlight plaintext" tabindex="0"><code>apiVersion: monitoring.coreos.com/v1
kind: ServiceMonitor
metadata:
  name: dr-test-service
spec:
  selector:
    matchLabels:
      app: dr-test-service
  endpoints:
  - port: http
    interval: 15s
</code></pre></div><p>Save the above yaml and execute into the desired namespace e.g <code>kubectl create -f &lt;FILE_NAME&gt;.yaml -n &lt;NAMESPACE&gt;</code></p>
<p>Prometheus Rule</p>
<div class="highlight"><pre class="highlight plaintext" tabindex="0"><code>apiVersion: monitoring.coreos.com/v1
kind: PrometheusRule
metadata:
  labels:
    role: alert-rules
  name: prometheus-custom-rules-data-dev
spec:
  groups:
  - name: node.rules
    rules:
    - alert: cica--Quota-Exceeded--dev
      expr: 100 * kube_resourcequota{job="kube-state-metrics",type="used",namespace="&lt;NAMESPACE&gt;"} / ignoring(instance, job, type) (kube_resourcequota{job="kube-state-metrics",type="hard"} &gt; 0) &gt; 90
      for: 5m
      labels:
        severity: cica-dev-dev
      annotations:
        message: Namespace {{ $labels.namespace }} is using {{ printf "%0.0f" $value}}% of its {{ $labels.resource }} quota.
        runbook_url: https://github.com/kubernetes-monitoring/kubernetes-mixin/
    - alert: cica--KubeJobFailed--dev
      annotations:
        message: Job {{ $labels.namespace }}/{{ $labels.job_name }} failed to complete.
        runbook_url: https://github.com/kubernetes-monitoring/kubernetes-mixin/blob/master/runbook.md#alert-name-kubejobfailed
      expr: kube_job_status_failed{job="kube-state-metrics",namespace="&lt;NAMESPACE&gt;"}  &gt; 0
      for: 1m
      labels:
        severity: cica-dev-dev
    - alert: cica--KubeletTooManyPods--dev
      expr: kubelet_running_pod_count{job="kubelet",namespace="&lt;NAMESPACE&gt;"}
        &gt; 0 * 0.9
      for: 5m
      labels:
        severity: cica-dev-team
      annotations:
        message: Kubelet {{ $labels.instance }} is running {{ $value }} Pods, close to the
          limit of 1 Test.
        runbook_url: https://github.com/kubernetes-monitoring/kubernetes-mixin/blob/master/runbook.md#alert-name-kubelettoomanypods
    - alert: cica-dev-Node-Disk-Space-Low
      annotations:
        message: A node is reporting low disk space below 10%. Action is required on a node.
        runbook_url: https://github.com/ministryofjustice/cloud-platform-infrastructure/blob/master/terraform/cloud-platform-components/resources/prometheusrule-alerts/Custom-Alerts.md#node-disk-space-low
      expr: ((node_filesystem_avail_bytes * 100) / node_filesystem_size_bytes) &lt; 10
      for: 30m
      labels:
        severity: cica-dev-team
    - alert: cica--KubeDeploymentReplicasMismatch--dev
      annotations:
       message: Deployment {{ $labels.namespace }}/{{ $labels.deployment }} has not matched the expected number of replicas for longer than an hour.
       runbook_url: https://github.com/kubernetes-monitoring/kubernetes-mixin/blob/master/runbook.md#alert-name-kubedeploymentreplicasmismatch
      expr: kube_deployment_spec_replicas{job="kube-state-metrics",namespace="&lt;NAMESPACE&gt;"}
        != kube_deployment_status_replicas_available{job="kube-state-metrics",namespace="&lt;NAMESPACE&gt;"}
      for: 1h
      labels:
        severity: cica-dev-dev

</code></pre></div><p>Replace the placeholder <code>&lt;NAMESPACE&gt;</code> with the namespace where this will will created.</p>
<p>Save the above yaml and execute into the desired namespace e.g <code>kubectl create -f &lt;FILE_NAME&gt;.yaml -n &lt;NAMESPACE&gt;</code></p>
<p>Certificate</p>
<div class="highlight"><pre class="highlight plaintext" tabindex="0"><code>apiVersion: cert-manager.io/v1alpha3
kind: Certificate
metadata:
  name: cert-dr-test
spec:
  secretName: dr-test-tls-certificate
  issuerRef:
    name: letsencrypt-production
    kind: ClusterIssuer
  dnsNames:
  - helloworld-app-starter-pack.apps.&lt;CLUSTER_NAME&gt;.cloud-platform.service.justice.gov.uk
</code></pre></div><p>Save the above yaml and execute into the desired namespace e.g <code>kubectl create -f &lt;FILE_NAME&gt;.yaml -n &lt;NAMESPACE&gt;</code></p>
<h3 id="velero-backup">Velero Backup</h3><p>Before destroying ensure you have taken a backup using velero.</p>
<p><code>velero backup create my-app-backup01</code></p>
<h3 id="apply-the-eks-components-to-the-kops-cluster">Apply the EKS components to the KOPS cluster</h3><p>1) Ensure you have access to both a test KOPS cluster and a EKS test cluster</p>
<p>2) Ensure kubectl context is set to the KOPS cluster</p>
<p>3) Browse to the <code>cloud-platform-infrastructure/terraform/cloud-platform-eks/components</code></p>
<p>4) Ensure you are on the terraform workspace of the kops cluster</p>
<p>4) Execute <code>terraform apply</code> (enter &lsquo;yes&rsquo; when prompted to confirm the apply)</p>
<h3 id="observations-of-incident">Observations of Incident</h3><p>Once the EKS components have been applied to the KOPS cluster, the following changes to the cluster should be observed</p>

<ul>
<li><p>Following components are newly created in the kops cluster (unique to EKS)</p>

<ul>
<li>concourse</li>
</ul></li>
<li><p>Following components are modified:</p></li>
</ul>
<p>Cert-manager</p>
<p>(1)</p>
<p>The following annotation is applied to the deployment:</p>
<div class="highlight"><pre class="highlight plaintext" tabindex="0"><code>iam.amazonaws.com/permitted : aws_iam_role.cert_manager.0.name
</code></pre></div><p>(2)</p>
<p>In ClusterIssuer resource the iam role is applied to the route53 within the solvers block:</p>
<div class="highlight"><pre class="highlight plaintext" tabindex="0"><code>    solvers:
    - selector: {}
      dns01:
        cnameStrategy: "Follow"
        # Here we define a list of DNS-01 providers that can solve DNS challenges
        route53:
          region: eu-west-2
          role: "${iam_role}"
</code></pre></div><p>External DNS</p>
<p>(1)</p>
<p>Following annotations are applied to the external dns pods</p>
<div class="highlight"><pre class="highlight plaintext" tabindex="0"><code>podAnnotations:
  iam.amazonaws.com/role: "${iam_role}"
</code></pre></div><p>The following annotations are added to external dns deployment</p>
<div class="highlight"><pre class="highlight plaintext" tabindex="0"><code>  annotations:
    eks.amazonaws.com/role-arn: "${eks_service_account}"
</code></pre></div><h3 id="destroy-the-eks-components">Destroy the EKS components</h3><p>The first step for recovery is to destroy what was applied from the same directory.</p>
<p>Ensure you in the <code>cloud-platform-infrastructure/terraform/cloud-platform-eks/components</code> directory.</p>
<p>Execute <code>terraform destroy -auto-approve</code></p>
<h3 id="re-apply-the-kops-components">Re-apply the KOPS components</h3><p>Re-create the components but this time run <code>terraform apply -auto-approve</code> from the <code>...terraform/cloud-platform-components</code> directory</p>
<p>After re-creating the components you may notice that the CRD resources and ingress certificates are still missing. To restore these run <code>velero restore...</code> as follows:</p>
<div class="highlight"><pre class="highlight plaintext" tabindex="0"><code>velero backup get

NAME                                       STATUS      CREATED                         EXPIRES   STORAGE   LOCATION   SELECTOR
velero-backup-00000000000000              Completed   2020-03-30 12:00:37 +0100 BST     29d       default             &lt;none&gt;
</code></pre></div><p>Using the backup name, you can now run a <code>velero restore...</code> command to restore the deleted resource.</p>
<p>Restore command:</p>
<div class="highlight"><pre class="highlight plaintext" tabindex="0"><code>velero restore create &lt;restore-name&gt; --from-backup &lt;backup-name&gt;
</code></pre></div><p>Example:</p>
<div class="highlight"><pre class="highlight plaintext" tabindex="0"><code>velero restore create my-namespace-dev-restore --from-backup velero-backup-00000000000000
</code></pre></div><p>Once completed, you should be able to see the CRD resources that were created earlier, above before the incident.</p>
<div class="highlight"><pre class="highlight plaintext" tabindex="0"><code>kubectl get prometheusrules -n &lt;NAMESPACE&gt;
kubectl get servicemonitors -n &lt;NAMESPACE&gt;
kubectl get certificates -n &lt;NAMESPACE&gt;

</code></pre></div>

              <div data-module='page-expiry' data-last-reviewed-on="2022-04-04">
    <div class='page-expiry--not-expired'>
      This page was last reviewed on 4 January 2022.

        It needs to be reviewed again on 4 April 2022
        by the page owner <a href="https://mojdt.slack.com/messages/cloud-platform">#cloud-platform</a>
        .
    </div>

    <div class='page-expiry--expired'>
      This page was set to be reviewed before 4 April 2022
       by the page owner <a href="https://mojdt.slack.com/messages/cloud-platform">#cloud-platform</a>.
      This might mean the content is out of date.
    </div>
  </div>

          </main>

          <aside>
              <ul class="contribution-banner">
                <li><a href="https://github.com/ministryofjustice/cloud-platform/blob/main/runbooks/source/disaster-recovery-scenarios.html.md.erb">View source</a></li>
                <li><a href="https://github.com/ministryofjustice/cloud-platform/issues/new?labels=bug&amp;title=Re:%20'Cloud%20Platform%20Disaster%20Recovery%20Scenarios'&amp;body=Problem%20with%20'Cloud%20Platform%20Disaster%20Recovery%20Scenarios'%20(https://runbooks.cloud-platform.service.justice.gov.uk/disaster-recovery-scenarios.html)">Report problem</a></li>
                <li><a href="https://github.com/ministryofjustice/cloud-platform">GitHub Repo</a></li>
              </ul>
          </aside>

          <footer class="govuk-footer app-footer" role="contentinfo">
  <div class="govuk-footer__meta">
    <div class="govuk-footer__meta-item govuk-footer__meta-item--grow">


      <svg
        aria-hidden="true"
        focusable="false"
        class="govuk-footer__licence-logo"
        xmlns="http://www.w3.org/2000/svg"
        viewbox="0 0 483.2 195.7"
        height="17"
        width="41"
      >
        <path
          fill="currentColor"
          d="M421.5 142.8V.1l-50.7 32.3v161.1h112.4v-50.7zm-122.3-9.6A47.12 47.12 0 0 1 221 97.8c0-26 21.1-47.1 47.1-47.1 16.7 0 31.4 8.7 39.7 21.8l42.7-27.2A97.63 97.63 0 0 0 268.1 0c-36.5 0-68.3 20.1-85.1 49.7A98 98 0 0 0 97.8 0C43.9 0 0 43.9 0 97.8s43.9 97.8 97.8 97.8c36.5 0 68.3-20.1 85.1-49.7a97.76 97.76 0 0 0 149.6 25.4l19.4 22.2h3v-87.8h-80l24.3 27.5zM97.8 145c-26 0-47.1-21.1-47.1-47.1s21.1-47.1 47.1-47.1 47.2 21 47.2 47S123.8 145 97.8 145"
        />
      </svg>
      <span class="govuk-footer__licence-description">
        All content is available under the
        <a
          class="govuk-footer__link"
          href="https://www.nationalarchives.gov.uk/doc/open-government-licence/version/3/"
          rel="license"
        >Open Government Licence v3.0</a>, except where otherwise stated
      </span>
    </div>
    <div class="govuk-footer__meta-item">
      <a
        class="govuk-footer__link govuk-footer__copyright-logo"
        href="https://www.nationalarchives.gov.uk/information-management/re-using-public-sector-information/uk-government-licensing-framework/crown-copyright/"
      >© Crown copyright</a>
    </div>
  </div>
</footer>

        </div>
      </div>
    </div>

    
    <script src="/javascripts/application.js"></script>
  </body>
</html>
